

--- FILE START: .doc\TECHNICAL_DOCUMENTATION.md ---

# Business Impact Analysis (BIA) Tool - Technical Documentation

## 1. Introduction and Overview

The Business Impact Analysis (BIA) Tool is a comprehensive, ISO 22301:2019 compliant web application designed to help organizations identify critical business processes, assess potential impacts of disruptions, and establish recovery objectives. This document provides a detailed technical explanation of the application's architecture, data model, business logic, and implementation details.

The tool operates as a Single Page Application (SPA) built with vanilla JavaScript, eliminating the need for backend infrastructure and enabling offline capability. Organizations can use this tool to conduct thorough business continuity assessments, generate compliant reports, and visualize risk exposure across their operational landscape. The application follows enterprise-grade coding standards and implements industry best practices for business continuity management.

The primary users of this application include business continuity managers, risk assessment teams, IT directors, and organizational leadership who need to understand their critical business functions and establish recovery strategies. The tool guides users through a structured assessment process that aligns with international standards while remaining accessible to non-technical users.

## 2. Application Architecture

### 2.1 Technology Stack

The application employs a modern frontend technology stack optimized for performance, maintainability, and cross-platform compatibility. The core technologies include vanilla JavaScript (ES6+) for application logic, HTML5 for semantic markup, and CSS3 for responsive styling. This stack ensures the application runs in any modern web browser without requiring plugins, installations, or backend services.

The visualization capabilities are powered by Chart.js, a powerful open-source charting library that renders interactive graphs and charts directly in the browser. This library supports various chart types including line charts for temporal analysis, radar charts for multi-dimensional impact assessment, and bar charts for comparative analysis. FontAwesome provides the iconography used throughout the interface, enhancing visual communication and user experience.

The build and deployment pipeline utilizes Vite, a next-generation frontend build tool that provides extremely fast hot module replacement during development and optimized production builds. Vite handles asset bundling, code minification, and tree-shaking to produce lightweight, efficient deployment packages. Playwright serves as the testing framework, enabling automated end-to-end testing of application functionality across different browsers.

### 2.2 Architecture Patterns

The application follows the Single Page Application (SPA) architecture pattern, where the entire application loads once and dynamically updates content without requiring full page reloads. This approach provides a smooth, app-like user experience and reduces server requests. The application maintains all state locally in the browser's memory, with optional persistence through local storage for saving and restoring assessment progress.

The modular architecture separates concerns into distinct layers: presentation layer (HTML/CSS), business logic layer (JavaScript modules), and data layer (in-memory data structures with local storage persistence). This separation ensures maintainability and allows for future extensibility. The state management system follows a centralized pattern where all application state is held in a single object, making the application predictable and easier to debug.

Event-driven programming governs user interactions, with custom events triggering state updates and UI refreshes. This decoupled approach allows components to communicate without direct dependencies, improving modularity. The application implements a wizard-based workflow that guides users through logical assessment steps, preventing cognitive overload and ensuring completeness of data collection.

### 2.3 File Structure

The project follows a structured file organization that separates concerns and facilitates development and maintenance:

```
bia-tool/
├── index.html              # Main HTML structure with wizard layout
├── app.js                  # Core application logic and state management
├── styles.css              # Comprehensive styling for all components
├── test.js                 # Playwright automated test suite
├── package.json            # NPM configuration and dependencies
├── vite.config.js          # Vite build configuration
├── dist/                   # Production build artifacts
│   ├── index.html
│   ├── assets/
│   │   ├── app.js          # Bundled application code
│   │   ├── chart.js        # Chart.js library
│   │   ├── styles.css      # Minified styles
│   │   └── favicon.ico     # Application icon
```

## 3. Data Model and Database Diagram

### 3.1 Conceptual Data Model (Target Architecture)

> **Note:** The current application uses a local-storage based approach. The schema described below represents the target architecture for the future multi-tenant backend implementation.

The multi-tenant architecture introduces **Tenants** (Organizations) and **Users** as top-level entities. All data is scoped to a specific Tenant to ensure data isolation.

- **Tenant**: Represents a subscriber organization. All Assessments belong to a Tenant.
- **User**: Represents an individual user account linked to a single Tenant.
- **Assessment**: The container for a BIA session. It is linked to a Tenant and created by a User.

### 3.2 Entity Relationship Diagram

```
┌───────────────────────┐       ┌───────────────────────┐
│        TENANT         │◄──────┤         USER          │
├───────────────────────┤       ├───────────────────────┤
│ • id: UUID            │       │ • id: UUID            │
│ • name: String        │       │ • tenantId: UUID (FK) │
│ • subscription: String│       │ • email: String       │
└───────────┬───────────┘       │ • role: String        │
            │ 1:N               └───────────────────────┘
            ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              ASSESSMENT                                              │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ • id: UUID                                                                             │
│ • tenantId: UUID (FK)                                                                  │
│ • createdBy: UUID (FK User)                                                            │
│ • name: String                                                                         │
│ • status: String (draft|completed)                                                    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ 1:N
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                 PROCESS                                               │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ • id: UUID                                                                             │
│ • assessmentId: UUID (FK)                                                             │
│ • name: String                                                                         │
│ • criticality: String (critical|high|medium|low)                                      │
└─────────────────────────────────────────────────────────────────────────────────────┘
           │                                         │
           │ 1:N                              1:N   │
           │                    ┌───────────────────┼───────────────────┐
           │                    │                   │                   │
           │                    ▼                   ▼                   │
           │    ┌─────────────────────────────┐     ┌───────────────────────┐
           │    │       IMPACT ASSESSMENT     │     │  RECOVERY OBJECTIVES  │
           │    ├─────────────────────────────┤     ├───────────────────────┤
           │    │ • id: UUID                  │     │ • id: UUID            │
           │    │ • processId: UUID (FK)      │     │ • processId: UUID (FK)│
           │    │ • category: String          │     │ • mtpd: Integer       │
           │    │ • score: Integer (0-5)      │     │ • rto: Integer        │
           │    └─────────────────────────────┘     │ • rpo: Integer        │
           │                                        └───────────────────────┘
           │
           │ 1:N
           ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              DEPENDENCY                                               │
├─────────────────────────────────────────────────────────────────────────────────────┤
│ • id: UUID                                                                             │
│ • sourceProcessId: UUID (FK)                                                          │
│ • targetProcessId: UUID (FK)                                                          │
│ • type: String                                                                        │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### 3.3 Data Dictionary

The following sections provide detailed definitions for each data entity and its attributes.

**Assessment Entity**: Represents a complete business impact analysis session. The assessment contains all related processes, impacts, and recovery objectives for a given organizational analysis. Multiple assessments can exist within the system, allowing organizations to conduct analyses for different business units, time periods, or scenarios.

**Process Entity**: The central entity representing a business function being analyzed. Each process belongs to a specific department, has an assigned owner, and carries a criticality score that reflects its importance to organizational operations. The dependencies array captures other processes or systems that this process relies upon, enabling cascading impact analysis.

**Impact Assessment Entity**: Captures the severity of various impact types for a specific process. The application evaluates five distinct impact dimensions: financial loss, operational disruption, reputational damage, regulatory compliance violations, and customer impact. Each dimension uses a 0-5 scale where 0 indicates no impact and 5 represents catastrophic consequences.

**Timeline Point Entity**: Records how impacts evolve over time following a disruption. The timeOffset field indicates hours from the initial disruption, while the impact values show how severity increases or decreases as time progresses. This temporal modeling enables organizations to understand the urgency of recovery efforts and prioritize based on impact acceleration rates.

**Recovery Objectives Entity**: Defines the recovery targets for each process based on the impact assessment findings. MTPD (Maximum Tolerable Period of Disruption) represents the longest period a process can be unavailable before causing unacceptable consequences. RTO (Recovery Time Objective) specifies the target time for restoring the process. RPO (Recovery Point Objective) indicates the maximum acceptable data loss measured in time.

**Dependency Entity**: Models the relationships between processes, capturing how disruptions in one area cascade to dependent processes. The dependencyType field distinguishes between technical dependencies (IT systems), operational dependencies (manual handoffs), and resource dependencies (shared resources or personnel).

## 4. Module-by-Module Logic

### 4.1 Process Identification Module

The Process Identification Module serves as the foundation of the business impact analysis, providing the structure for cataloging and characterizing all critical business processes. This module guides users through systematically identifying processes that require protection and establishing their basic characteristics.

The module implements a wizard-based data entry interface where users can add, edit, and delete processes. Each process requires a unique identifier, descriptive name, owning department, and assigned owner. The criticality score (1-5 scale) provides an initial assessment of process importance, with higher scores indicating greater organizational criticality. This score serves as a preliminary input for later recovery prioritization.

The validation logic ensures data integrity by requiring essential fields before allowing process submission. The name field must be unique within the assessment to prevent duplicate entries. The criticality score must fall within the defined range, and the department and owner fields cannot be empty. These validation rules enforce completeness and prevent erroneous data from propagating through subsequent analysis stages.

The module maintains an in-memory collection of all processes, providing this data to downstream modules for impact assessment and recovery planning. The array-based storage supports efficient iteration, filtering, and sorting operations. The module also implements export functionality that serializes the process data for external analysis or backup purposes.

### 4.2 Impact Assessment Module

The Impact Assessment Module captures the multidimensional consequences of process disruption across five critical impact dimensions. This module transforms subjective business knowledge into structured, comparable data that enables objective prioritization and recovery investment decisions.

The five impact dimensions implemented in the module represent the key areas where disruptions create organizational harm. Financial impact measures direct and indirect monetary losses from process unavailability, including lost revenue, emergency recovery costs, and contractual penalties. Operational impact assesses disruption to business operations, workflow interruptions, and productivity losses. Reputational impact evaluates damage to brand image, customer confidence, and market position. Regulatory impact captures compliance violations, potential fines, and legal consequences. Customer impact measures effects on customer experience, service delivery, and relationships.

Each impact dimension uses a standardized 0-5 severity scale with defined descriptors for consistent interpretation. A score of 0 indicates no measurable impact, representing processes whose disruption would have negligible consequences. Scores of 1-2 indicate minor impacts requiring attention but not immediate action. Scores of 3-4 indicate moderate to significant impacts requiring prioritized recovery efforts. A score of 5 represents catastrophic impact that threatens organizational survival or causes severe, irreversible harm.

The module calculates an aggregate impact score for each process by applying weighted averages or summation across dimensions. The weighting system allows organizations to emphasize impact types most relevant to their risk tolerance and industry context. For example, financial services organizations might weight regulatory impact more heavily, while retail organizations might prioritize customer impact.

The visualization component renders impact data as radar charts, enabling quick comparison of impact profiles across processes and dimensions. The radar chart format clearly shows which impact types represent the greatest risk for each process, guiding recovery strategy development. Bar chart comparisons enable leadership to understand relative priorities across the process portfolio.

### 4.3 Temporal Analysis Module

The Temporal Analysis Module models how impacts evolve over time following a disruption, revealing the urgency of recovery efforts and the acceptable windows for restoration. This temporal dimension transforms static impact assessments into dynamic risk profiles that inform time-sensitive recovery decisions.

The module captures impact progression through a series of timeline points, each representing a specific time offset from the initial disruption. Users define impact severity at key time intervals (for example, immediate, 4 hours, 24 hours, 72 hours, and 1 week), creating a curve that shows impact acceleration or stabilization over time. This modeling approach recognizes that most impacts worsen over time as backup resources deplete, customer frustration builds, and market opportunities are lost.

The data structure supports flexible timeline configuration with arbitrary time points. Users can define as many timeline points as needed to accurately capture the impact progression curve. The module provides default time points at 0, 4, 8, 24, 48, 72, and 168 hours (one week), representing the critical early period of most disruptions. These defaults can be customized based on industry-specific recovery dynamics.

The temporal analysis enables calculation of the Maximum Tolerable Period of Disruption (MTPD) by identifying the point where cumulative impacts exceed organizational tolerance thresholds. The module displays this as a visual "breaking point" on the timeline, providing clear visual communication of urgency to stakeholders. The MTPD calculation considers all impact dimensions weighted by their organizational significance.

Chart.js renders temporal impact data as line charts, with each line representing a different impact dimension. This visualization clearly shows which impacts escalate most rapidly and when combined impacts cross critical thresholds. The multi-line format enables quick identification of the most time-sensitive impact dimensions for each process.

### 4.4 Recovery Objectives Module

The Recovery Objectives Module translates impact assessment findings into concrete recovery targets that drive continuity planning and investment decisions. This module establishes the numerical recovery objectives (RTO, RPO, MTPD) that form the quantitative foundation of the business continuity management system.

The module implements the hierarchical relationship between recovery objectives, where MTPD represents the outer boundary and RTO/RPO fall within that boundary. The validation logic enforces this relationship by checking that RTO values are always less than or equal to MTPD values, and that RPO values align with data recovery requirements without exceeding the MTPD constraint.

The Maximum Tolerable Period of Disruption (MTPD) represents the maximum duration a process can be unavailable before causing unacceptable consequences. The module calculates MTPD based on temporal analysis data by identifying when cumulative impacts cross the organization's tolerance threshold. Users can specify MTPD manually based on business judgment, or derive it from the temporal impact curves generated in the previous module.

The Recovery Time Objective (RTO) specifies the targeted duration for restoring a process following a disruption. The module guides users in setting realistic RTO values that balance recovery costs against impact severity. Processes with higher impact scores receive more aggressive RTO targets, while lower-impact processes may accept longer recovery windows. The module provides industry benchmark data to inform target-setting.

The Recovery Point Objective (RPO) defines the maximum acceptable data loss measured in time. This objective applies primarily to processes involving data creation or modification. The module distinguishes between processes requiring continuous data protection and those tolerating periodic backups. RPO validation ensures consistency with backup strategies and data replication capabilities.

The Minimum Business Continuity Objective (MBCO) checkbox identifies processes requiring immediate minimal functionality during disruption. MBCO processes receive highest priority for continuity resources and must have documented workaround procedures. The module ensures MBCO processes have correspondingly aggressive RTO targets.

### 4.5 Dependency Analysis Module

The Dependency Analysis Module maps relationships between business processes, enabling cascading impact analysis and comprehensive recovery planning. This module recognizes that modern business processes rarely exist in isolation and that disruptions propagate through organizational and technical dependencies.

The module maintains a dependency graph where nodes represent processes and edges represent relationships. Each dependency connection captures the dependent process, the required process, and the nature of the relationship. The dependencyType field distinguishes technical dependencies (IT systems, platforms), operational dependencies (workflows, approvals), and resource dependencies (shared staff, facilities, equipment).

The cascading impact algorithm propagates disruption effects through the dependency graph. When a process becomes unavailable, the algorithm identifies all dependent processes and increases their effective impact scores based on the relationship criticality. This propagation reveals hidden vulnerabilities where secondary process failures may exceed the impact of the original disruption.

The visualization component renders the dependency graph using Chart.js node-link diagrams, showing process relationships and highlighting critical dependency chains. The graph layout positions highly-dependent processes centrally, enabling quick identification of single points of failure. Color coding indicates dependency type, and line thickness represents relationship criticality.

The critical path analysis feature identifies sequences of dependencies that create the longest recovery chains. These critical paths represent the processes whose recovery has the greatest impact on overall organizational recovery time. The module highlights these paths in the visualization and provides narrative descriptions of dependency chains for documentation purposes.

### 4.6 Risk Scoring Module

The Risk Scoring Module synthesizes process criticality, impact severity, and recovery objectives into composite risk scores that enable portfolio-level prioritization. This module transforms detailed assessment data into actionable insights for leadership decision-making.

The module implements a weighted scoring algorithm that combines multiple risk factors into a single risk score for each process. The base impact score comes from the impact assessment module, normalized to a 0-100 scale. The criticality multiplier adjusts scores for processes with high organizational importance. The recovery feasibility factor accounts for the organization's ability to meet recovery objectives given current capabilities.

The risk prioritization algorithm ranks all processes by their composite risk scores, producing a prioritized list for recovery investment. The algorithm applies threshold logic to classify processes into risk categories (critical, high, medium, low) based on score ranges. These classifications guide resource allocation and recovery strategy selection.

The module generates a risk matrix visualization plotting processes by likelihood versus impact. While the BIA focuses primarily on impact assessment, the risk matrix provides a framework for communicating risk to stakeholders familiar with traditional risk management frameworks. The visualization supports filtering by department, owner, or risk category.

Benchmark comparison features allow organizations to compare their risk profiles against industry standards and peer organizations. The module maintains anonymized benchmark data across multiple industries, enabling context setting for risk scores. This comparison functionality helps organizations validate their assessments and identify potential gaps in coverage.

### 4.7 Recovery Strategy Module

The Recovery Strategy Module translates recovery objectives into actionable strategy recommendations based on gap analysis between requirements and current capabilities. This module bridges the assessment and planning phases of business continuity management.

The module implements a strategy recommendation engine that analyzes recovery objective gaps and suggests appropriate continuity approaches. For each process, the engine compares required RTO/RPO against industry-standard solution capabilities, identifying the strategy options that can meet objectives within budget constraints. The engine considers manual workarounds, quick wins, and long-term investments in its recommendations.

The strategy taxonomy includes five levels of recovery capability. Manual workaround strategies provide temporary continuity through paper-based or non-technical processes. Quick recovery strategies leverage existing infrastructure with enhanced procedures. Standard backup strategies utilize data protection technologies. High availability strategies employ redundancy and failover capabilities. Cloud-based strategies leverage modern infrastructure-as-a-service capabilities for rapid recovery.

The cost-benefit analysis component estimates implementation costs for recommended strategies and projects risk reduction benefits. The analysis considers one-time implementation costs, ongoing operational costs, and avoided impact costs based on historical disruption data or BIA findings. This analysis enables return-on-investment calculations that support business case development.

The module generates strategy documentation templates that capture recovery procedures for each selected strategy. These templates provide starting points for detailed procedure development, ensuring consistency across the recovery plan portfolio. The documentation format aligns with ISO 22301:2019 requirements for documented continuity procedures.

### 4.8 Report Generation Module

The Report Generation Module transforms assessment data into professional documentation suitable for management review, auditor examination, and regulatory submission. This module produces ISO-compliant output that demonstrates organizational business continuity maturity.

The module implements multiple report formats optimized for different audiences and purposes. The executive summary report provides high-level findings, risk rankings, and strategic recommendations for leadership consumption. The detailed technical report includes full data tables, methodology documentation, and supporting analysis for continuity professionals and auditors. The presentation report generates slide-ready content for board and management committee briefings.

The report generation engine applies consistent formatting, branding, and structure across all output formats. Headers, footers, and page numbering follow organizational standards. Tables and charts maintain consistent styling. The engine supports custom organization branding through configurable color schemes and logo inclusion.

The export functionality supports multiple output formats including PDF for formal documentation, Microsoft Word for further editing, and HTML for web-based distribution. The PDF generation produces print-ready output with appropriate resolution and pagination. Word export enables organizations to customize reports for specific stakeholder requirements.

Report validation ensures completeness before generation, flagging processes with missing assessments or incomplete recovery objectives. The validation logic prevents report generation with known data gaps, ensuring all published reports represent comprehensive analysis. This quality control protects organizations from presenting incomplete assessments to auditors or regulators.

### 4.9 Data Management Module

The Data Management Module provides persistence, import, and export capabilities that enable ongoing assessment maintenance and organizational knowledge capture. This module ensures assessment data survives browser sessions and can be shared across team members.

The persistence layer implements local storage synchronization that automatically saves assessment progress. Every state change triggers a local storage update, ensuring recent data is never lost due to browser closure or system restart. The module loads saved state on application initialization, restoring previous sessions seamlessly.

The export functionality serializes complete assessment data to JSON format for backup and transfer purposes. The exported files contain all process data, impact assessments, recovery objectives, and assessment metadata. Encryption options protect exported data containing sensitive organizational information. The export format enables data recovery if local storage is cleared or corrupted.

Import functionality reverses the export process, loading assessment data from JSON files into the application. Validation logic ensures imported data matches the current data model schema, preventing errors from corrupted or incompatible files. The import process supports merging assessments with existing data, enabling consolidation of department-level analyses into enterprise-wide assessments.

The version management component tracks changes to assessment data over time, maintaining audit trails of who made changes and when. This versioning supports compliance requirements for change documentation and enables rollback to previous states if errors are discovered. The version history also supports analysis of how assessments evolve as organizational understanding matures.

### 4.10 Help and Guidance Module

The Help and Guidance Module provides contextual assistance, methodology documentation, and compliance reference information throughout the application. This module ensures users understand both how to use the tool and why specific assessment approaches matter.

Contextual help appears throughout the interface, providing relevant guidance at each step of the assessment process. Hover tooltips explain field purposes and data entry expectations. Inline guidance panels provide detailed methodology explanations when users expand help sections. The context-sensitivity ensures help is available without interrupting workflow.

The methodology documentation section provides comprehensive guidance on business impact analysis principles, techniques, and best practices. Content covers impact dimension definitions, severity scale interpretations, temporal analysis approaches, and recovery objective setting. This documentation serves as both learning resources and reference materials for experienced practitioners.

The compliance reference section maps application functionality to ISO 22301:2019 requirements, demonstrating how assessment activities satisfy specific standard clauses. This mapping supports auditor demonstrations and certification preparation. The references include direct quotations from the standard and implementation guidance for each requirement.

The glossary defines technical terminology used throughout the application, ensuring consistent understanding across diverse user groups. The glossary entries include both definitions and contextual explanations that help users apply concepts to their specific organizational context.

## 5. Business Logic and Calculations

### 5.1 Impact Score Aggregation

The application implements multiple aggregation algorithms for combining multidimensional impact scores into actionable metrics. The default algorithm uses weighted summation, where each impact dimension contributes proportionally to its assigned weight. The equation for the base impact score is:

```
BaseImpactScore = Σ(Wi × Si) / Σ(Wi)
```

Where Wi represents the weight for impact dimension i and Si represents the severity score for that dimension. Default weights equalize all dimensions, but users can adjust weights to reflect organizational priorities. Financial weights might increase for commercial organizations, while regulatory weights might increase for heavily regulated industries.

The alternative aggregation algorithm uses maximum scoring, where the highest individual dimension score determines the overall impact. This conservative approach ensures worst-case scenarios drive recovery prioritization. The maximum algorithm equation is:

```
BaseImpactScore = max(S1, S2, S3, S4, S5)
```

The hybrid algorithm combines weighted summation with a maximum threshold, providing balanced assessment with conservative overrides. If any individual dimension exceeds a critical threshold, the hybrid algorithm escalates the overall score regardless of weighted average results.

### 5.2 Temporal Impact Extrapolation

The temporal analysis logic extrapolates impact severity between user-defined timeline points using linear interpolation. This extrapolation provides smooth impact curves that enable precise MTPD identification. The interpolation equation for impact between points (t1, s1) and (t2, s2) is:

```
Impact(t) = s1 + ((s2 - s1) / (t2 - t1)) × (t - t1)
```

Where t represents the time for which impact is being calculated, s1 and s2 are the severity scores at consecutive timeline points, and t1 and t2 are the corresponding time offsets.

The module calculates cumulative impact by integrating severity scores over time. This cumulative metric reflects the total harm caused by extended disruption durations. The cumulative impact calculation uses trapezoidal integration:

```
CumulativeImpact = Σ[(si + si+1) / 2] × (ti+1 - ti)
```

This integration approach accounts for the actual area under the impact curve, providing accurate comparison of total disruption harm across processes with different impact profiles.

### 5.3 Recovery Objective Validation

The recovery objective validation logic enforces the mathematical relationships between MTPD, RTO, and RPO that reflect their business continuity definitions. The primary validation ensures RTO does not exceed MTPD, since a recovery time longer than the maximum tolerable period defeats the purpose of recovery planning:

```
IF RTO > MTPD THEN ValidationError("RTO cannot exceed MTPD")
```

Secondary validation ensures RPO aligns with data protection requirements. For processes with significant data impact dimensions, RPO should not exceed MTPD, since exceeding MTPD implies accepting data loss that causes unacceptable consequences:

```
IF RPO > MTPD THEN ValidationWarning("RPO exceeds MTPD - review data protection strategy")
```

The module also validates RTO against temporal analysis data. If the impact curve shows unacceptable impacts occurring before the specified RTO, the module generates a warning suggesting that recovery objectives may be insufficient:

```
IF Impact(RTO) > UnacceptableThreshold THEN ValidationWarning("Impact at RTO exceeds tolerance")
```

### 5.4 Risk Score Calculation

The composite risk score calculation combines base impact scores with adjustment factors that account for organizational context. The formula applies multiplicative and additive adjustments to the base impact score:

```
RiskScore = (BaseImpactScore × CriticalityMultiplier × DependencyMultiplier) + FeasibilityGap
```

The CriticalityMultiplier scales scores based on process strategic importance, with values ranging from 0.8 for non-critical processes to 1.5 for mission-critical processes. This multiplier ensures that high-criticality processes with moderate base impacts receive appropriate prioritization.

The DependencyMultiplier accounts for cascading risk from process dependencies. Processes with many dependents receive higher multipliers, reflecting the broader impact of their disruption. The multiplier calculation counts dependent processes and applies logarithmic scaling to prevent extreme values:

```
DependencyMultiplier = 1 + log(DependentCount + 1) / log(BaseThreshold + 1)
```

The FeasibilityGap adjustment reflects the organization's current capability to meet recovery objectives. Larger gaps between required and achievable recovery times increase the risk score, representing both the inherent disruption risk and the implementation risk associated with closing capability gaps.

### 5.5 Cascading Impact Propagation

The cascading impact algorithm propagates disruption effects through the dependency graph using breadth-first traversal. The algorithm initializes with direct impact scores for the disrupted process, then iteratively spreads impact to dependent processes:

```
Initialize impactQueue with disrupted process
While impactQueue not empty:
    currentProcess = impactQueue.dequeue()
    For each dependentProcess in currentProcess.dependents:
        propagatedImpact = currentProcess.impact × DependencyStrength × DependencyCriticality
        dependentProcess.cascadedImpact += propagatedImpact
        impactQueue.enqueue(dependentProcess)
```

The DependencyStrength factor (0.0 to 1.0) represents how completely the dependency transmits disruption effects. Partial dependencies with workarounds have lower strength factors. The DependencyCriticality factor (1.0 to 1.5) represents how essential the dependency is, with critical dependencies transmitting more impact than optional dependencies.

The algorithm tracks cumulative impact to prevent infinite loops in circular dependency scenarios. A maximum propagation depth limit prevents excessive computation in highly connected graphs. These safeguards ensure the algorithm terminates while providing accurate cascading impact estimates.

## 6. ISO 22301:2019 Compliance Mapping

### 6.1 Standard Overview

ISO 22301:2019 is the international standard for Business Continuity Management Systems (BCMS), specifying requirements for planning, implementing, maintaining, and improving organizational business continuity management. The standard provides a systematic approach to protecting, preparing for, recovering, and adapting to disruptive events. This section maps the BIA Tool's functionality to specific ISO 22301:2019 requirements.

The standard follows the High-Level Structure (HLS) common to all ISO management system standards, ensuring compatibility with ISO 9001 (Quality), ISO 14001 (Environmental), and other 管理体系 frameworks. The BIA Tool supports compliance with Clause 8 (Operation) requirements for business impact analysis and risk assessment activities that form the foundation of business continuity planning.

### 6.2 Clause 8.2 - Business Impact Analysis Mapping

**Requirement**: "The organization shall conduct a business impact analysis to establish business continuity requirements."

The BIA Tool fully addresses this requirement through multiple integrated modules. The Process Identification Module (Section 4.1) satisfies the requirement to identify and document organizational functions, activities, products, and services that must be continued. The module captures process characteristics including owners, departments, and dependencies that satisfy documentation requirements.

The Impact Assessment Module (Section 4.2) addresses the requirement to identify and evaluate the impact of not performing these functions. The five-dimensional impact model captures financial, operational, reputational, regulatory, and customer consequences of disruption. The standardized severity scales ensure consistent impact evaluation across the organization.

The Temporal Analysis Module (Section 4.3) satisfies requirements to identify the timeframes within which the impacts would become unacceptable. The MTPD calculation directly derives from temporal impact analysis, establishing the maximum tolerable disruption duration for each critical function.

**Requirement**: "The organization shall identify and document dependencies."

The Dependency Analysis Module (Section 4.5) provides comprehensive dependency identification and documentation capabilities. The module captures technical, operational, and resource dependencies between processes, supporting both internal and external dependency analysis. The dependency graph visualization satisfies documentation requirements while enabling cascading impact analysis.

### 6.3 Recovery Objective Documentation

**Requirement**: "The organization shall determine recovery time objectives, recovery point objectives, and maximum tolerable period of disruption."

The Recovery Objectives Module (Section 4.4) directly addresses this requirement by providing structured data entry and validation for all three recovery objective types. The MTPD field captures maximum tolerable disruption periods derived from temporal analysis. The RTO field documents targeted recovery times with validation ensuring RTO does not exceed MTPD. The RPO field captures acceptable data loss measured in time.

The module implements all three objective types with appropriate units (hours for MTPD and RTO, hours for RPO), validation rules ensuring internal consistency, and visualization supporting objective communication. Documentation outputs include recovery objective tables suitable for inclusion in business continuity plans and audit evidence packages.

### 6.4 Risk Assessment Integration

**Requirement**: "The organization shall identify risks and opportunities that need to be addressed to give assurance that the business continuity management system can achieve its intended outcome."

The Risk Scoring Module (Section 4.6) transforms BIA findings into risk assessments that satisfy this requirement. The composite risk scores provide quantified risk levels that enable risk treatment prioritization. The risk matrix visualization communicates risk position relative to likelihood and impact parameters.

The module supports risk assessment documentation with exportable data formats suitable for inclusion in risk registers and management review presentations. The linkage between BIA findings and risk scores maintains traceability between operational impacts and strategic risk management activities.

### 6.5 Documentation Requirements

**Requirement**: "The organization shall retain documented information to the extent necessary to have confidence that the actions taken are as described."

The Data Management Module (Section 4.9) ensures all assessment data is retained in persistent storage with version tracking. The export functionality generates JSON files containing complete assessment state, providing documented evidence of analysis activities. The version history satisfies change documentation requirements.

The Report Generation Module (Section 4.8) produces formal documentation outputs suitable for auditor review and management oversight. The multiple report formats address different documentation needs, from detailed technical reports for continuity professionals to executive summaries for leadership. PDF export provides immutable documentation suitable for regulatory submission.

## 7. User Interface Components

### 7.1 Wizard Navigation System

The application employs a step-based wizard navigation pattern that guides users through the logical assessment workflow. The navigation system displays progress at the top of the interface, showing completed steps, the current step, and upcoming steps. Users can navigate forward to proceed through the assessment and backward to review or modify previous entries.

The step indicator uses visual state representation with distinct styling for completed (green checkmark), current (highlighted), and upcoming (grayed) steps. This visual design provides immediate progress feedback and reduces user uncertainty about assessment completion status. Clicking completed steps allows rapid review without sequential navigation.

The navigation system implements save-before-navigate logic that prevents losing unsaved changes when users move between steps. The auto-save feature supplements manual navigation saves, ensuring progress is never lost due to browser issues or user error. The status indicator shows save state (saved, unsaved, saving) to maintain transparency about data persistence.

### 7.2 Data Entry Forms

The application implements form-based data entry optimized for efficiency and validation. Form layouts follow consistent patterns with clear label associations, appropriate input types, and inline validation feedback. Required fields are visually indicated, and validation messages appear immediately upon form submission.

Input types include text fields for names and descriptions, select dropdowns for categorical data, number inputs for scores and time values, and checkboxes for boolean flags. The form design uses appropriate input types to prevent invalid entries at the point of data entry where possible. For example, number inputs prevent non-numeric characters in score fields.

The validation system implements both immediate feedback (real-time validation as users type) and deferred feedback (comprehensive validation on form submission). Immediate validation highlights field issues without preventing continued editing, while deferred validation ensures data completeness before processing. This dual approach balances user experience with data quality.

### 7.3 Dashboard and Visualization

The dashboard provides at-a-glance assessment status and key metrics. The summary panel shows total processes, completed assessments, and overall risk posture indicators. The dashboard updates dynamically as users complete assessment activities, providing immediate feedback on progress and highlighting areas requiring attention.

Chart.js powers all data visualizations, with consistent styling and interactive features across chart types. Chart interactions include hover tooltips showing detailed values, click-to-filter enabling drill-down analysis, and legend toggles allowing focus on specific data series. Charts export as PNG images for inclusion in presentations and reports.

The visualization gallery displays all generated charts in a responsive grid layout. Users can customize the gallery view by filtering for specific chart types, processes, or time periods. The gallery supports full-screen expansion for detailed examination and presentation use.

### 7.4 Modal Dialogs

Modal dialogs handle focused interactions including confirmation requests, detailed data views, and wizard step content. Modal design follows accessibility guidelines with focus management, ARIA attributes, and keyboard navigation support. The modal overlay prevents background interaction, ensuring focused attention on the dialog content.

Confirmation modals require explicit user action for destructive operations, preventing accidental data loss. The confirmation dialogs clearly describe the action being confirmed and its consequences. The dialogs provide clearly labeled accept and cancel options with cancel as the default focus.

Content modals display extended information including detailed process assessments, methodology explanations, and help content. These modals support scrolling for long content and include close buttons for easy dismissal. The modal system supports nested modals for drill-down information access.

## 8. Technical Implementation Details

### 8.1 State Management

The application implements centralized state management using a single application state object. This state object contains all assessment data including processes, impacts, recovery objectives, and configuration settings. The state structure follows the entity relationships defined in the data model, ensuring data integrity and enabling efficient data access.

The state management system implements change detection to optimize rendering performance. Only components affected by state changes re-render when updates occur. The change detection algorithm uses shallow comparison of nested objects to identify meaningful changes requiring UI updates. This optimization ensures the application remains responsive as assessment data grows.

State persistence synchronizes the application state with browser local storage. The persistence layer implements incremental saves that only store changed state sections, reducing storage overhead and write times. The load process reconstructs complete state from persisted fragments, with version compatibility checking to handle schema changes across application updates.

### 8.2 Event System

The application uses a custom event system for component communication and state change notification. The event system follows the publish-subscribe pattern, where components register interest in specific event types and receive notifications when those events occur. This decoupled communication supports component modularity and reusability.

Event types include application lifecycle events (initialization, load, save), navigation events (step change, validation failure), and data events (process add, impact update, objective change). Each event type carries a payload containing relevant data for handlers to process. The event payload structure follows consistent patterns for predictability.

Event handlers can prevent default behavior and stop propagation, providing fine-grained control over event effects. The system supports both synchronous and asynchronous event handlers, enabling operations like server requests without blocking event processing. Error handling ensures handler failures don't prevent other handlers from executing.

### 8.3 Template System

The application implements a template system for rendering repeated UI elements consistently. Templates define structure with placeholder variables that populate with dynamic data at render time. The template syntax uses simple variable substitution with optional formatting functions for value transformation.

Template compilation converts template strings into render functions that efficiently generate HTML. The compilation happens once at application initialization, with compiled templates cached for repeated use. This approach balances template flexibility with render performance.

The template system supports conditional sections, iteration over arrays, and nested template inclusion. These capabilities enable complex UI structures while maintaining template readability. The template system integrates with the state management system, automatically re-rendering when bound state changes occur.

### 8.4 Internationalization

The application architecture supports internationalization through string externalization and locale-aware formatting. All user-visible strings are externalized to resource files, enabling translation without code modification. The resource file format uses simple key-value pairs with optional locale suffixes for language variants.

Number and date formatting uses the browser's built-in internationalization APIs with configurable locale settings. Users can select their preferred locale through application settings, with formats adjusting automatically for regional conventions. The formatting system handles currency display, date ordering, and number separator conventions.

The internationalization system supports right-to-left (RTL) language layouts through CSS direction properties and text alignment adjustments. Layout templates include RTL alternatives that activate based on detected or selected language direction. This support ensures the application functions correctly for Arabic, Hebrew, and other RTL languages.

## 9. Security Considerations

### 9.1 Client-Side Data Protection

Since the application operates entirely client-side, data protection focuses on browser-level security features and user awareness. The application does not transmit sensitive assessment data to external servers, ensuring data remains under organizational control. Local storage data persists only on the user's device, protected by browser security sandboxing.

The export functionality can optionally encrypt assessment data using AES encryption. Users provide encryption passwords that derive cryptographic keys using PBKDF2 key derivation. Encrypted exports enable secure sharing of assessment data while maintaining confidentiality. The encryption implementation uses Web Crypto API for performant, secure cryptographic operations.

User awareness features remind users about data sensitivity and appropriate handling practices. Warning dialogs appear before exporting unencrypted data containing sensitive information. Help content addresses data handling best practices for different organizational security contexts.

### 9.2 Input Validation

All user inputs undergo validation to prevent malformed data and potential injection attacks. Text inputs validate character sets and lengths appropriate for their data types. Numeric inputs verify values fall within defined ranges. Select inputs validate that selections match available options.

The validation system sanitizes inputs by escaping special characters that could cause issues in data processing or display. HTML content in user inputs is stripped or escaped to prevent cross-site scripting (XSS) vulnerabilities. The sanitization approach prevents both storage of malicious content and execution of injected scripts.

Validation errors display prominently with specific guidance for correction. Error messages avoid technical jargon that might confuse non-technical users while providing sufficient detail for problem resolution. The validation system maintains a positive user experience while ensuring data quality.

## 10. Testing Strategy

### 10.1 Automated Testing

The Playwright test suite provides automated verification of application functionality. Tests cover critical user journeys including wizard navigation, form submission, chart rendering, and report generation. The test suite runs in headless browser mode for continuous integration while supporting headed mode for debugging.

Test coverage emphasizes user-visible functionality over internal implementation details. This approach ensures tests remain valid as implementation changes while catching regressions in user experience. The test suite maintains separation between test data and test logic, enabling test reuse with different datasets.

Test assertions verify expected outcomes including successful operations, appropriate error handling, and correct data persistence. Assertions check both positive cases (operations succeed) and negative cases (invalid inputs reject). The assertion library provides readable failure messages that accelerate debugging when tests fail.

### 10.2 Manual Testing

Manual testing supplements automated coverage with exploratory testing and user experience evaluation. Test scenarios cover edge cases, browser compatibility, and responsive design behavior. Manual testers document findings in a standard format that supports issue tracking and resolution.

Cross-browser testing verifies functionality across Chrome, Firefox, Safari, and Edge browsers. The test matrix covers both current browser versions and reasonable back-version support where organizations have upgrade constraints. Browser-specific issues are documented with workarounds where possible.

Responsive testing validates application behavior across device sizes from mobile phones to large desktop monitors. Testing confirms that layouts adapt appropriately, touch targets meet mobile sizing guidelines, and data remains accessible on smaller screens. The responsive design uses CSS media queries with consistent breakpoints across the application.

## 11. Maintenance and Support

### 11.1 Configuration Management

The application supports configuration customization through settings panels and configuration files. Settings panels provide runtime configuration for UI preferences, default values, and feature toggles. Configuration files enable deployment-specific settings including organization branding, terminology customization, and integration endpoints.

The configuration system supports environment-specific profiles for development, testing, and production environments. Profile selection can be automatic (based on deployment URL) or manual (user selection). Environment-specific configurations enable appropriate behavior for each deployment context while maintaining a single codebase.

Configuration versioning ensures configuration changes are tracked and can be rolled back if issues arise. The versioning system compares current configuration against previous versions, highlighting changes and enabling selective reversion. Configuration exports provide backup and transfer capability across deployments.

### 11.2 Updates and Upgrades

The application supports incremental updates through the local storage persistence system. New application versions can read previous data formats and migrate to new formats transparently. Migration functions handle schema changes while preserving all previously entered data.

Feature additions use the feature toggle system to enable or disable functionality based on license level or organizational preference. This approach enables phased rollouts and A/B testing of new features. Toggle configuration persists across sessions, ensuring consistent user experience.

Major version upgrades include migration tools that transform assessment data to new formats. Migration documentation provides advance notice of breaking changes, enabling organizations to plan upgrade activities. The upgrade system includes rollback capability if migration issues arise.

### 11.3 Troubleshooting

The application includes diagnostic tools for troubleshooting common issues. The console panel displays application logs with configurable verbosity levels. Users can adjust log levels to capture detailed debugging information or filter for critical errors. Log entries include timestamps, categories, and contextual information.

Data recovery tools address common data integrity issues. The integrity check function scans assessment data for structural problems and missing required values. The repair function attempts automatic correction of common issues. The reset function provides a clean slate while preserving export backups.

Support resources include help documentation, methodology guides, and contact information for technical support. The help system provides context-sensitive guidance based on the current application state. The methodology guides explain business continuity concepts for users new to the discipline.

## 12. Conclusion

The Business Impact Analysis Tool provides a comprehensive, standards-compliant solution for organizations conducting business continuity assessments. The modular architecture supports both initial implementation and long-term evolution, while the intuitive interface enables users across technical skill levels to contribute meaningful analysis.

The detailed documentation in this technical guide supports maintenance, customization, and extension of the application. Organizations can leverage this foundation to build sophisticated business continuity management capabilities that align with ISO 22301:2019 requirements and organizational risk management objectives.

For questions about implementation, customization, or support, refer to the included help documentation within the application or contact the development team through the support channels provided with your deployment package.


--- FILE END: .doc\TECHNICAL_DOCUMENTATION.md ---


--- FILE START: .github\PULL_REQUEST_TEMPLATE.md ---

## Summary

<!-- Brief description of what this PR does -->

## Changes

<!-- List the main changes -->

- 

## Type of Change

- [ ] Bug fix (non-breaking change that fixes an issue)
- [ ] New feature (non-breaking change that adds functionality)
- [ ] Breaking change (fix or feature that would cause existing functionality to change)
- [ ] Refactor (no functional changes)
- [ ] Documentation update

## Checklist

### Before requesting review:

- [ ] I ran `npm run verify` and all checks pass
- [ ] I tested the changes locally
- [ ] I reviewed my own diff for unnecessary changes
- [ ] I added/updated tests if applicable
- [ ] I updated documentation if applicable

### Vibe Check:

- [ ] Core flow works end-to-end
- [ ] UI states (loading, error, empty) are handled
- [ ] No console errors
- [ ] Edge cases considered

## Screenshots (if UI changes)

<!-- Add before/after screenshots -->

## Notes for Reviewers

<!-- Any context that would help reviewers -->



--- FILE END: .github\PULL_REQUEST_TEMPLATE.md ---


--- FILE START: .gitignore ---

# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?


--- FILE END: .gitignore ---


--- FILE START: .gitmessage ---

# <type>(<scope>): <subject>
#
# <body>
#
# <footer>
#
# Types:
#   feat     - New feature
#   fix      - Bug fix
#   docs     - Documentation only
#   style    - Formatting, no code change
#   refactor - Code change that neither fixes a bug nor adds a feature
#   test     - Adding or updating tests
#   chore    - Maintenance tasks
#
# Scope: Component or area affected (optional)
#
# Subject: Imperative mood, no period, max 50 chars
#
# Body: Explain what and why (not how), wrap at 72 chars
#
# Footer: Reference issues, breaking changes
#   Fixes #123
#   BREAKING CHANGE: description


--- FILE END: .gitmessage ---


--- FILE START: CLAUDE.md ---

# Project Instructions

This file provides context for Claude Code. For Cursor users, see `.cursor/rules.md`.

## Stack

- **Framework**: Next.js 16.x
- **Language**: TypeScript (strict mode)
- **React**: 19.x
- **Styling**: Tailwind CSS
- **Testing**: Jest + React Testing Library

## Core Rules

1. **Stay in scope** — Only implement what's explicitly requested
2. **No placeholders** — All code must be production-ready
3. **Verify before coding** — Check current package versions and API compatibility
4. **Minimal changes** — Keep modifications localized and simple
5. **Test everything** — Run lint, typecheck, test, and build before submitting

## Verification Commands

```bash
npm run lint       # ESLint check
npm run typecheck  # TypeScript check
npm test           # Run tests
npm run build      # Production build
npm run verify     # All checks via Lattice
```

## Next.js Guidelines

- Use App Router (`app/` directory)
- Server Components by default, `"use client"` only when needed
- Follow Next.js file conventions: `layout.tsx`, `page.tsx`, `loading.tsx`, `error.tsx`
- Use Next.js Image component for optimized images

## Before Making Changes

1. Restate the scope in one paragraph
2. Identify files to create or modify
3. Check existing patterns in the codebase
4. Verify package versions are current

## After Making Changes

1. Run all verification commands
2. Fix any failures before proceeding
3. Report verification results

## Hard Stops

- If requirements conflict → ask for clarification
- If verification fails → fix before continuing
- If scope is unclear → ask for clarification
- If you can't verify an API or version → ask

---
*Generated by Lattice v0.6.19*


--- FILE END: CLAUDE.md ---


--- FILE START: components.json ---

{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/index.css",
    "baseColor": "zinc",
    "cssVariables": false,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}


--- FILE END: components.json ---


--- FILE START: database_schema.sql ---

-- Business Impact Analysis (BIA) Tool - Multi-tenant Database Schema
-- Target Architecture (PostgreSQL)

-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- 1. Tenants Table
-- Represents distinct organizations using the SaaS platform
CREATE TABLE tenants (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(255) NOT NULL,
    subscription_plan VARCHAR(50) DEFAULT 'free',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 2. Users Table
-- Users belong to a specific tenant
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    tenant_id UUID NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
    email VARCHAR(255) NOT NULL,
    full_name VARCHAR(255),
    role VARCHAR(50) DEFAULT 'analyst', -- e.g., 'admin', 'analyst', 'viewer'
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP WITH TIME ZONE,
    CONSTRAINT uk_tenant_email UNIQUE (tenant_id, email)
);

-- 3. Assessments Table
-- Top-level container for a BIA session. Linked to a tenant.
CREATE TABLE assessments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    tenant_id UUID NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
    created_by UUID REFERENCES users(id) ON DELETE SET NULL,
    name VARCHAR(255) NOT NULL,
    status VARCHAR(50) DEFAULT 'draft', -- 'draft', 'in-review', 'approved'
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 4. Processes Table
-- Business processes being analyzed within an assessment
CREATE TABLE processes (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    assessment_id UUID NOT NULL REFERENCES assessments(id) ON DELETE CASCADE,
    name VARCHAR(255) NOT NULL,
    department VARCHAR(255),
    owner VARCHAR(255),
    description TEXT,
    criticality VARCHAR(50), -- 'critical', 'high', 'medium', 'low'
    status VARCHAR(50) DEFAULT 'draft',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 5. Impact Assessments Table
-- Stores impact scores across different categories for a process
CREATE TABLE impact_assessments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    process_id UUID NOT NULL REFERENCES processes(id) ON DELETE CASCADE,
    category VARCHAR(50) NOT NULL, -- 'financial', 'operational', 'reputational', 'legal', etc.
    score INTEGER NOT NULL CHECK (score >= 0 AND score <= 5),
    justification TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uk_process_category UNIQUE (process_id, category)
);

-- 6. Recovery Objectives Table
-- Defines RTO, RPO, and MTPD for a process
CREATE TABLE recovery_objectives (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    process_id UUID NOT NULL REFERENCES processes(id) ON DELETE CASCADE,
    mtpd_hours INTEGER,
    rto_hours INTEGER,
    rpo_hours INTEGER,
    mbco_flag BOOLEAN DEFAULT FALSE,
    recovery_strategy VARCHAR(100), -- 'warm-standby', 'manual', etc.
    strategy_notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 7. Dependencies Table
-- Links processes to indicate dependencies (Process A depends on Process B)
CREATE TABLE dependencies (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    assessment_id UUID NOT NULL REFERENCES assessments(id) ON DELETE CASCADE,
    source_process_id UUID NOT NULL REFERENCES processes(id) ON DELETE CASCADE,
    target_process_id UUID NOT NULL REFERENCES processes(id) ON DELETE CASCADE,
    dependency_type VARCHAR(50), -- 'technical', 'operational', 'resource'
    criticality INTEGER CHECK (criticality >= 1 AND criticality <= 5),
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uk_source_target UNIQUE (source_process_id, target_process_id)
);

-- 8. Audit Logs Table (Optional but recommended for SaaS)
-- Tracks actions within a tenant
CREATE TABLE audit_logs (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    tenant_id UUID NOT NULL REFERENCES tenants(id) ON DELETE CASCADE,
    user_id UUID REFERENCES users(id) ON DELETE SET NULL,
    action VARCHAR(100) NOT NULL,
    entity_type VARCHAR(50),
    entity_id UUID,
    details JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- Indexes for performance
CREATE INDEX idx_users_tenant ON users(tenant_id);
CREATE INDEX idx_assessments_tenant ON assessments(tenant_id);
CREATE INDEX idx_processes_assessment ON processes(assessment_id);
CREATE INDEX idx_impacts_process ON impact_assessments(process_id);


--- FILE END: database_schema.sql ---


--- FILE START: eslint.config.js ---

import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'

export default tseslint.config(
  { ignores: ['dist'] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ['**/*.{ts,tsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
      '@typescript-eslint/no-unused-vars': 'off',
      '@typescript-eslint/no-explicit-any': 'off',
    },
  },
)


--- FILE END: eslint.config.js ---


--- FILE START: eslint.config.mjs ---

import tseslint from '@typescript-eslint/eslint-plugin';
import tsparser from '@typescript-eslint/parser';

export default [
  {
    ignores: ['.next/**', 'node_modules/**', 'dist/**'],
  },
  {
    files: ['**/*.{js,jsx,ts,tsx}'],
    languageOptions: {
      parser: tsparser,
      parserOptions: {
        ecmaVersion: 'latest',
        sourceType: 'module',
        ecmaFeatures: {
          jsx: true,
        },
      },
    },
    plugins: {
      '@typescript-eslint': tseslint,
    },
    rules: {
      '@typescript-eslint/no-unused-vars': 'warn',
    },
  },
];


--- FILE END: eslint.config.mjs ---


--- FILE START: index.html ---

<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>


--- FILE END: index.html ---


--- FILE START: package.json ---

{
  "name": "react_repo",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "npm install && vite",
    "build": "npm install && rm -rf node_modules/.vite-temp && vite build",
    "build:prod": "npm install && rm -rf node_modules/.vite-temp && tsc -b && BUILD_MODE=prod vite build",
    "lint": "npm install && eslint .",
    "preview": "npm install && vite preview",
    "install-deps": "npm install",
    "clean": "rm -rf node_modules .pnpm-store pnpm-lock.yaml",
    "typecheck": "tsc --noEmit",
    "test": "jest --passWithNoTests",
    "verify": "npx latticeai verify",
    "release-check": "npx latticeai release-check"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.10.0",
    "@radix-ui/react-accordion": "^1.2.2",
    "@radix-ui/react-alert-dialog": "^1.1.4",
    "@radix-ui/react-aspect-ratio": "^1.1.1",
    "@radix-ui/react-avatar": "^1.1.2",
    "@radix-ui/react-checkbox": "^1.1.3",
    "@radix-ui/react-collapsible": "^1.1.2",
    "@radix-ui/react-context-menu": "^2.2.4",
    "@radix-ui/react-dialog": "^1.1.4",
    "@radix-ui/react-dropdown-menu": "^2.1.4",
    "@radix-ui/react-hover-card": "^1.1.4",
    "@radix-ui/react-label": "^2.1.1",
    "@radix-ui/react-menubar": "^1.1.4",
    "@radix-ui/react-navigation-menu": "^1.2.3",
    "@radix-ui/react-popover": "^1.1.4",
    "@radix-ui/react-progress": "^1.1.1",
    "@radix-ui/react-radio-group": "^1.2.2",
    "@radix-ui/react-scroll-area": "^1.2.2",
    "@radix-ui/react-select": "^2.1.4",
    "@radix-ui/react-separator": "^1.1.1",
    "@radix-ui/react-slider": "^1.2.2",
    "@radix-ui/react-slot": "^1.1.1",
    "@radix-ui/react-switch": "^1.1.2",
    "@radix-ui/react-tabs": "^1.1.2",
    "@radix-ui/react-toast": "^1.2.4",
    "@radix-ui/react-toggle": "^1.1.1",
    "@radix-ui/react-toggle-group": "^1.1.1",
    "@radix-ui/react-tooltip": "^1.1.6",
    "@xyflow/react": "^12.10.0",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "1.0.0",
    "date-fns": "^3.0.0",
    "embla-carousel-react": "^8.5.2",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.364.0",
    "next-themes": "^0.4.4",
    "playwright": "1.57.0",
    "react": "^18.3.1",
    "react-day-picker": "8.10.1",
    "react-dom": "^18.3.1",
    "react-hook-form": "^7.54.2",
    "react-resizable-panels": "^2.1.7",
    "react-router-dom": "^6",
    "recharts": "^2.12.4",
    "sonner": "^1.7.2",
    "tailwind-merge": "^2.6.0",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^1.1.2",
    "zod": "^3.24.1",
    "zustand": "^5.0.9"
  },
  "devDependencies": {
    "@eslint/js": "^9.15.0",
    "@types/node": "^22.10.7",
    "@types/react": "^18.3.12",
    "@types/react-dom": "^18.3.1",
    "@types/react-router-dom": "^5",
    "@vitejs/plugin-react": "^4.3.4",
    "autoprefixer": "10.4.20",
    "eslint": "^9.15.0",
    "eslint-plugin-react-hooks": "^5.0.0",
    "eslint-plugin-react-refresh": "^0.4.14",
    "globals": "^15.12.0",
    "postcss": "8.4.49",
    "tailwindcss": "v3.4.16",
    "typescript": "~5.6.2",
    "typescript-eslint": "^8.15.0",
    "vite": "^6.0.1",
    "vite-plugin-source-identifier": "1.1.2"
  }
}


--- FILE END: package.json ---


--- FILE START: postcss.config.js ---

export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}


--- FILE END: postcss.config.js ---


--- FILE START: public\use.txt ---

keep assets in the dir to use.


--- FILE END: public\use.txt ---


--- FILE START: README.md ---

# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react/README.md) uses [Babel](https://babeljs.io/) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type aware lint rules:

- Configure the top-level `parserOptions` property like this:

```js
export default tseslint.config({
  languageOptions: {
    // other options...
    parserOptions: {
      project: ['./tsconfig.node.json', './tsconfig.app.json'],
      tsconfigRootDir: import.meta.dirname,
    },
  },
})
```

- Replace `tseslint.configs.recommended` to `tseslint.configs.recommendedTypeChecked` or `tseslint.configs.strictTypeChecked`
- Optionally add `...tseslint.configs.stylisticTypeChecked`
- Install [eslint-plugin-react](https://github.com/jsx-eslint/eslint-plugin-react) and update the config:

```js
// eslint.config.js
import react from 'eslint-plugin-react'

export default tseslint.config({
  // Set the react version
  settings: { react: { version: '18.3' } },
  plugins: {
    // Add the react plugin
    react,
  },
  rules: {
    // other rules...
    // Enable its recommended rules
    ...react.configs.recommended.rules,
    ...react.configs['jsx-runtime'].rules,
  },
})
```


--- FILE END: README.md ---


--- FILE START: src\App.css ---

#root {
  margin: 0 auto;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}

.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}

.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}


--- FILE END: src\App.css ---


--- FILE START: src\App.tsx ---

import { useStore } from './store/useStore';
import { Sidebar } from './components/Sidebar';
import { Dashboard } from './components/Dashboard';
import { ProcessRegistry } from './components/ProcessRegistry';

import { RecoveryObjectives } from './components/RecoveryObjectives';
import { Reports } from './components/Reports';
import { TemporalAnalysis } from './components/TemporalAnalysis';
import { Dependencies } from './components/Dependencies';
import { ProcessDependencies } from './components/ProcessDependencies';
import { Settings } from './components/Settings';
import { GlossaryModal } from './components/GlossaryModal';

function App() {
  const { currentView, sidebarCollapsed } = useStore();

  const renderView = () => {
    switch (currentView) {
      case 'dashboard': return <Dashboard />;
      case 'processes': return <ProcessRegistry />;

      case 'temporal': return <TemporalAnalysis />;
      case 'process-deps': return <ProcessDependencies />;
      case 'dependencies': return <Dependencies />;
      case 'recovery': return <RecoveryObjectives />;
      case 'reports': return <Reports />;
      case 'settings': return <Settings />;
      default: return <Dashboard />;
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-bia-bg-start to-bia-bg-end">
      <Sidebar />
      <main className={`transition-all duration-300 ${sidebarCollapsed ? 'ml-16' : 'ml-64'} p-8`}>
        {renderView()}
      </main>
      <GlossaryModal />
    </div>
  );
}

export default App;


--- FILE END: src\App.tsx ---


--- FILE START: src\components\Dashboard.tsx ---

import { useStore } from '../store/useStore';
import { DEFAULT_IMPACT_CATEGORIES } from '../types';
import { PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, Radar } from 'recharts';
import { AlertTriangle, Activity, Shield, TrendingUp } from 'lucide-react';

export function Dashboard() {
  const { processes, temporalData, settings } = useStore();
  const categories = settings.impactCategories || DEFAULT_IMPACT_CATEGORIES;

  // Derive max impact per category from temporal data
  const getMaxImpactPerCategory = (processId: string): Record<string, number> => {
    const data = temporalData[processId] as Record<string, number | string>[] | undefined;
    if (!data || data.length === 0) return {};
    const maxImpacts: Record<string, number> = {};
    categories.forEach(cat => {
      maxImpacts[cat.id] = Math.max(...data.map(d => (d[cat.id] as number) || 0));
    });
    return maxImpacts;
  };

  // Calculate risk score from temporal data (weighted avg of max impacts)
  const calculateRiskScore = (processId: string): number => {
    const maxImpacts = getMaxImpactPerCategory(processId);
    let total = 0, weightSum = 0;
    categories.forEach(cat => {
      total += (maxImpacts[cat.id] || 0) * cat.weight;
      weightSum += cat.weight;
    });
    return weightSum > 0 ? parseFloat((total / weightSum).toFixed(2)) : 0;
  };

  const criticalCount = processes.filter(p => p.criticality === 'critical').length;
  const highCount = processes.filter(p => p.criticality === 'high').length;
  const avgRiskScore = processes.length > 0
    ? (processes.reduce((acc, p) => acc + calculateRiskScore(p.id), 0) / processes.length).toFixed(2)
    : 0;

  const criticalityData = [
    { name: 'Critical', value: criticalCount, color: '#F87171' },
    { name: 'High', value: highCount, color: '#FBBF24' },
    { name: 'Medium', value: processes.filter(p => p.criticality === 'medium').length, color: '#60A5FA' },
    { name: 'Low', value: processes.filter(p => p.criticality === 'low' || p.criticality === 'minimal').length, color: '#34D399' },
  ].filter(d => d.value > 0);

  const deptRiskData = Object.entries(
    processes.reduce((acc, p) => {
      const dept = p.department;
      if (!acc[dept]) acc[dept] = { department: dept, risk: 0, count: 0 };
      acc[dept].risk += calculateRiskScore(p.id);
      acc[dept].count += 1;
      return acc;
    }, {} as Record<string, { department: string; risk: number; count: number }>)
  ).map(([_, v]) => ({ ...v, avgRisk: parseFloat((v.risk / v.count).toFixed(2)) }));

  // Aggregate max impacts across all processes for radar
  const aggregateMaxImpacts = processes.reduce((acc, p) => {
    const maxImpacts = getMaxImpactPerCategory(p.id);
    categories.forEach(cat => {
      acc[cat.id] = (acc[cat.id] || 0) + (maxImpacts[cat.id] || 0);
    });
    return acc;
  }, {} as Record<string, number>);

  const radarData = categories.map(cat => ({
    dimension: cat.name,
    value: processes.length > 0 ? (aggregateMaxImpacts[cat.id] || 0) / processes.length : 0,
    max: 5,
  }));

  const kpis = [
    { label: 'Total Processes', value: processes.length, icon: Activity, color: 'text-bia-primary', trend: '+2 this week' },
    { label: 'Critical Processes', value: criticalCount, icon: AlertTriangle, color: 'text-bia-critical', trend: 'High Priority' },
    { label: 'Avg Impact Score', value: avgRiskScore, icon: TrendingUp, color: 'text-bia-warning', trend: 'Weighted Avg' },
    { label: 'Compliant', value: `${Math.round((processes.filter(p => p.status === 'approved').length / processes.length) * 100) || 0}%`, icon: Shield, color: 'text-bia-success', trend: 'Target: 95%' },
  ];

  const CustomTooltip = ({ active, payload, label }: any) => {
    if (active && payload && payload.length) {
      return (
        <div className="bg-slate-900/90 backdrop-blur-md border border-white/10 p-3 rounded-lg shadow-xl">
          <p className="text-white font-medium text-sm mb-1">{label || payload[0].name}</p>
          <div className="space-y-1">
            {payload.map((entry: any, index: number) => (
              <div key={index} className="flex items-center gap-2">
                <div className="w-2 h-2 rounded-full" style={{ backgroundColor: entry.color || entry.fill }} />
                <span className="text-slate-300 text-xs">
                  {entry.name}: <span className="text-white font-bold">{entry.value}</span>
                </span>
              </div>
            ))}
          </div>
        </div>
      );
    }
    return null;
  };

  return (
    <div className="animate-fade-in space-y-6">
      {/* Chart Gradients */}
      <svg width="0" height="0" className="absolute">
        <defs>
          <linearGradient id="gradientPrimary" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stopColor="#38BDF8" stopOpacity={0.8} />
            <stop offset="100%" stopColor="#38BDF8" stopOpacity={0.2} />
          </linearGradient>
          <linearGradient id="gradientSecondary" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stopColor="#818CF8" stopOpacity={0.8} />
            <stop offset="100%" stopColor="#818CF8" stopOpacity={0.2} />
          </linearGradient>
          <linearGradient id="gradientCritical" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stopColor="#F87171" stopOpacity={1} />
            <stop offset="100%" stopColor="#EF4444" stopOpacity={0.8} />
          </linearGradient>
        </defs>
      </svg>

      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary tracking-tight">Executive Dashboard</h1>
          <p className="text-bia-text-secondary mt-1">Real-time Business Impact Analysis Intelligence</p>
        </div>
      </div>

      {/* KPI Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {kpis.map((kpi, idx) => (
          <div key={idx} className="glass-panel-hover p-6 group">
            <div className="flex items-start justify-between">
              <div>
                <p className="text-bia-text-secondary text-sm font-medium">{kpi.label}</p>
                <p className={`text-4xl font-bold mt-2 tracking-tighter ${kpi.color}`}>{kpi.value}</p>
                <p className="text-[10px] text-bia-text-tertiary mt-2 uppercase tracking-widest font-bold opacity-0 group-hover:opacity-100 transition-opacity">
                  {kpi.trend}
                </p>
              </div>
              <div className={`p-3 rounded-bia-md bg-white/5 group-hover:bg-white/10 transition-colors`}>
                <kpi.icon className={`w-6 h-6 ${kpi.color}`} />
              </div>
            </div>
          </div>
        ))}
      </div>

      {/* Charts Row */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Risk Distribution Pie */}
        <div className="glass-panel p-6">
          <h3 className="text-sm font-bold text-bia-text-secondary uppercase tracking-widest mb-6">Criticality Distribution</h3>
          <ResponsiveContainer width="100%" height={240}>
            <PieChart>
              <Pie
                data={criticalityData}
                cx="50%"
                cy="50%"
                innerRadius={60}
                outerRadius={90}
                paddingAngle={5}
                dataKey="value"
                stroke="none"
              >
                {criticalityData.map((entry, i) => (
                  <Cell key={i} fill={entry.color} />
                ))}
              </Pie>
              <Tooltip content={<CustomTooltip />} />
            </PieChart>
          </ResponsiveContainer>
          <div className="flex flex-wrap justify-center gap-4 mt-2">
            {criticalityData.map((d, i) => (
              <div key={i} className="flex items-center gap-1.5">
                <div className="w-2.5 h-2.5 rounded-full" style={{ backgroundColor: d.color }} />
                <span className="text-[10px] text-bia-text-secondary font-medium">{d.name}</span>
              </div>
            ))}
          </div>
        </div>

        {/* Risk by Department */}
        <div className="glass-panel p-6">
          <h3 className="text-sm font-bold text-bia-text-secondary uppercase tracking-widest mb-6">Impact by Department</h3>
          <ResponsiveContainer width="100%" height={240}>
            <BarChart data={deptRiskData} layout="vertical" margin={{ left: -20, right: 20 }}>
              <XAxis type="number" domain={[0, 5]} hide />
              <YAxis
                type="category"
                dataKey="department"
                stroke="#64748B"
                width={100}
                tick={{ fontSize: 11, fontWeight: 500 }}
                axisLine={false}
                tickLine={false}
              />
              <Tooltip content={<CustomTooltip />} cursor={{ fill: 'rgba(255,255,255,0.05)' }} />
              <Bar dataKey="avgRisk" fill="url(#gradientPrimary)" radius={[0, 4, 4, 0]} barSize={24} />
            </BarChart>
          </ResponsiveContainer>
        </div>

        {/* Impact Radar */}
        <div className="glass-panel p-6">
          <h3 className="text-sm font-bold text-bia-text-secondary uppercase tracking-widest mb-6">Impact Profile</h3>
          <ResponsiveContainer width="100%" height={240}>
            <RadarChart data={radarData}>
              <PolarGrid stroke="rgba(255,255,255,0.05)" />
              <PolarAngleAxis dataKey="dimension" stroke="#64748B" tick={{ fontSize: 10, fontWeight: 600 }} />
              <Radar
                name="Impact"
                dataKey="value"
                stroke="#818CF8"
                fill="url(#gradientSecondary)"
                fillOpacity={0.6}
                strokeWidth={2}
              />
              <Tooltip content={<CustomTooltip />} />
            </RadarChart>
          </ResponsiveContainer>
        </div>
      </div>

      {/* Recent Processes */}
      <div className="glass-panel p-6">
        <h3 className="text-lg font-semibold text-bia-text-primary mb-4">Process Impact Summary</h3>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="text-left text-xs text-bia-text-secondary uppercase tracking-wider">
                <th className="pb-3">Process</th>
                <th className="pb-3">Department</th>
                <th className="pb-3">Criticality</th>
                <th className="pb-3">Impact Score</th>
                <th className="pb-3">Status</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-[rgba(255,255,255,0.05)]">
              {processes.slice(0, 5).map((proc) => {
                const score = calculateRiskScore(proc.id);
                return (
                  <tr key={proc.id} className="hover:bg-[rgba(255,255,255,0.02)]">
                    <td className="py-3 text-bia-text-primary font-medium">{proc.name}</td>
                    <td className="py-3 text-bia-text-secondary">{proc.department}</td>
                    <td className="py-3">
                      <span className={`px-2 py-1 rounded-full text-xs font-medium criticality-${proc.criticality}`}>
                        {proc.criticality}
                      </span>
                    </td>
                    <td className="py-3">
                      <span className={`font-bold ${score >= 4 ? 'text-bia-critical' : score >= 3 ? 'text-bia-warning' : 'text-bia-text-primary'}`}>
                        {score}
                      </span>
                    </td>
                    <td className="py-3">
                      <span className={`px-2 py-1 rounded text-xs ${proc.status === 'approved' ? 'bg-bia-success/20 text-bia-success' : proc.status === 'in-review' ? 'bg-bia-warning/20 text-bia-warning' : 'bg-bia-text-tertiary/20 text-bia-text-tertiary'}`}>
                        {proc.status}
                      </span>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}


--- FILE END: src\components\Dashboard.tsx ---


--- FILE START: src\components\Dependencies.tsx ---

import { useState } from 'react';
import { useStore } from '../store/useStore';
import { Dependency, DependencyType } from '../types';
import { Plus, Trash2, AlertTriangle, ArrowRight, X } from 'lucide-react';

const DEP_TYPES: DependencyType[] = ['technical', 'operational', 'resource'];
const DEP_COLORS = { technical: 'text-bia-primary', operational: 'text-bia-warning', resource: 'text-bia-secondary' };

export function Dependencies() {
  const { processes, dependencies, addDependency, removeDependency, getDependenciesForProcess } = useStore();
  const [showModal, setShowModal] = useState(false);
  const [form, setForm] = useState({ sourceProcessId: '', targetProcessId: '', type: 'technical' as DependencyType, criticality: 3, description: '' });

  const handleAdd = () => {
    if (form.sourceProcessId && form.targetProcessId && form.sourceProcessId !== form.targetProcessId) {
      addDependency({ ...form, id: `DEP-${Date.now()}` });
      setShowModal(false);
      setForm({ sourceProcessId: '', targetProcessId: '', type: 'technical', criticality: 3, description: '' });
    }
  };

  // Find single points of failure (processes with many downstream dependencies)
  const spofProcesses = processes.filter((p) => {
    const downstream = dependencies.filter((d) => d.targetProcessId === p.id);
    return downstream.length >= 2;
  });

  // Group dependencies by source for visualization
  const depsBySource = processes.map((p) => ({
    process: p,
    upstream: dependencies.filter((d) => d.sourceProcessId === p.id),
    downstream: dependencies.filter((d) => d.targetProcessId === p.id)
  }));

  const getProcessName = (id: string) => processes.find((p) => p.id === id)?.name || id;

  return (
    <div className="animate-fade-in space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Dependency Analysis</h1>
          <p className="text-bia-text-secondary mt-1">Map process dependencies and identify cascading risks</p>
        </div>
        <button onClick={() => setShowModal(true)} className="glass-button-solid flex items-center gap-2">
          <Plus className="w-4 h-4" /> Add Dependency
        </button>
      </div>

      {/* SPOF Warning */}
      {spofProcesses.length > 0 && (
        <div className="glass-panel p-4 border-l-4 border-bia-critical">
          <div className="flex items-center gap-2 text-bia-critical mb-2">
            <AlertTriangle className="w-5 h-5" />
            <span className="font-semibold">Single Points of Failure Detected</span>
          </div>
          <div className="flex flex-wrap gap-2">
            {spofProcesses.map((p) => (
              <span key={p.id} className="px-2 py-1 bg-bia-critical/20 text-bia-critical rounded text-sm">{p.name}</span>
            ))}
          </div>
        </div>
      )}

      {/* Dependency Network Visualization */}
      <div className="glass-panel p-6">
        <h3 className="text-lg font-semibold text-bia-text-primary mb-4">Dependency Network</h3>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {depsBySource.filter((d) => d.upstream.length > 0 || d.downstream.length > 0).map(({ process, upstream, downstream }) => (
            <div key={process.id} className="glass-panel p-4 space-y-3">
              <h4 className="font-semibold text-bia-text-primary">{process.name}</h4>
              {upstream.length > 0 && (
                <div>
                  <p className="text-xs text-bia-text-tertiary mb-1">Depends on:</p>
                  {upstream.map((dep) => (
                    <div key={dep.id} className="flex items-center gap-2 text-sm">
                      <ArrowRight className="w-3 h-3 text-bia-text-tertiary" />
                      <span className={DEP_COLORS[dep.type]}>{getProcessName(dep.targetProcessId)}</span>
                      <span className="text-xs text-bia-text-tertiary">({dep.type})</span>
                    </div>
                  ))}
                </div>
              )}
              {downstream.length > 0 && (
                <div>
                  <p className="text-xs text-bia-text-tertiary mb-1">Required by:</p>
                  {downstream.map((dep) => (
                    <div key={dep.id} className="flex items-center gap-2 text-sm">
                      <ArrowRight className="w-3 h-3 text-bia-success rotate-180" />
                      <span className="text-bia-success">{getProcessName(dep.sourceProcessId)}</span>
                    </div>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      </div>

      {/* Dependency Table */}
      <div className="glass-panel p-6">
        <h3 className="text-lg font-semibold text-bia-text-primary mb-4">All Dependencies</h3>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-black/20">
              <tr className="text-left text-xs text-bia-text-secondary uppercase">
                <th className="p-3">Source Process</th>
                <th className="p-3">Depends On</th>
                <th className="p-3">Type</th>
                <th className="p-3">Criticality</th>
                <th className="p-3">Description</th>
                <th className="p-3">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-bia-border">
              {dependencies.map((dep) => (
                <tr key={dep.id} className="hover:bg-bia-glass-hover">
                  <td className="p-3 text-bia-text-primary">{getProcessName(dep.sourceProcessId)}</td>
                  <td className="p-3 text-bia-text-primary">{getProcessName(dep.targetProcessId)}</td>
                  <td className="p-3"><span className={`px-2 py-1 rounded text-xs ${DEP_COLORS[dep.type]}`}>{dep.type}</span></td>
                  <td className="p-3 text-bia-text-primary">{dep.criticality}/5</td>
                  <td className="p-3 text-bia-text-secondary text-sm">{dep.description}</td>
                  <td className="p-3">
                    <button onClick={() => removeDependency(dep.id)} className="p-1 hover:bg-bia-critical/20 rounded">
                      <Trash2 className="w-4 h-4 text-bia-critical" />
                    </button>
                  </td>
                </tr>
              ))}
              {dependencies.length === 0 && (
                <tr><td colSpan={6} className="p-8 text-center text-bia-text-tertiary">No dependencies defined</td></tr>
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Add Modal */}
      {showModal && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in">
          <div className="glass-panel p-6 w-full max-w-lg animate-scale-in">
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-xl font-semibold text-bia-text-primary">Add Dependency</h2>
              <button onClick={() => setShowModal(false)}><X className="w-5 h-5 text-bia-text-secondary" /></button>
            </div>
            <div className="space-y-4">
              <div>
                <label className="block text-sm text-bia-text-secondary mb-1">Source Process (depends on target)</label>
                <select className="glass-input w-full" value={form.sourceProcessId} onChange={(e) => setForm({ ...form, sourceProcessId: e.target.value })}>
                  <option value="">Select process...</option>
                  {processes.map((p) => <option key={p.id} value={p.id}>{p.name}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm text-bia-text-secondary mb-1">Target Process (required by source)</label>
                <select className="glass-input w-full" value={form.targetProcessId} onChange={(e) => setForm({ ...form, targetProcessId: e.target.value })}>
                  <option value="">Select process...</option>
                  {processes.filter((p) => p.id !== form.sourceProcessId).map((p) => <option key={p.id} value={p.id}>{p.name}</option>)}
                </select>
              </div>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm text-bia-text-secondary mb-1">Type</label>
                  <select className="glass-input w-full" value={form.type} onChange={(e) => setForm({ ...form, type: e.target.value as DependencyType })}>
                    {DEP_TYPES.map((t) => <option key={t} value={t}>{t}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-sm text-bia-text-secondary mb-1">Criticality (1-5)</label>
                  <input type="number" min="1" max="5" className="glass-input w-full" value={form.criticality} onChange={(e) => setForm({ ...form, criticality: parseInt(e.target.value) })} />
                </div>
              </div>
              <div>
                <label className="block text-sm text-bia-text-secondary mb-1">Description</label>
                <textarea className="glass-input w-full h-20" value={form.description} onChange={(e) => setForm({ ...form, description: e.target.value })} />
              </div>
              <div className="flex justify-end gap-3">
                <button onClick={() => setShowModal(false)} className="glass-button">Cancel</button>
                <button onClick={handleAdd} className="glass-button-solid">Add Dependency</button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


--- FILE END: src\components\Dependencies.tsx ---


--- FILE START: src\components\ErrorBoundary.tsx ---

import React from 'react';

const searilizeError = (error: any) => {
  if (error instanceof Error) {
    return error.message + '\n' + error.stack;
  }
  return JSON.stringify(error, null, 2);
};

export class ErrorBoundary extends React.Component<
  { children: React.ReactNode },
  { hasError: boolean; error: any }
> {
  constructor(props: { children: React.ReactNode }) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: any) {
    return { hasError: true, error };
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="p-4 border border-red-500 rounded">
          <h2 className="text-red-500">Something went wrong.</h2>
          <pre className="mt-2 text-sm">{searilizeError(this.state.error)}</pre>
        </div>
      );
    }

    return this.props.children;
  }
}


--- FILE END: src\components\ErrorBoundary.tsx ---


--- FILE START: src\components\GlossaryModal.tsx ---

import { useStore } from '../store/useStore';
import { GLOSSARY } from '../types';
import { X, BookOpen, ExternalLink } from 'lucide-react';

export function GlossaryModal() {
  const { showGlossary, toggleGlossary } = useStore();

  if (!showGlossary) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in">
      <div className="glass-panel p-6 w-full max-w-2xl max-h-[80vh] overflow-auto animate-scale-in">
        <div className="flex justify-between items-center mb-6 sticky top-0 bg-bia-glass pb-4">
          <h2 className="text-xl font-semibold text-bia-text-primary flex items-center gap-2">
            <BookOpen className="w-5 h-5 text-bia-primary" /> BIA Glossary
          </h2>
          <button onClick={toggleGlossary} className="p-2 hover:bg-bia-glass-hover rounded-lg">
            <X className="w-5 h-5 text-bia-text-secondary" />
          </button>
        </div>

        <div className="space-y-4">
          {Object.entries(GLOSSARY).map(([key, { term, definition, isoRef }]) => (
            <div key={key} className="p-4 rounded-bia-md bg-black/20 border border-bia-border">
              <div className="flex items-start justify-between">
                <div>
                  <span className="text-bia-primary font-mono font-semibold">{key}</span>
                  <h4 className="text-bia-text-primary font-medium mt-1">{term}</h4>
                </div>
              </div>
              <p className="text-bia-text-secondary text-sm mt-2">{definition}</p>
              <p className="text-bia-text-tertiary text-xs mt-2 flex items-center gap-1">
                <ExternalLink className="w-3 h-3" /> {isoRef}
              </p>
            </div>
          ))}
        </div>

        <div className="mt-6 p-4 rounded-bia-md bg-bia-primary/10 border border-bia-primary/30">
          <h4 className="text-bia-primary font-medium">About ISO 22301:2019</h4>
          <p className="text-sm text-bia-text-secondary mt-2">
            ISO 22301:2019 specifies requirements for setting up and managing an effective Business Continuity Management System (BCMS). 
            It is designed to protect against, reduce the likelihood of, and ensure recovery from disruptive incidents.
          </p>
        </div>
      </div>
    </div>
  );
}


--- FILE END: src\components\GlossaryModal.tsx ---


--- FILE START: src\components\ImpactAssessment.tsx ---

import { useState, useEffect } from 'react';
import { useStore } from '../store/useStore';
import { DEFAULT_IMPACT_CATEGORIES } from '../types';
import { RadarChart, PolarGrid, PolarAngleAxis, Radar, ResponsiveContainer, Tooltip } from 'recharts';
import { ChevronLeft, Save, Info } from 'lucide-react';

export function ImpactAssessment() {
  const { processes, selectedProcessId, setSelectedProcessId, impacts, updateImpact, getProcessById, settings } = useStore();
  const [localImpact, setLocalImpact] = useState<Record<string, number>>({});
  const [saved, setSaved] = useState(false);
  const [hoveredCategory, setHoveredCategory] = useState<string | null>(null);

  const process = selectedProcessId ? getProcessById(selectedProcessId) : null;
  const categories = settings.impactCategories || DEFAULT_IMPACT_CATEGORIES;

  useEffect(() => {
    if (selectedProcessId && impacts[selectedProcessId]) {
      setLocalImpact(impacts[selectedProcessId] as unknown as Record<string, number>);
    } else {
      // Initialize with zeros for all categories
      const initial: Record<string, number> = {};
      categories.forEach(c => initial[c.id] = 0);
      setLocalImpact(initial);
    }
  }, [selectedProcessId, impacts, categories]);

  const handleSliderChange = (key: string, value: number) => {
    setLocalImpact({ ...localImpact, [key]: value });
    setSaved(false);
  };

  const handleSave = () => {
    if (selectedProcessId) {
      updateImpact(selectedProcessId, localImpact as any);
      setSaved(true);
      setTimeout(() => setSaved(false), 2000);
    }
  };

  const radarData = categories.map(c => ({
    dimension: c.name,
    value: localImpact[c.id] || 0,
    fullMark: 5,
  }));

  const getScoreColor = (score: number) => {
    if (score >= 4) return 'text-bia-critical';
    if (score >= 3) return 'text-bia-warning';
    if (score >= 2) return 'text-bia-info';
    return 'text-bia-success';
  };

  const getTimeBasedHint = (categoryId: string, score: number) => {
    const category = categories.find(c => c.id === categoryId);
    if (!category || score === 0) return null;
    // Find appropriate definition based on score
    const timeline = settings.customTimelinePoints || [];
    const defIndex = Math.min(score, category.timeBasedDefinitions.length - 1);
    return category.timeBasedDefinitions[defIndex]?.description;
  };

  if (!selectedProcessId) {
    return (
      <div className="animate-fade-in space-y-6">
        <h1 className="text-3xl font-bold text-bia-text-primary">Impact Assessment</h1>
        <p className="text-bia-text-secondary">Select a process to assess its business impact</p>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {processes.map((p) => (
            <button key={p.id} onClick={() => setSelectedProcessId(p.id)} className="glass-panel-hover p-6 text-left">
              <h3 className="text-lg font-semibold text-bia-text-primary">{p.name}</h3>
              <p className="text-sm text-bia-text-secondary mt-1">{p.department}</p>
              <div className="flex items-center gap-2 mt-3">
                <span className={`px-2 py-1 rounded-full text-xs font-medium criticality-${p.criticality}`}>{p.criticality}</span>
              </div>
            </button>
          ))}
        </div>
      </div>
    );
  }

  return (
    <div className="animate-fade-in space-y-6">
      <div className="flex items-center gap-4">
        <button onClick={() => setSelectedProcessId(null)} className="p-2 hover:bg-bia-glass-hover rounded-lg transition-colors">
          <ChevronLeft className="w-5 h-5 text-bia-text-secondary" />
        </button>
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Impact Assessment</h1>
          <p className="text-bia-text-secondary mt-1">Assessing: {process?.name}</p>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Sliders */}
        <div className="glass-panel p-6 space-y-6">
          <h2 className="text-xl font-semibold text-bia-text-primary">Impact Dimensions</h2>
          {categories.map((cat) => (
            <div key={cat.id} className="space-y-2" onMouseEnter={() => setHoveredCategory(cat.id)} onMouseLeave={() => setHoveredCategory(null)}>
              <div className="flex justify-between items-center">
                <div className="flex items-center gap-2">
                  <div className="w-3 h-3 rounded" style={{ backgroundColor: cat.color }} />
                  <div>
                    <label className="text-bia-text-primary font-medium">{cat.name}</label>
                    <p className="text-xs text-bia-text-tertiary">{cat.description}</p>
                  </div>
                </div>
                <span className={`text-2xl font-bold ${getScoreColor(localImpact[cat.id] || 0)}`}>{localImpact[cat.id] || 0}</span>
              </div>
              <input
                type="range"
                min="0"
                max="5"
                step="1"
                value={localImpact[cat.id] || 0}
                onChange={(e) => handleSliderChange(cat.id, parseInt(e.target.value))}
                className="w-full h-2 bg-[rgba(255,255,255,0.1)] rounded-lg appearance-none cursor-pointer accent-bia-primary"
              />
              <div className="flex justify-between text-xs text-bia-text-tertiary">
                <span>None</span>
                <span>Low</span>
                <span>Medium</span>
                <span>High</span>
                <span>Critical</span>
                <span>Severe</span>
              </div>
              {/* Time-based hint */}
              {hoveredCategory === cat.id && getTimeBasedHint(cat.id, localImpact[cat.id] || 0) && (
                <div className="flex items-start gap-2 p-2 bg-black/30 rounded text-xs text-bia-text-secondary">
                  <Info className="w-4 h-4 shrink-0 mt-0.5" />
                  <span>{getTimeBasedHint(cat.id, localImpact[cat.id] || 0)}</span>
                </div>
              )}
            </div>
          ))}
          <button onClick={handleSave} className="glass-button-solid w-full flex items-center justify-center gap-2">
            <Save className="w-4 h-4" />
            {saved ? 'Saved!' : 'Save Assessment'}
          </button>
        </div>

        {/* Radar Chart */}
        <div className="glass-panel p-6">
          <h2 className="text-xl font-semibold text-bia-text-primary mb-4">Impact Profile</h2>
          <ResponsiveContainer width="100%" height={350}>
            <RadarChart data={radarData}>
              <PolarGrid stroke="rgba(255,255,255,0.1)" />
              <PolarAngleAxis dataKey="dimension" stroke="#94A3B8" tick={{ fontSize: 12 }} />
              <Radar name="Impact" dataKey="value" stroke="#38BDF8" fill="#38BDF8" fillOpacity={0.4} strokeWidth={2} />
              <Tooltip contentStyle={{ backgroundColor: 'rgba(30, 41, 59, 0.9)', border: '1px solid rgba(255,255,255,0.1)', borderRadius: '8px' }} />
            </RadarChart>
          </ResponsiveContainer>
          <div className="mt-4 grid grid-cols-3 gap-4">
            {categories.map((cat) => (
              <div key={cat.id} className="text-center">
                <div className="flex items-center justify-center gap-1">
                  <div className="w-2 h-2 rounded" style={{ backgroundColor: cat.color }} />
                  <p className="text-xs text-bia-text-tertiary">{cat.name}</p>
                </div>
                <p className={`text-lg font-bold ${getScoreColor(localImpact[cat.id] || 0)}`}>{localImpact[cat.id] || 0}/5</p>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}


--- FILE END: src\components\ImpactAssessment.tsx ---


--- FILE START: src\components\ProcessDependencies.tsx ---

import { useState, useCallback, useMemo, DragEvent, useRef, useEffect } from 'react';
import {
  ReactFlow,
  Node,
  Edge,
  Controls,
  Background,
  useNodesState,
  useEdgesState,
  addEdge,
  Connection,
  NodeProps,
  Handle,
  Position,
  BackgroundVariant,
} from '@xyflow/react';
import '@xyflow/react/dist/style.css';
import { useStore } from '../store/useStore';
import { Save, Users, Monitor, Wrench, Building, Truck, Database, Workflow, Settings2, X } from 'lucide-react';
import { RESOURCE_TYPES, ResourceType } from '../types';

// Shape types
type NodeShape = 'rectangle' | 'rounded' | 'circle' | 'diamond' | 'hexagon';

const SHAPES: { value: NodeShape; label: string }[] = [
  { value: 'rectangle', label: 'Rectangle' },
  { value: 'rounded', label: 'Rounded' },
  { value: 'circle', label: 'Circle' },
  { value: 'diamond', label: 'Diamond' },
  { value: 'hexagon', label: 'Hexagon' },
];

const PRESET_COLORS = [
  '#818CF8', '#22C55E', '#3B82F6', '#F97316', '#A855F7', 
  '#EF4444', '#06B6D4', '#FBBF24', '#EC4899', '#6B7280'
];

// Resource type colors and icons
const RESOURCE_COLORS: Record<ResourceType, string> = {
  personnel: '#22C55E',
  systems: '#3B82F6',
  equipment: '#F97316',
  facilities: '#A855F7',
  vendors: '#EF4444',
  data: '#06B6D4',
};

const RESOURCE_ICONS: Record<ResourceType, typeof Users> = {
  personnel: Users,
  systems: Monitor,
  equipment: Wrench,
  facilities: Building,
  vendors: Truck,
  data: Database,
};

// Shape clip paths
const getShapeStyles = (shape: NodeShape, color: string) => {
  const base = { backgroundColor: `${color}20`, borderColor: `${color}80` };
  switch (shape) {
    case 'rectangle': return { ...base, borderRadius: '4px' };
    case 'rounded': return { ...base, borderRadius: '16px' };
    case 'circle': return { ...base, borderRadius: '50%', minWidth: '120px', minHeight: '120px', display: 'flex', alignItems: 'center', justifyContent: 'center' };
    case 'diamond': return { ...base, transform: 'rotate(45deg)', borderRadius: '8px' };
    case 'hexagon': return { ...base, clipPath: 'polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%)', borderRadius: '0' };
    default: return base;
  }
};

// 4-sided handles component
function FourHandles({ color, isTarget = false }: { color: string; isTarget?: boolean }) {
  const type = isTarget ? 'target' : 'source';
  return (
    <>
      <Handle type={type} position={Position.Top} id={`${type}-top`} style={{ background: color }} className="!w-2 !h-2" />
      <Handle type={type} position={Position.Bottom} id={`${type}-bottom`} style={{ background: color }} className="!w-2 !h-2" />
      <Handle type={type} position={Position.Left} id={`${type}-left`} style={{ background: color }} className="!w-2 !h-2" />
      <Handle type={type} position={Position.Right} id={`${type}-right`} style={{ background: color }} className="!w-2 !h-2" />
    </>
  );
}

// Context menu for node customization
interface ContextMenuProps {
  nodeId: string;
  x: number;
  y: number;
  currentShape: NodeShape;
  currentColor: string;
  onChangeShape: (shape: NodeShape) => void;
  onChangeColor: (color: string) => void;
  onClose: () => void;
}

function NodeContextMenu({ nodeId, x, y, currentShape, currentColor, onChangeShape, onChangeColor, onClose }: ContextMenuProps) {
  const menuRef = useRef<HTMLDivElement>(null);
  const [localShape, setLocalShape] = useState(currentShape);
  const [customColor, setCustomColor] = useState(currentColor);

  useEffect(() => {
    const handleClickOutside = (e: MouseEvent) => {
      if (menuRef.current && !menuRef.current.contains(e.target as Node)) onClose();
    };
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, [onClose]);

  const handleShapeChange = (shape: NodeShape) => {
    setLocalShape(shape);
    onChangeShape(shape);
  };

  return (
    <div
      ref={menuRef}
      className="fixed z-50 bg-bia-card border border-bia-border rounded-lg shadow-xl p-3 min-w-[200px]"
      style={{ left: x, top: y }}
    >
      <div className="flex items-center justify-between mb-2">
        <span className="text-sm font-medium text-bia-text-primary">Node Settings</span>
        <button onClick={onClose} className="text-bia-text-tertiary hover:text-bia-text-primary"><X className="w-4 h-4" /></button>
      </div>
      
      {/* Shape Selection */}
      <div className="mb-3">
        <label className="text-xs text-bia-text-tertiary block mb-1">Shape</label>
        <div className="grid grid-cols-5 gap-1">
          {SHAPES.map(s => (
            <button
              key={s.value}
              onClick={() => handleShapeChange(s.value)}
              className={`p-1.5 rounded text-xs ${localShape === s.value ? 'bg-bia-primary text-white' : 'bg-white/10 text-bia-text-secondary hover:bg-white/20'}`}
              title={s.label}
            >
              {s.label.slice(0, 3)}
            </button>
          ))}
        </div>
      </div>

      {/* Color Selection */}
      <div>
        <label className="text-xs text-bia-text-tertiary block mb-1">Color</label>
        <div className="flex flex-wrap gap-1 mb-2">
          {PRESET_COLORS.map(c => (
            <button
              key={c}
              onClick={() => onChangeColor(c)}
              className={`w-6 h-6 rounded border-2 ${currentColor === c ? 'border-white' : 'border-transparent'}`}
              style={{ backgroundColor: c }}
            />
          ))}
        </div>
        <div className="flex items-center gap-2">
          <input
            type="color"
            value={customColor}
            onChange={(e) => setCustomColor(e.target.value)}
            className="w-8 h-8 rounded cursor-pointer"
          />
          <button
            onClick={() => onChangeColor(customColor)}
            className="text-xs px-2 py-1 bg-white/10 rounded hover:bg-white/20 text-bia-text-secondary"
          >
            Apply Custom
          </button>
        </div>
      </div>
    </div>
  );
}

// Custom node components
function ProcessNode({ id, data }: NodeProps) {
  const isCenter = data.isCenter;
  const shape = (data.shape as NodeShape) || 'rounded';
  const customColor = data.customColor as string | undefined;
  const baseColor = isCenter ? '#818CF8' : '#3B82F6';
  const color = customColor || baseColor;
  const shapeStyles = getShapeStyles(shape, color);

  const content = (
    <div className="flex items-center justify-center gap-2" style={shape === 'diamond' ? { transform: 'rotate(-45deg)' } : {}}>
      <Workflow className="w-4 h-4" style={{ color }} />
      <span className="font-medium text-bia-text-primary text-sm">{data.label}</span>
    </div>
  );

  return (
    <div
      className="px-4 py-3 border-2 min-w-[140px] text-center relative"
      style={shapeStyles}
    >
      <FourHandles color={color} isTarget={true} />
      {!isCenter && <FourHandles color={color} isTarget={false} />}
      {content}
      {isCenter && <div className="text-xs text-bia-text-tertiary mt-1" style={shape === 'diamond' ? { transform: 'rotate(-45deg)' } : {}}>Center</div>}
      {!isCenter && (
        <button
          className="absolute -top-2 -right-2 w-5 h-5 rounded-full bg-bia-card border border-bia-border flex items-center justify-center hover:bg-white/20"
          onClick={(e) => { e.stopPropagation(); data.onOpenMenu?.(id, e.clientX, e.clientY); }}
        >
          <Settings2 className="w-3 h-3 text-bia-text-tertiary" />
        </button>
      )}
    </div>
  );
}

function ResourceNode({ id, data }: NodeProps) {
  const shape = (data.shape as NodeShape) || 'rounded';
  const defaultColor = RESOURCE_COLORS[data.resourceType as ResourceType] || '#6B7280';
  const color = (data.customColor as string) || defaultColor;
  const Icon = RESOURCE_ICONS[data.resourceType as ResourceType] || Database;
  const shapeStyles = getShapeStyles(shape, color);

  const content = (
    <div style={shape === 'diamond' ? { transform: 'rotate(-45deg)' } : {}}>
      <div className="flex items-center gap-2">
        <Icon className="w-4 h-4" style={{ color }} />
        <span className="text-bia-text-primary font-medium text-sm">{data.label}</span>
      </div>
      <div className="text-xs mt-1" style={{ color }}>{data.resourceTypeLabel}</div>
    </div>
  );

  return (
    <div className="px-4 py-3 border-2 min-w-[130px] relative" style={shapeStyles}>
      <FourHandles color={color} isTarget={true} />
      <FourHandles color={color} isTarget={false} />
      {content}
      <button
        className="absolute -top-2 -right-2 w-5 h-5 rounded-full bg-bia-card border border-bia-border flex items-center justify-center hover:bg-white/20"
        onClick={(e) => { e.stopPropagation(); data.onOpenMenu?.(id, e.clientX, e.clientY); }}
      >
        <Settings2 className="w-3 h-3 text-bia-text-tertiary" />
      </button>
    </div>
  );
}

const nodeTypes = {
  processNode: ProcessNode,
  resourceNode: ResourceNode,
};

interface ProcessDependencyMap {
  processId: string;
  nodes: Node[];
  edges: Edge[];
}

export function ProcessDependencies() {
  const { processes, settings } = useStore();
  const businessResources = settings.businessResources || [];
  
  const loadSavedMaps = (): Record<string, ProcessDependencyMap> => {
    try {
      const saved = localStorage.getItem('bia-process-dependency-maps');
      return saved ? JSON.parse(saved) : {};
    } catch { return {}; }
  };

  const [savedMaps, setSavedMaps] = useState<Record<string, ProcessDependencyMap>>(loadSavedMaps);
  const [selectedProcessId, setSelectedProcessId] = useState<string>(processes[0]?.id || '');
  const [saved, setSaved] = useState(false);
  const [contextMenu, setContextMenu] = useState<{ nodeId: string; x: number; y: number } | null>(null);

  const currentProcess = processes.find(p => p.id === selectedProcessId);
  const otherProcesses = processes.filter(p => p.id !== selectedProcessId);

  const openNodeMenu = useCallback((nodeId: string, x: number, y: number) => {
    setContextMenu({ nodeId, x, y });
  }, []);

  const getInitialData = useCallback(() => {
    const savedMap = savedMaps[selectedProcessId];
    if (savedMap) {
      return {
        nodes: savedMap.nodes.map(n => ({ ...n, data: { ...n.data, onOpenMenu: openNodeMenu } })),
        edges: savedMap.edges
      };
    }
    const centerNode: Node = {
      id: 'center',
      type: 'processNode',
      position: { x: 400, y: 250 },
      data: { label: currentProcess?.name || 'Process', isCenter: true, onOpenMenu: openNodeMenu },
      deletable: false,
    };
    return { nodes: [centerNode], edges: [] };
  }, [selectedProcessId, savedMaps, currentProcess, openNodeMenu]);

  const initialData = useMemo(getInitialData, [getInitialData]);
  const [nodes, setNodes, onNodesChange] = useNodesState(initialData.nodes);
  const [edges, setEdges, onEdgesChange] = useEdgesState(initialData.edges);

  const handleProcessChange = (processId: string) => {
    setSelectedProcessId(processId);
    setContextMenu(null);
    const savedMap = savedMaps[processId];
    const process = processes.find(p => p.id === processId);
    if (savedMap) {
      setNodes(savedMap.nodes.map(n => ({ ...n, data: { ...n.data, onOpenMenu: openNodeMenu } })));
      setEdges(savedMap.edges);
    } else {
      setNodes([{
        id: 'center',
        type: 'processNode',
        position: { x: 400, y: 250 },
        data: { label: process?.name || 'Process', isCenter: true, onOpenMenu: openNodeMenu },
        deletable: false,
      }]);
      setEdges([]);
    }
  };

  const onConnect = useCallback((connection: Connection) => {
    setEdges((eds) => addEdge({ 
      ...connection, 
      animated: true, 
      style: { stroke: '#818CF8', strokeWidth: 2 },
      deletable: true,
    }, eds));
  }, [setEdges]);

  const onEdgeClick = useCallback((_: React.MouseEvent, edge: Edge) => {
    // Toggle selection styling on click
    setEdges((eds) => eds.map(e => ({
      ...e,
      selected: e.id === edge.id ? !e.selected : false,
      style: e.id === edge.id && !e.selected 
        ? { stroke: '#EF4444', strokeWidth: 3 } 
        : { stroke: '#818CF8', strokeWidth: 2 }
    })));
  }, [setEdges]);

  const onDragOver = useCallback((event: DragEvent) => {
    event.preventDefault();
    event.dataTransfer.dropEffect = 'move';
  }, []);

  const onDrop = useCallback((event: DragEvent) => {
    event.preventDefault();
    const data = event.dataTransfer.getData('application/json');
    if (!data) return;
    
    const item = JSON.parse(data);
    const reactFlowBounds = (event.target as HTMLElement).closest('.react-flow')?.getBoundingClientRect();
    if (!reactFlowBounds) return;

    const position = {
      x: event.clientX - reactFlowBounds.left - 80,
      y: event.clientY - reactFlowBounds.top - 30,
    };

    const newNode: Node = {
      id: `${item.type}-${item.id}-${Date.now()}`,
      type: item.type === 'process' ? 'processNode' : 'resourceNode',
      position,
      data: item.type === 'process' 
        ? { label: item.name, isCenter: false, shape: 'rounded', onOpenMenu: openNodeMenu }
        : { label: item.name, resourceType: item.resourceType, resourceTypeLabel: item.resourceTypeLabel, shape: 'rounded', onOpenMenu: openNodeMenu },
    };

    setNodes((nds) => [...nds, newNode]);
  }, [setNodes, openNodeMenu]);

  const handleSave = () => {
    // Strip onOpenMenu before saving
    const nodesToSave = nodes.map(n => {
      const { onOpenMenu, ...rest } = n.data;
      return { ...n, data: rest };
    });
    const newMaps = {
      ...savedMaps,
      [selectedProcessId]: { processId: selectedProcessId, nodes: nodesToSave, edges }
    };
    setSavedMaps(newMaps);
    localStorage.setItem('bia-process-dependency-maps', JSON.stringify(newMaps));
    setSaved(true);
    setTimeout(() => setSaved(false), 2000);
  };

  const handleDragStart = (event: DragEvent, item: any) => {
    event.dataTransfer.setData('application/json', JSON.stringify(item));
    event.dataTransfer.effectAllowed = 'move';
  };

  const handleChangeShape = (nodeId: string, shape: NodeShape) => {
    setNodes(nds => nds.map(n => n.id === nodeId ? { ...n, data: { ...n.data, shape } } : n));
  };

  const handleChangeColor = (nodeId: string, color: string) => {
    setNodes(nds => nds.map(n => n.id === nodeId ? { ...n, data: { ...n.data, customColor: color } } : n));
  };

  const selectedNode = nodes.find(n => n.id === contextMenu?.nodeId);

  if (processes.length === 0) {
    return (
      <div className="animate-fade-in">
        <h1 className="text-3xl font-bold text-bia-text-primary mb-4">Process Dependencies</h1>
        <div className="glass-panel p-8 text-center">
          <p className="text-bia-text-secondary">No processes available. Create processes first.</p>
        </div>
      </div>
    );
  }

  return (
    <div className="animate-fade-in h-[calc(100vh-4rem)]">
      <div className="flex items-center justify-between mb-4">
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Process Dependencies</h1>
          <p className="text-bia-text-secondary mt-1">Map resources and processes that support each business process</p>
        </div>
        <button onClick={handleSave} className="glass-button-solid flex items-center gap-2">
          <Save className="w-4 h-4" /> {saved ? 'Saved!' : 'Save Dependencies'}
        </button>
      </div>

      <div className="mb-4">
        <select
          value={selectedProcessId}
          onChange={(e) => handleProcessChange(e.target.value)}
          className="glass-input w-full max-w-md"
        >
          {processes.map(p => (
            <option key={p.id} value={p.id}>{p.name} ({p.department})</option>
          ))}
        </select>
      </div>

      <div className="flex gap-4 h-[calc(100%-120px)]">
        <div className="w-64 glass-panel p-4 overflow-y-auto">
          <h3 className="text-sm font-semibold text-bia-text-primary mb-3">Drag onto Canvas</h3>
          
          <div className="space-y-4">
            <div>
              <h4 className="text-xs font-medium text-bia-text-tertiary uppercase mb-2">Resources</h4>
              <div className="space-y-2">
                {businessResources.map((resource) => {
                  const color = RESOURCE_COLORS[resource.type];
                  const Icon = RESOURCE_ICONS[resource.type];
                  const typeLabel = RESOURCE_TYPES.find(t => t.value === resource.type)?.label || resource.type;
                  return (
                    <div
                      key={resource.id}
                      draggable
                      onDragStart={(e) => handleDragStart(e, { 
                        type: 'resource', 
                        id: resource.id, 
                        name: resource.name,
                        resourceType: resource.type,
                        resourceTypeLabel: typeLabel
                      })}
                      className="p-2 rounded-lg border cursor-grab active:cursor-grabbing hover:opacity-80 transition-opacity"
                      style={{ backgroundColor: `${color}15`, borderColor: `${color}40` }}
                    >
                      <div className="flex items-center gap-2">
                        <Icon className="w-4 h-4" style={{ color }} />
                        <span className="text-sm text-bia-text-primary truncate">{resource.name}</span>
                      </div>
                      <div className="text-xs mt-0.5" style={{ color }}>{typeLabel}</div>
                    </div>
                  );
                })}
                {businessResources.length === 0 && (
                  <p className="text-xs text-bia-text-tertiary">No resources defined. Add in Settings.</p>
                )}
              </div>
            </div>

            <div>
              <h4 className="text-xs font-medium text-bia-text-tertiary uppercase mb-2">Other Processes</h4>
              <div className="space-y-2">
                {otherProcesses.map((process) => (
                  <div
                    key={process.id}
                    draggable
                    onDragStart={(e) => handleDragStart(e, { type: 'process', id: process.id, name: process.name })}
                    className="p-2 rounded-lg border border-blue-500/30 bg-blue-500/10 cursor-grab active:cursor-grabbing hover:opacity-80 transition-opacity"
                  >
                    <div className="flex items-center gap-2">
                      <Workflow className="w-4 h-4 text-blue-400" />
                      <span className="text-sm text-bia-text-primary truncate">{process.name}</span>
                    </div>
                    <div className="text-xs text-blue-400 mt-0.5">{process.department}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>

        <div className="flex-1 glass-panel overflow-hidden rounded-lg">
          <ReactFlow
            nodes={nodes}
            edges={edges}
            onNodesChange={onNodesChange}
            onEdgesChange={onEdgesChange}
            onConnect={onConnect}
            onEdgeClick={onEdgeClick}
            onDragOver={onDragOver}
            onDrop={onDrop}
            nodeTypes={nodeTypes}
            deleteKeyCode={['Backspace', 'Delete']}
            fitView
            className="bg-black/20"
          >
            <Controls className="!bg-bia-card !border-bia-border !rounded-lg [&>button]:!bg-bia-card [&>button]:!border-bia-border [&>button]:!text-bia-text-primary [&>button:hover]:!bg-white/10" />
            <Background variant={BackgroundVariant.Dots} gap={20} size={1} color="rgba(255,255,255,0.1)" />
          </ReactFlow>
        </div>
      </div>

      {/* Context Menu */}
      {contextMenu && selectedNode && (
        <NodeContextMenu
          nodeId={contextMenu.nodeId}
          x={contextMenu.x}
          y={contextMenu.y}
          currentShape={(selectedNode.data.shape as NodeShape) || 'rounded'}
          currentColor={(selectedNode.data.customColor as string) || (selectedNode.data.resourceType ? RESOURCE_COLORS[selectedNode.data.resourceType as ResourceType] : '#818CF8')}
          onChangeShape={(shape) => handleChangeShape(contextMenu.nodeId, shape)}
          onChangeColor={(color) => handleChangeColor(contextMenu.nodeId, color)}
          onClose={() => setContextMenu(null)}
        />
      )}
    </div>
  );
}


--- FILE END: src\components\ProcessDependencies.tsx ---


--- FILE START: src\components\ProcessRegistry.tsx ---

import { useState } from 'react';
import { useStore } from '../store/useStore';
import { Process, Criticality, ProcessStatus } from '../types';
import { Plus, Pencil, Trash2, Search, X } from 'lucide-react';

const DEPARTMENTS = ['Finance', 'Operations', 'IT', 'HR', 'Supply Chain', 'Legal', 'Marketing'];
const CRITICALITY_OPTIONS: Criticality[] = ['critical', 'high', 'medium', 'low', 'minimal'];
const STATUS_OPTIONS: ProcessStatus[] = ['draft', 'in-review', 'approved'];

interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  process?: Process;
}

function ProcessModal({ isOpen, onClose, process }: ModalProps) {
  const { addProcess, updateProcess } = useStore();
  const [form, setForm] = useState<Partial<Process>>(process || {
    name: '', owner: '', department: 'IT', description: '', criticality: 'medium', status: 'draft'
  });

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (process) {
      updateProcess(process.id, form);
    } else {
      const newProcess: Process = {
        ...form as Process,
        id: `PROC-${String(Date.now()).slice(-6)}`,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      addProcess(newProcess);
    }
    onClose();
  };

  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in">
      <div className="glass-panel p-6 w-full max-w-lg animate-scale-in">
        <div className="flex justify-between items-center mb-6">
          <h2 className="text-xl font-semibold text-bia-text-primary">{process ? 'Edit Process' : 'Add Process'}</h2>
          <button onClick={onClose} className="text-bia-text-secondary hover:text-bia-text-primary"><X className="w-5 h-5" /></button>
        </div>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm text-bia-text-secondary mb-1">Process Name</label>
            <input type="text" required className="glass-input w-full" value={form.name || ''} onChange={(e) => setForm({ ...form, name: e.target.value })} />
          </div>
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm text-bia-text-secondary mb-1">Owner</label>
              <input type="text" required className="glass-input w-full" value={form.owner || ''} onChange={(e) => setForm({ ...form, owner: e.target.value })} />
            </div>
            <div>
              <label className="block text-sm text-bia-text-secondary mb-1">Department</label>
              <select className="glass-input w-full" value={form.department || ''} onChange={(e) => setForm({ ...form, department: e.target.value })}>
                {DEPARTMENTS.map(d => <option key={d} value={d}>{d}</option>)}
              </select>
            </div>
          </div>
          <div>
            <label className="block text-sm text-bia-text-secondary mb-1">Description</label>
            <textarea className="glass-input w-full h-24 resize-none" value={form.description || ''} onChange={(e) => setForm({ ...form, description: e.target.value })} />
          </div>
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm text-bia-text-secondary mb-1">Criticality</label>
              <select className="glass-input w-full" value={form.criticality || 'medium'} onChange={(e) => setForm({ ...form, criticality: e.target.value as Criticality })}>
                {CRITICALITY_OPTIONS.map(c => <option key={c} value={c}>{c.charAt(0).toUpperCase() + c.slice(1)}</option>)}
              </select>
            </div>
            <div>
              <label className="block text-sm text-bia-text-secondary mb-1">Status</label>
              <select className="glass-input w-full" value={form.status || 'draft'} onChange={(e) => setForm({ ...form, status: e.target.value as ProcessStatus })}>
                {STATUS_OPTIONS.map(s => <option key={s} value={s}>{s.replace('-', ' ')}</option>)}
              </select>
            </div>
          </div>
          <div className="flex justify-end gap-3 mt-6">
            <button type="button" onClick={onClose} className="glass-button">Cancel</button>
            <button type="submit" className="glass-button-solid">Save Process</button>
          </div>
        </form>
      </div>
    </div>
  );
}

export function ProcessRegistry() {
  const { processes, deleteProcess, calculateRiskScore, setCurrentView, setSelectedProcessId } = useStore();
  const [search, setSearch] = useState('');
  const [filterCriticality, setFilterCriticality] = useState<string>('all');
  const [modalOpen, setModalOpen] = useState(false);
  const [editingProcess, setEditingProcess] = useState<Process | undefined>();

  const filtered = processes.filter(p => {
    const matchSearch = p.name.toLowerCase().includes(search.toLowerCase()) || p.department.toLowerCase().includes(search.toLowerCase());
    const matchCrit = filterCriticality === 'all' || p.criticality === filterCriticality;
    return matchSearch && matchCrit;
  });

  const handleEdit = (p: Process) => { setEditingProcess(p); setModalOpen(true); };
  const handleAdd = () => { setEditingProcess(undefined); setModalOpen(true); };
  const handleAssess = (id: string) => { setSelectedProcessId(id); setCurrentView('assessment'); };

  return (
    <div className="animate-fade-in space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Process Registry</h1>
          <p className="text-bia-text-secondary mt-1">Manage business processes and their assessments</p>
        </div>
        <button onClick={handleAdd} className="glass-button-solid flex items-center gap-2">
          <Plus className="w-4 h-4" /> Add Process
        </button>
      </div>

      {/* Filters */}
      <div className="glass-panel p-4 flex flex-wrap gap-4 items-center">
        <div className="relative flex-1 min-w-[200px]">
          <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-bia-text-tertiary" />
          <input type="text" placeholder="Search processes..." className="glass-input w-full pl-10" value={search} onChange={(e) => setSearch(e.target.value)} />
        </div>
        <select className="glass-input" value={filterCriticality} onChange={(e) => setFilterCriticality(e.target.value)}>
          <option value="all">All Criticality</option>
          {CRITICALITY_OPTIONS.map(c => <option key={c} value={c}>{c.charAt(0).toUpperCase() + c.slice(1)}</option>)}
        </select>
      </div>

      {/* Table */}
      <div className="glass-panel overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-white/5 border-b border-white/5">
              <tr className="text-left text-[10px] text-bia-text-tertiary font-bold uppercase tracking-[0.2em]">
                <th className="p-4">Reference</th>
                <th className="p-4">Business Process</th>
                <th className="p-4">Owner</th>
                <th className="p-4">Department</th>
                <th className="p-4">Criticality</th>
                <th className="p-4">Risk Score</th>
                <th className="p-4">Status</th>
                <th className="p-4 text-center">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-white/5">
              {filtered.map((proc) => (
                <tr key={proc.id} className="group hover:bg-white/[0.03] transition-all duration-200">
                  <td className="p-4 text-bia-text-tertiary font-mono text-xs opacity-75">{proc.id}</td>
                  <td className="p-4 text-bia-text-primary font-semibold">{proc.name}</td>
                  <td className="p-4 text-bia-text-secondary text-sm">{proc.owner}</td>
                  <td className="p-4 text-bia-text-secondary text-sm">{proc.department}</td>
                  <td className="p-4">
                    <span className={`px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase tracking-wider criticality-${proc.criticality}`}>
                      {proc.criticality}
                    </span>
                  </td>
                  <td className="p-4">
                    <div className="flex items-center gap-2">
                      <div className="w-16 bg-white/5 rounded-full h-1 overflow-hidden">
                        <div
                          className={`h-full rounded-full ${calculateRiskScore(proc.id) >= 4 ? 'bg-bia-critical' : calculateRiskScore(proc.id) >= 3 ? 'bg-bia-warning' : 'bg-bia-primary'}`}
                          style={{ width: `${(calculateRiskScore(proc.id) / 5) * 100}%` }}
                        />
                      </div>
                      <span className="text-bia-text-primary font-bold text-xs">{calculateRiskScore(proc.id)}</span>
                    </div>
                  </td>
                  <td className="p-4">
                    <span className={`px-2 py-0.5 rounded text-[10px] font-bold uppercase ${proc.status === 'approved' ? 'bg-bia-success/10 text-bia-success border border-bia-success/20' : proc.status === 'in-review' ? 'bg-bia-warning/10 text-bia-warning border border-bia-warning/20' : 'bg-bia-text-tertiary/10 text-bia-text-tertiary border border-bia-text-tertiary/20'}`}>
                      {proc.status.replace('-', ' ')}
                    </span>
                  </td>
                  <td className="p-4">
                    <div className="flex items-center justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                      <button onClick={() => handleAssess(proc.id)} className="glass-button text-[10px] px-3 py-1 uppercase tracking-tighter">Assess</button>
                      <button onClick={() => handleEdit(proc)} className="p-2 hover:bg-white/10 rounded-bia-sm transition-colors"><Pencil className="w-3.5 h-3.5 text-bia-text-secondary" /></button>
                      <button onClick={() => deleteProcess(proc.id)} className="p-2 hover:bg-bia-critical/10 rounded-bia-sm transition-colors"><Trash2 className="w-3.5 h-3.5 text-bia-critical" /></button>
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
          {filtered.length === 0 && (
            <div className="text-center py-12 text-bia-text-secondary">No processes found</div>
          )}
        </div>
      </div>

      <ProcessModal isOpen={modalOpen} onClose={() => setModalOpen(false)} process={editingProcess} />
    </div>
  );
}


--- FILE END: src\components\ProcessRegistry.tsx ---


--- FILE START: src\components\RecoveryObjectives.tsx ---

import { useState, useEffect, useMemo } from 'react';
import { useStore } from '../store/useStore';
import { RecoveryObjective, RecoveryStrategy } from '../types';
import { Clock, Target, Database, Save, ChevronLeft, AlertCircle, Lightbulb, DollarSign } from 'lucide-react';
import { Tooltip } from './Tooltip';

const STRATEGY_OPTIONS: { value: RecoveryStrategy; label: string; description: string; maxRTO: number; cost: number }[] = [
  { value: 'high-availability', label: 'High Availability', description: 'Active-active with automatic failover', maxRTO: 1, cost: 5 },
  { value: 'warm-standby', label: 'Warm Standby', description: 'Secondary system with quick activation', maxRTO: 8, cost: 3 },
  { value: 'cloud-based', label: 'Cloud-Based', description: 'Cloud infrastructure for rapid recovery', maxRTO: 4, cost: 3 },
  { value: 'cold-backup', label: 'Cold Backup', description: 'Backup available for manual recovery', maxRTO: 24, cost: 2 },
  { value: 'manual', label: 'Manual Workaround', description: 'Manual processes as fallback', maxRTO: 72, cost: 1 },
];

export function RecoveryObjectives() {
  const { processes, selectedProcessId, setSelectedProcessId, recoveryObjectives, updateRecoveryObjective, getProcessById, impacts, calculateRiskScore } = useStore();
  const [local, setLocal] = useState<RecoveryObjective>({ mtpd: 24, rto: 12, rpo: 4, mbco: false, recoveryStrategy: 'warm-standby', strategyNotes: '' });
  const [saved, setSaved] = useState(false);
  const [errors, setErrors] = useState<string[]>([]);

  const process = selectedProcessId ? getProcessById(selectedProcessId) : null;
  const impact = selectedProcessId ? impacts[selectedProcessId] : null;
  const riskScore = selectedProcessId ? calculateRiskScore(selectedProcessId) : 0;

  useEffect(() => {
    if (selectedProcessId && recoveryObjectives[selectedProcessId]) {
      setLocal(recoveryObjectives[selectedProcessId]);
    }
  }, [selectedProcessId, recoveryObjectives]);

  const recommendedStrategy = useMemo(() => {
    if (local.rto <= 1) return 'high-availability';
    if (local.rto <= 4) return 'cloud-based';
    if (local.rto <= 8) return 'warm-standby';
    if (local.rto <= 24) return 'cold-backup';
    return 'manual';
  }, [local.rto]);

  const strategyGap = useMemo(() => {
    const current = STRATEGY_OPTIONS.find((s) => s.value === local.recoveryStrategy);
    if (!current) return null;
    if (local.rto < current.maxRTO) return null;
    return `Current strategy may not meet RTO of ${local.rto}h. Consider ${recommendedStrategy}.`;
  }, [local.rto, local.recoveryStrategy, recommendedStrategy]);

  const validate = (): boolean => {
    const errs: string[] = [];
    if (local.rto > local.mtpd) errs.push('RTO cannot exceed MTPD');
    if (local.rpo > local.rto) errs.push('RPO should not exceed RTO');
    if (local.mtpd < 1) errs.push('MTPD must be at least 1 hour');
    setErrors(errs);
    return errs.length === 0;
  };

  const handleSave = () => {
    if (validate() && selectedProcessId) {
      updateRecoveryObjective(selectedProcessId, local);
      setSaved(true);
      setTimeout(() => setSaved(false), 2000);
    }
  };

  if (!selectedProcessId) {
    return (
      <div className="animate-fade-in space-y-6">
        <h1 className="text-3xl font-bold text-bia-text-primary">Recovery Objectives</h1>
        <p className="text-bia-text-secondary">Select a process to configure recovery objectives</p>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          {processes.map((p) => (
            <button key={p.id} onClick={() => setSelectedProcessId(p.id)} className="glass-panel-hover p-6 text-left">
              <h3 className="text-lg font-semibold text-bia-text-primary">{p.name}</h3>
              <p className="text-sm text-bia-text-secondary mt-1">{p.department}</p>
              {recoveryObjectives[p.id] && (
                <div className="flex gap-4 mt-3 text-xs">
                  <span className="text-bia-primary">MTPD: {recoveryObjectives[p.id].mtpd}h</span>
                  <span className="text-bia-secondary">RTO: {recoveryObjectives[p.id].rto}h</span>
                  <span className="text-bia-info">RPO: {recoveryObjectives[p.id].rpo}h</span>
                </div>
              )}
            </button>
          ))}
        </div>
      </div>
    );
  }

  return (
    <div className="animate-fade-in space-y-6">
      <div className="flex items-center gap-4">
        <button onClick={() => setSelectedProcessId(null)} className="p-2 hover:bg-bia-glass-hover rounded-lg transition-colors">
          <ChevronLeft className="w-5 h-5 text-bia-text-secondary" />
        </button>
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Recovery Objectives</h1>
          <p className="text-bia-text-secondary mt-1">Configuring: {process?.name}</p>
        </div>
      </div>

      {errors.length > 0 && (
        <div className="glass-panel p-4 border-l-4 border-bia-critical bg-bia-critical/10">
          <div className="flex items-center gap-2 text-bia-critical">
            <AlertCircle className="w-5 h-5" />
            <span className="font-medium">Validation Errors</span>
          </div>
          <ul className="mt-2 text-sm text-bia-critical/80 list-disc list-inside">
            {errors.map((e, i) => <li key={i}>{e}</li>)}
          </ul>
        </div>
      )}

      {/* Strategy Recommendation */}
      {strategyGap && (
        <div className="glass-panel p-4 border-l-4 border-bia-warning bg-bia-warning/10">
          <div className="flex items-center gap-2 text-bia-warning">
            <Lightbulb className="w-5 h-5" />
            <span className="font-medium">Strategy Recommendation</span>
          </div>
          <p className="mt-2 text-sm text-bia-text-secondary">{strategyGap}</p>
        </div>
      )}

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* MTPD */}
        <div className="glass-panel p-6">
          <div className="flex items-center gap-3 mb-4">
            <div className="p-3 rounded-bia-md bg-bia-critical/20">
              <Clock className="w-6 h-6 text-bia-critical" />
            </div>
            <div className="flex-1">
              <div className="flex items-center gap-2">
                <h3 className="text-lg font-semibold text-bia-text-primary">MTPD</h3>
                <Tooltip content="Maximum Tolerable Period of Disruption: The maximum time a process can be unavailable before causing unacceptable damage" />
              </div>
              <p className="text-xs text-bia-text-tertiary">Maximum Tolerable Period</p>
            </div>
          </div>
          <input type="number" min="1" max="720" className="glass-input w-full text-2xl font-bold text-center" value={local.mtpd} onChange={(e) => setLocal({ ...local, mtpd: parseInt(e.target.value) || 0 })} />
          <p className="text-center text-bia-text-secondary mt-2">hours</p>
        </div>

        {/* RTO */}
        <div className="glass-panel p-6">
          <div className="flex items-center gap-3 mb-4">
            <div className="p-3 rounded-bia-md bg-bia-warning/20">
              <Target className="w-6 h-6 text-bia-warning" />
            </div>
            <div className="flex-1">
              <div className="flex items-center gap-2">
                <h3 className="text-lg font-semibold text-bia-text-primary">RTO</h3>
                <Tooltip content="Recovery Time Objective: Target time to restore the process after disruption" />
              </div>
              <p className="text-xs text-bia-text-tertiary">Recovery Time Objective</p>
            </div>
          </div>
          <input type="number" min="0" max="720" className="glass-input w-full text-2xl font-bold text-center" value={local.rto} onChange={(e) => setLocal({ ...local, rto: parseInt(e.target.value) || 0 })} />
          <p className="text-center text-bia-text-secondary mt-2">hours</p>
        </div>

        {/* RPO */}
        <div className="glass-panel p-6">
          <div className="flex items-center gap-3 mb-4">
            <div className="p-3 rounded-bia-md bg-bia-info/20">
              <Database className="w-6 h-6 text-bia-info" />
            </div>
            <div className="flex-1">
              <div className="flex items-center gap-2">
                <h3 className="text-lg font-semibold text-bia-text-primary">RPO</h3>
                <Tooltip content="Recovery Point Objective: Maximum acceptable data loss measured in time" />
              </div>
              <p className="text-xs text-bia-text-tertiary">Recovery Point Objective</p>
            </div>
          </div>
          <input type="number" min="0" max="720" className="glass-input w-full text-2xl font-bold text-center" value={local.rpo} onChange={(e) => setLocal({ ...local, rpo: parseInt(e.target.value) || 0 })} />
          <p className="text-center text-bia-text-secondary mt-2">hours</p>
        </div>
      </div>

      {/* Strategy */}
      <div className="glass-panel p-6 space-y-4">
        <div className="flex items-center justify-between">
          <h3 className="text-lg font-semibold text-bia-text-primary">Recovery Strategy</h3>
          <span className="text-sm text-bia-text-tertiary">Recommended: <span className="text-bia-primary capitalize">{recommendedStrategy.replace('-', ' ')}</span></span>
        </div>
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
          {STRATEGY_OPTIONS.map((s) => (
            <button key={s.value} onClick={() => setLocal({ ...local, recoveryStrategy: s.value })}
              className={`p-4 rounded-bia-md border text-left transition-all ${local.recoveryStrategy === s.value ? 'border-bia-primary bg-bia-glass-active' : 'border-bia-border hover:border-bia-primary/50'} ${s.value === recommendedStrategy ? 'ring-1 ring-bia-success/50' : ''}`}>
              <h4 className="font-medium text-bia-text-primary">{s.label}</h4>
              <p className="text-xs text-bia-text-tertiary mt-1">{s.description}</p>
              <div className="flex items-center gap-2 mt-2 text-xs">
                <span className="text-bia-text-tertiary">RTO: &lt;{s.maxRTO}h</span>
                <div className="flex items-center gap-1 text-bia-warning">
                  <DollarSign className="w-3 h-3" />
                  <span>{'$'.repeat(s.cost)}</span>
                </div>
              </div>
            </button>
          ))}
        </div>

        <div>
          <label className="block text-sm text-bia-text-secondary mb-2">Strategy Notes</label>
          <textarea className="glass-input w-full h-24 resize-none" value={local.strategyNotes} onChange={(e) => setLocal({ ...local, strategyNotes: e.target.value })} placeholder="Additional notes about the recovery strategy..." />
        </div>

        <div className="flex items-center gap-3">
          <input type="checkbox" id="mbco" checked={local.mbco} onChange={(e) => setLocal({ ...local, mbco: e.target.checked })} className="w-4 h-4 rounded accent-bia-primary" />
          <label htmlFor="mbco" className="text-bia-text-primary">Minimum Business Continuity Objective (MBCO) Applicable</label>
          <Tooltip content="MBCO indicates this process requires minimum functionality during disruption" />
        </div>

        <button onClick={handleSave} className="glass-button-solid w-full flex items-center justify-center gap-2 mt-4">
          <Save className="w-4 h-4" />
          {saved ? 'Saved!' : 'Save Objectives'}
        </button>
      </div>
    </div>
  );
}


--- FILE END: src\components\RecoveryObjectives.tsx ---


--- FILE START: src\components\Reports.tsx ---

import { useState, useMemo } from 'react';
import { useStore } from '../store/useStore';
import { DEFAULT_IMPACT_CATEGORIES, DEFAULT_BUSINESS_RESOURCES, TimeValue } from '../types';
import { ScatterChart, Scatter, XAxis, YAxis, ZAxis, Tooltip, ResponsiveContainer, Cell } from 'recharts';
import { FileText, Download, AlertTriangle, CheckCircle, XCircle, Shield, AlertOctagon, Clock, Users, Layers } from 'lucide-react';

type ReportType = 'executive' | 'risk-matrix' | 'compliance' | 'bcdr-gap';

// Helper to convert TimeValue to hours
const timeValueToHours = (tv?: TimeValue): number => {
  if (!tv) return Infinity;
  switch (tv.unit) {
    case 'minutes': return tv.value / 60;
    case 'hours': return tv.value;
    case 'days': return tv.value * 24;
    default: return tv.value;
  }
};

const formatTimeValue = (tv?: TimeValue) => tv ? `${tv.value} ${tv.unit}` : 'Not defined';

// Risk Matrix Grid Component
interface RiskMatrixViewProps {
  processes: any[];
  impacts: Record<string, any>;
  categories: any[];
  calculateRiskScore: (id: string) => number;
}

function RiskMatrixView({ processes, impacts, categories, calculateRiskScore }: RiskMatrixViewProps) {
  const [selectedProcess, setSelectedProcess] = useState<any | null>(null);
  const [filterDept, setFilterDept] = useState<string>('all');
  const [filterCriticality, setFilterCriticality] = useState<string>('all');

  const departments = [...new Set(processes.map(p => p.department))];

  // Calculate grid position for each process
  const processPositions = useMemo(() => {
    return processes.map(p => {
      const impact = impacts[p.id] as Record<string, number> | undefined;
      const avgImpact = impact 
        ? Math.round(categories.reduce((sum, cat) => sum + (impact[cat.id] || 0), 0) / categories.length)
        : 0;
      const likelihood = p.criticality === 'critical' ? 5 : p.criticality === 'high' ? 4 : p.criticality === 'medium' ? 3 : p.criticality === 'low' ? 2 : 1;
      const riskScore = calculateRiskScore(p.id);
      return { ...p, impact: Math.min(5, Math.max(1, avgImpact || 1)), likelihood, riskScore };
    });
  }, [processes, impacts, categories, calculateRiskScore]);

  // Filter processes
  const filteredProcesses = processPositions.filter(p => {
    if (filterDept !== 'all' && p.department !== filterDept) return false;
    if (filterCriticality !== 'all' && p.criticality !== filterCriticality) return false;
    return true;
  });

  // Group processes by cell
  const gridCells: Record<string, any[]> = {};
  filteredProcesses.forEach(p => {
    const key = `${p.likelihood}-${p.impact}`;
    if (!gridCells[key]) gridCells[key] = [];
    gridCells[key].push(p);
  });

  // Cell color based on risk level
  const getCellColor = (likelihood: number, impact: number) => {
    const risk = likelihood * impact;
    if (risk >= 20) return 'bg-red-500/30 border-red-500/50';
    if (risk >= 12) return 'bg-orange-500/30 border-orange-500/50';
    if (risk >= 6) return 'bg-yellow-500/30 border-yellow-500/50';
    return 'bg-green-500/30 border-green-500/50';
  };

  // Quadrant labels
  const getQuadrantLabel = (likelihood: number, impact: number) => {
    if (likelihood >= 4 && impact >= 4) return 'Critical - Immediate Action';
    if (likelihood >= 4 && impact < 4) return 'Monitor Closely';
    if (likelihood < 4 && impact >= 4) return 'Manage Proactively';
    return 'Low Priority';
  };

  // Zone counts
  const zoneCounts = {
    critical: filteredProcesses.filter(p => p.likelihood * p.impact >= 20).length,
    high: filteredProcesses.filter(p => p.likelihood * p.impact >= 12 && p.likelihood * p.impact < 20).length,
    medium: filteredProcesses.filter(p => p.likelihood * p.impact >= 6 && p.likelihood * p.impact < 12).length,
    low: filteredProcesses.filter(p => p.likelihood * p.impact < 6).length,
  };

  return (
    <div className="space-y-6">
      {/* Filters */}
      <div className="glass-panel p-4 flex flex-wrap gap-4 items-center">
        <div className="flex items-center gap-2">
          <span className="text-sm text-bia-text-secondary">Department:</span>
          <select value={filterDept} onChange={(e) => setFilterDept(e.target.value)} className="glass-input text-sm py-1">
            <option value="all">All Departments</option>
            {departments.map(d => <option key={d} value={d}>{d}</option>)}
          </select>
        </div>
        <div className="flex items-center gap-2">
          <span className="text-sm text-bia-text-secondary">Criticality:</span>
          <select value={filterCriticality} onChange={(e) => setFilterCriticality(e.target.value)} className="glass-input text-sm py-1">
            <option value="all">All Levels</option>
            <option value="critical">Critical</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <div className="flex-1" />
        {/* Zone Summary */}
        <div className="flex gap-3 text-xs">
          <span className="px-2 py-1 bg-red-500/20 text-red-400 rounded">Critical: {zoneCounts.critical}</span>
          <span className="px-2 py-1 bg-orange-500/20 text-orange-400 rounded">High: {zoneCounts.high}</span>
          <span className="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded">Medium: {zoneCounts.medium}</span>
          <span className="px-2 py-1 bg-green-500/20 text-green-400 rounded">Low: {zoneCounts.low}</span>
        </div>
      </div>

      {/* 5x5 Risk Matrix Grid */}
      <div className="glass-panel p-6">
        <h3 className="text-lg font-semibold text-bia-text-primary mb-4">Risk Matrix (5×5 Grid)</h3>
        
        <div className="flex">
          {/* Y-axis label */}
          <div className="flex flex-col justify-center items-center pr-2 w-8">
            <span className="text-xs text-bia-text-tertiary writing-mode-vertical transform -rotate-180" style={{ writingMode: 'vertical-rl' }}>
              LIKELIHOOD →
            </span>
          </div>

          <div className="flex-1">
            {/* Grid */}
            <div className="grid grid-cols-6 gap-1">
              {/* Header row */}
              <div className="h-10" />
              {[1, 2, 3, 4, 5].map(i => (
                <div key={i} className="h-10 flex items-center justify-center text-xs text-bia-text-tertiary font-medium">
                  {i === 1 ? 'Very Low' : i === 2 ? 'Low' : i === 3 ? 'Medium' : i === 4 ? 'High' : 'Very High'}
                </div>
              ))}

              {/* Grid rows (5 to 1) */}
              {[5, 4, 3, 2, 1].map(likelihood => (
                <>
                  {/* Row label */}
                  <div key={`label-${likelihood}`} className="h-20 flex items-center justify-center text-xs text-bia-text-tertiary">
                    {likelihood}
                  </div>
                  {/* Cells */}
                  {[1, 2, 3, 4, 5].map(impact => {
                    const key = `${likelihood}-${impact}`;
                    const cellProcesses = gridCells[key] || [];
                    return (
                      <div
                        key={key}
                        className={`h-20 rounded border ${getCellColor(likelihood, impact)} p-1 flex flex-wrap gap-1 content-start overflow-hidden relative group`}
                      >
                        {cellProcesses.slice(0, 4).map((p, i) => (
                          <button
                            key={p.id}
                            onClick={() => setSelectedProcess(p)}
                            className={`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold transition-transform hover:scale-110 ${
                              p.criticality === 'critical' ? 'bg-red-500 text-white' :
                              p.criticality === 'high' ? 'bg-orange-500 text-white' :
                              p.criticality === 'medium' ? 'bg-blue-500 text-white' :
                              'bg-green-500 text-white'
                            }`}
                            title={p.name}
                          >
                            {p.name.slice(0, 2).toUpperCase()}
                          </button>
                        ))}
                        {cellProcesses.length > 4 && (
                          <span className="text-[10px] text-bia-text-tertiary">+{cellProcesses.length - 4}</span>
                        )}
                        {/* Quadrant tooltip on hover */}
                        <div className="absolute inset-0 opacity-0 group-hover:opacity-100 bg-black/80 flex items-center justify-center transition-opacity pointer-events-none z-10">
                          <span className="text-[10px] text-white text-center px-1">{getQuadrantLabel(likelihood, impact)}</span>
                        </div>
                      </div>
                    );
                  })}
                </>
              ))}
            </div>

            {/* X-axis label */}
            <div className="text-center mt-2">
              <span className="text-xs text-bia-text-tertiary">IMPACT →</span>
            </div>
          </div>
        </div>

        {/* Legend */}
        <div className="flex justify-center gap-4 mt-4 pt-4 border-t border-bia-border">
          <div className="flex items-center gap-2"><div className="w-4 h-4 rounded bg-red-500/50" /><span className="text-xs text-bia-text-secondary">Critical (≥20)</span></div>
          <div className="flex items-center gap-2"><div className="w-4 h-4 rounded bg-orange-500/50" /><span className="text-xs text-bia-text-secondary">High (12-19)</span></div>
          <div className="flex items-center gap-2"><div className="w-4 h-4 rounded bg-yellow-500/50" /><span className="text-xs text-bia-text-secondary">Medium (6-11)</span></div>
          <div className="flex items-center gap-2"><div className="w-4 h-4 rounded bg-green-500/50" /><span className="text-xs text-bia-text-secondary">Low (&lt;6)</span></div>
        </div>
      </div>

      {/* Selected Process Detail */}
      {selectedProcess && (
        <div className="glass-panel p-6 border-2 border-bia-primary/50">
          <div className="flex items-start justify-between mb-4">
            <div>
              <h3 className="text-lg font-semibold text-bia-text-primary">{selectedProcess.name}</h3>
              <p className="text-sm text-bia-text-tertiary">{selectedProcess.department} • {selectedProcess.owner}</p>
            </div>
            <button onClick={() => setSelectedProcess(null)} className="text-bia-text-tertiary hover:text-bia-text-primary">
              <XCircle className="w-5 h-5" />
            </button>
          </div>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div className="text-center p-3 bg-black/20 rounded">
              <p className="text-xs text-bia-text-tertiary">Criticality</p>
              <p className={`text-lg font-bold criticality-${selectedProcess.criticality}`}>{selectedProcess.criticality}</p>
            </div>
            <div className="text-center p-3 bg-black/20 rounded">
              <p className="text-xs text-bia-text-tertiary">Likelihood</p>
              <p className="text-lg font-bold text-bia-warning">{selectedProcess.likelihood}/5</p>
            </div>
            <div className="text-center p-3 bg-black/20 rounded">
              <p className="text-xs text-bia-text-tertiary">Impact</p>
              <p className="text-lg font-bold text-bia-secondary">{selectedProcess.impact}/5</p>
            </div>
            <div className="text-center p-3 bg-black/20 rounded">
              <p className="text-xs text-bia-text-tertiary">Risk Score</p>
              <p className="text-lg font-bold text-bia-critical">{selectedProcess.riskScore}</p>
            </div>
          </div>
          <p className="text-sm text-bia-text-secondary mt-4">{selectedProcess.description}</p>
        </div>
      )}

      {/* Process List sorted by risk */}
      <div className="glass-panel p-6">
        <h3 className="text-lg font-semibold text-bia-text-primary mb-4">All Processes by Risk Score</h3>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-black/20">
              <tr className="text-left text-xs text-bia-text-secondary uppercase">
                <th className="p-3">Process</th>
                <th className="p-3">Department</th>
                <th className="p-3">Criticality</th>
                <th className="p-3">Likelihood</th>
                <th className="p-3">Impact</th>
                <th className="p-3">Risk Score</th>
                <th className="p-3">Zone</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-[rgba(255,255,255,0.05)]">
              {[...filteredProcesses].sort((a, b) => b.riskScore - a.riskScore).map((p) => {
                const risk = p.likelihood * p.impact;
                const zone = risk >= 20 ? 'Critical' : risk >= 12 ? 'High' : risk >= 6 ? 'Medium' : 'Low';
                const zoneColor = risk >= 20 ? 'text-red-400 bg-red-500/20' : risk >= 12 ? 'text-orange-400 bg-orange-500/20' : risk >= 6 ? 'text-yellow-400 bg-yellow-500/20' : 'text-green-400 bg-green-500/20';
                return (
                  <tr key={p.id} className="hover:bg-[rgba(255,255,255,0.02)] cursor-pointer" onClick={() => setSelectedProcess(p)}>
                    <td className="p-3 text-bia-text-primary font-medium">{p.name}</td>
                    <td className="p-3 text-bia-text-secondary">{p.department}</td>
                    <td className="p-3"><span className={`px-2 py-1 rounded-full text-xs font-medium criticality-${p.criticality}`}>{p.criticality}</span></td>
                    <td className="p-3 text-bia-text-secondary">{p.likelihood}/5</td>
                    <td className="p-3 text-bia-text-secondary">{p.impact}/5</td>
                    <td className="p-3 text-bia-warning font-bold">{p.riskScore}</td>
                    <td className="p-3"><span className={`px-2 py-1 rounded text-xs ${zoneColor}`}>{zone}</span></td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

export function Reports() {
  const { processes, impacts, recoveryObjectives, settings, temporalData } = useStore();
  const [activeReport, setActiveReport] = useState<ReportType>('executive');

  const categories = settings.impactCategories || DEFAULT_IMPACT_CATEGORIES;
  const businessResources = settings.businessResources || DEFAULT_BUSINESS_RESOURCES;
  const timelinePoints = settings.customTimelinePoints || [];

  // Load dependency maps from localStorage
  const dependencyMaps = useMemo(() => {
    try {
      const saved = localStorage.getItem('bia-process-dependency-maps');
      return saved ? JSON.parse(saved) : {};
    } catch { return {}; }
  }, []);

  // Calculate risk score using dynamic categories
  const calculateRiskScore = (processId: string): number => {
    const impact = impacts[processId] as Record<string, number> | undefined;
    if (!impact) return 0;
    let total = 0, weightSum = 0;
    categories.forEach(cat => {
      const value = impact[cat.id] || 0;
      total += value * cat.weight;
      weightSum += cat.weight;
    });
    return weightSum > 0 ? parseFloat((total / weightSum).toFixed(2)) : 0;
  };

  const criticalCount = processes.filter(p => p.criticality === 'critical').length;
  const highCount = processes.filter(p => p.criticality === 'high').length;
  const compliantCount = processes.filter(p => p.status === 'approved').length;
  const avgRisk = processes.length > 0 
    ? (processes.reduce((a, p) => a + calculateRiskScore(p.id), 0) / processes.length).toFixed(2) 
    : '0.00';

  // BCDR Gap Analysis
  const bcdrAnalysis = useMemo(() => {
    const rtoGaps: { processName: string; processRTO: number; resourceName: string; resourceRTO: number; gap: number }[] = [];
    const rpoGaps: { processName: string; processRPO: number; resourceName: string; resourceRPO: number; gap: number }[] = [];
    const singlePointsOfFailure: { resourceName: string; resourceId: string; processCount: number; processes: string[] }[] = [];
    const missingDependencies: { processId: string; processName: string }[] = [];
    const cascadeImpacts: { resourceName: string; resourceId: string; affectedProcesses: string[] }[] = [];
    const quantityWarnings: { processName: string; timepoint: string; needed: number; available: number }[] = [];
    const recoveryPriority: { processId: string; processName: string; criticality: string; rto: number; score: number }[] = [];

    // Resource usage map
    const resourceUsage: Record<string, string[]> = {};

    // Analyze each process
    processes.forEach(process => {
      const processRecovery = recoveryObjectives[process.id];
      const processRTOHours = processRecovery?.rto || Infinity;
      const processRPOHours = processRecovery?.rpo || Infinity;
      
      // Check if process has dependency mapping
      const depMap = dependencyMaps[process.id];
      if (!depMap || depMap.nodes?.length <= 1) {
        missingDependencies.push({ processId: process.id, processName: process.name });
      }

      // Analyze dependencies
      if (depMap?.nodes) {
        depMap.nodes.forEach((node: any) => {
          if (node.data?.resourceType) {
            // It's a resource node
            const resource = businessResources.find(r => node.data.label === r.name);
            if (resource) {
              // Track resource usage
              if (!resourceUsage[resource.id]) resourceUsage[resource.id] = [];
              if (!resourceUsage[resource.id].includes(process.name)) {
                resourceUsage[resource.id].push(process.name);
              }

              // RTO gap analysis
              const resourceRTOHours = timeValueToHours(resource.rto);
              if (resourceRTOHours > processRTOHours && processRTOHours < Infinity) {
                rtoGaps.push({
                  processName: process.name,
                  processRTO: processRTOHours,
                  resourceName: resource.name,
                  resourceRTO: resourceRTOHours,
                  gap: resourceRTOHours - processRTOHours
                });
              }

              // RPO gap analysis (for data/systems)
              if (resource.type === 'data' || resource.type === 'systems') {
                const resourceRPOHours = timeValueToHours(resource.rpo);
                if (resourceRPOHours > processRPOHours && processRPOHours < Infinity) {
                  rpoGaps.push({
                    processName: process.name,
                    processRPO: processRPOHours,
                    resourceName: resource.name,
                    resourceRPO: resourceRPOHours,
                    gap: resourceRPOHours - processRPOHours
                  });
                }
              }
            }
          }
        });
      }

      // Recovery priority
      const critScore = process.criticality === 'critical' ? 5 : process.criticality === 'high' ? 4 : process.criticality === 'medium' ? 3 : 2;
      const riskScore = calculateRiskScore(process.id);
      recoveryPriority.push({
        processId: process.id,
        processName: process.name,
        criticality: process.criticality,
        rto: processRTOHours === Infinity ? 999 : processRTOHours,
        score: critScore * 10 + riskScore * 5 + (processRTOHours < 24 ? 20 : processRTOHours < 72 ? 10 : 0)
      });
    });

    // Single points of failure & cascade impact
    Object.entries(resourceUsage).forEach(([resourceId, procs]) => {
      const resource = businessResources.find(r => r.id === resourceId);
      if (!resource) return;
      
      if (procs.length >= 2) {
        singlePointsOfFailure.push({
          resourceName: resource.name,
          resourceId,
          processCount: procs.length,
          processes: procs
        });
      }
      if (procs.length > 0) {
        cascadeImpacts.push({
          resourceName: resource.name,
          resourceId,
          affectedProcesses: procs
        });
      }
    });

    // Sort recovery priority
    recoveryPriority.sort((a, b) => b.score - a.score);

    // Calculate readiness score
    const totalChecks = processes.length * 4; // RTO, RPO, dependencies, quantities
    let passedChecks = 0;
    
    // RTO alignment
    passedChecks += processes.length - rtoGaps.length;
    // RPO alignment  
    passedChecks += processes.length - rpoGaps.length;
    // Dependency coverage
    passedChecks += processes.length - missingDependencies.length;
    // No single points of failure penalty
    passedChecks += Math.max(0, processes.length - singlePointsOfFailure.length);

    const readinessScore = totalChecks > 0 ? Math.round((passedChecks / totalChecks) * 100) : 0;

    return {
      rtoGaps,
      rpoGaps,
      singlePointsOfFailure,
      missingDependencies,
      cascadeImpacts,
      quantityWarnings,
      recoveryPriority: recoveryPriority.slice(0, 10),
      readinessScore,
      criticalIssues: rtoGaps.length + rpoGaps.length,
      warnings: singlePointsOfFailure.length + missingDependencies.length
    };
  }, [processes, recoveryObjectives, dependencyMaps, businessResources, categories, calculateRiskScore]);

  const getReadinessColor = (score: number) => {
    if (score >= 80) return 'text-bia-success';
    if (score >= 60) return 'text-bia-warning';
    return 'text-bia-critical';
  };

  const getReadinessBg = (score: number) => {
    if (score >= 80) return 'bg-bia-success/20 border-bia-success/50';
    if (score >= 60) return 'bg-bia-warning/20 border-bia-warning/50';
    return 'bg-bia-critical/20 border-bia-critical/50';
  };

  const riskMatrixData = processes.map((p) => {
    const impact = impacts[p.id] as Record<string, number> | undefined;
    const avgImpact = impact 
      ? categories.reduce((sum, cat) => sum + (impact[cat.id] || 0), 0) / categories.length 
      : 0;
    const criticality = p.criticality === 'critical' ? 5 : p.criticality === 'high' ? 4 : p.criticality === 'medium' ? 3 : 2;
    return { name: p.name, likelihood: criticality, impact: avgImpact, z: 100, criticality: p.criticality };
  });

  const getColor = (crit: string) => {
    if (crit === 'critical') return '#F87171';
    if (crit === 'high') return '#FBBF24';
    if (crit === 'medium') return '#60A5FA';
    return '#34D399';
  };

  const downloadReport = () => {
    const content = generateReportContent();
    const blob = new Blob([content], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `bia-${activeReport}-report.txt`;
    a.click();
    URL.revokeObjectURL(url);
  };

  const generateReportContent = () => {
    const date = new Date().toISOString().split('T')[0];
    let content = `BIA Report - ${activeReport.toUpperCase()}\nGenerated: ${date}\n${'='.repeat(50)}\n\n`;

    if (activeReport === 'executive') {
      content += `EXECUTIVE SUMMARY\n\nTotal Processes: ${processes.length}\nCritical Processes: ${criticalCount}\nHigh Priority: ${highCount}\nAverage Risk Score: ${avgRisk}/5\nCompliance Rate: ${processes.length > 0 ? ((compliantCount / processes.length) * 100).toFixed(0) : 0}%\n\n`;
      content += `IMPACT CATEGORIES:\n`;
      categories.forEach(cat => {
        content += `- ${cat.name} (${cat.weight}%): ${cat.description}\n`;
      });
    } else if (activeReport === 'bcdr-gap') {
      content += `BCDR GAP ANALYSIS\n\n`;
      content += `BCDR Readiness Score: ${bcdrAnalysis.readinessScore}%\n`;
      content += `Critical Issues: ${bcdrAnalysis.criticalIssues}\n`;
      content += `Warnings: ${bcdrAnalysis.warnings}\n\n`;
      
      content += `RTO GAPS:\n`;
      bcdrAnalysis.rtoGaps.forEach(g => {
        content += `- ${g.processName} needs ${g.processRTO}h, but ${g.resourceName} has RTO of ${g.resourceRTO}h (Gap: ${g.gap}h)\n`;
      });
      
      content += `\nRPO GAPS:\n`;
      bcdrAnalysis.rpoGaps.forEach(g => {
        content += `- ${g.processName} needs RPO ${g.processRPO}h, but ${g.resourceName} has RPO of ${g.resourceRPO}h\n`;
      });
      
      content += `\nSINGLE POINTS OF FAILURE:\n`;
      bcdrAnalysis.singlePointsOfFailure.forEach(s => {
        content += `- ${s.resourceName} affects ${s.processCount} processes: ${s.processes.join(', ')}\n`;
      });

      content += `\nRECOVERY PRIORITY:\n`;
      bcdrAnalysis.recoveryPriority.forEach((p, i) => {
        content += `${i + 1}. ${p.processName} (${p.criticality}, RTO: ${p.rto}h)\n`;
      });
    } else if (activeReport === 'risk-matrix') {
      content += `RISK MATRIX\n\n`;
      processes.forEach(p => {
        const impact = impacts[p.id] as Record<string, number> | undefined;
        content += `\n${p.name}\n  Criticality: ${p.criticality}\n`;
        categories.forEach(cat => {
          content += `  ${cat.name}: ${impact?.[cat.id] || 0}/5\n`;
        });
      });
    } else {
      content += `COMPLIANCE REPORT (ISO 22301:2019)\n\n`;
      processes.forEach(p => {
        const recovery = recoveryObjectives[p.id];
        content += `${p.name}\n  Status: ${p.status}\n  RTO: ${recovery?.rto || '-'}h\n  RPO: ${recovery?.rpo || '-'}h\n  MTPD: ${recovery?.mtpd || '-'}h\n\n`;
      });
    }
    return content;
  };

  return (
    <div className="animate-fade-in space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Reports</h1>
          <p className="text-bia-text-secondary mt-1">Generate and export BIA reports</p>
        </div>
        <button onClick={downloadReport} className="glass-button-solid flex items-center gap-2">
          <Download className="w-4 h-4" /> Export Report
        </button>
      </div>

      {/* Report Tabs */}
      <div className="glass-panel p-2 flex flex-wrap gap-2">
        {[
          { id: 'executive', label: 'Executive Summary', icon: FileText },
          { id: 'risk-matrix', label: 'Risk Matrix', icon: AlertTriangle },
          { id: 'compliance', label: 'Compliance', icon: CheckCircle },
          { id: 'bcdr-gap', label: 'BCDR Gap Analysis', icon: Shield },
        ].map((tab) => (
          <button key={tab.id} onClick={() => setActiveReport(tab.id as ReportType)}
            className={`flex items-center gap-2 px-4 py-2 rounded-bia-sm transition-all ${activeReport === tab.id ? 'bg-bia-glass-active text-bia-primary' : 'text-bia-text-secondary hover:text-bia-text-primary'}`}>
            <tab.icon className="w-4 h-4" />
            {tab.label}
          </button>
        ))}
      </div>

      {/* BCDR Gap Analysis */}
      {activeReport === 'bcdr-gap' && (
        <div className="space-y-6">
          {/* Readiness Score */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div className={`glass-panel p-6 text-center border-2 ${getReadinessBg(bcdrAnalysis.readinessScore)}`}>
              <p className="text-bia-text-secondary text-sm">BCDR Readiness</p>
              <p className={`text-4xl font-bold mt-2 ${getReadinessColor(bcdrAnalysis.readinessScore)}`}>{bcdrAnalysis.readinessScore}%</p>
            </div>
            <div className="glass-panel p-6 text-center">
              <p className="text-bia-text-secondary text-sm">Critical Issues</p>
              <p className="text-4xl font-bold text-bia-critical mt-2">{bcdrAnalysis.criticalIssues}</p>
            </div>
            <div className="glass-panel p-6 text-center">
              <p className="text-bia-text-secondary text-sm">Warnings</p>
              <p className="text-4xl font-bold text-bia-warning mt-2">{bcdrAnalysis.warnings}</p>
            </div>
            <div className="glass-panel p-6 text-center">
              <p className="text-bia-text-secondary text-sm">Resources Mapped</p>
              <p className="text-4xl font-bold text-bia-primary mt-2">{businessResources.length}</p>
            </div>
          </div>

          {/* RTO Gaps */}
          <div className="glass-panel p-6">
            <h3 className="text-lg font-semibold text-bia-text-primary mb-4 flex items-center gap-2">
              <Clock className="w-5 h-5 text-bia-critical" /> RTO Gap Analysis
            </h3>
            {bcdrAnalysis.rtoGaps.length === 0 ? (
              <div className="flex items-center gap-2 text-bia-success">
                <CheckCircle className="w-5 h-5" />
                <span>All resource RTOs align with process requirements</span>
              </div>
            ) : (
              <div className="space-y-2">
                {bcdrAnalysis.rtoGaps.map((gap, i) => (
                  <div key={i} className="p-3 bg-bia-critical/10 border border-bia-critical/30 rounded-lg flex items-start gap-3">
                    <AlertOctagon className="w-5 h-5 text-bia-critical flex-shrink-0 mt-0.5" />
                    <div>
                      <p className="text-bia-text-primary">
                        <span className="font-medium">{gap.processName}</span> requires recovery in <span className="text-bia-warning font-bold">{gap.processRTO}h</span>, 
                        but <span className="font-medium">{gap.resourceName}</span> has RTO of <span className="text-bia-critical font-bold">{gap.resourceRTO}h</span>
                      </p>
                      <p className="text-xs text-bia-text-tertiary mt-1">Gap: {gap.gap} hours - Resource is a bottleneck</p>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* RPO Gaps */}
          <div className="glass-panel p-6">
            <h3 className="text-lg font-semibold text-bia-text-primary mb-4 flex items-center gap-2">
              <Layers className="w-5 h-5 text-bia-secondary" /> RPO Compliance Check
            </h3>
            {bcdrAnalysis.rpoGaps.length === 0 ? (
              <div className="flex items-center gap-2 text-bia-success">
                <CheckCircle className="w-5 h-5" />
                <span>All data/system resource RPOs meet process requirements</span>
              </div>
            ) : (
              <div className="space-y-2">
                {bcdrAnalysis.rpoGaps.map((gap, i) => (
                  <div key={i} className="p-3 bg-bia-warning/10 border border-bia-warning/30 rounded-lg flex items-start gap-3">
                    <AlertTriangle className="w-5 h-5 text-bia-warning flex-shrink-0 mt-0.5" />
                    <div>
                      <p className="text-bia-text-primary">
                        <span className="font-medium">{gap.processName}</span> requires RPO of <span className="text-bia-secondary font-bold">{gap.processRPO}h</span>, 
                        but <span className="font-medium">{gap.resourceName}</span> has RPO of <span className="text-bia-warning font-bold">{gap.resourceRPO}h</span>
                      </p>
                      <p className="text-xs text-bia-text-tertiary mt-1">Potential data loss exceeds acceptable limits</p>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Single Points of Failure */}
          <div className="glass-panel p-6">
            <h3 className="text-lg font-semibold text-bia-text-primary mb-4 flex items-center gap-2">
              <AlertTriangle className="w-5 h-5 text-bia-warning" /> Single Points of Failure
            </h3>
            {bcdrAnalysis.singlePointsOfFailure.length === 0 ? (
              <div className="flex items-center gap-2 text-bia-success">
                <CheckCircle className="w-5 h-5" />
                <span>No single points of failure detected</span>
              </div>
            ) : (
              <div className="space-y-2">
                {bcdrAnalysis.singlePointsOfFailure.map((spof, i) => (
                  <div key={i} className="p-3 bg-bia-warning/10 border border-bia-warning/30 rounded-lg">
                    <div className="flex items-center gap-2 mb-2">
                      <Users className="w-4 h-4 text-bia-warning" />
                      <span className="text-bia-text-primary font-medium">{spof.resourceName}</span>
                      <span className="text-xs px-2 py-0.5 bg-bia-warning/20 text-bia-warning rounded">Affects {spof.processCount} processes</span>
                    </div>
                    <p className="text-sm text-bia-text-tertiary">
                      If this resource fails: <span className="text-bia-text-secondary">{spof.processes.join(', ')}</span> will be impacted
                    </p>
                  </div>
                ))}
              </div>
            )}
          </div>

          {/* Missing Dependencies */}
          {bcdrAnalysis.missingDependencies.length > 0 && (
            <div className="glass-panel p-6">
              <h3 className="text-lg font-semibold text-bia-text-primary mb-4 flex items-center gap-2">
                <XCircle className="w-5 h-5 text-bia-text-tertiary" /> Missing Dependency Mappings
              </h3>
              <div className="flex flex-wrap gap-2">
                {bcdrAnalysis.missingDependencies.map((m, i) => (
                  <span key={i} className="px-3 py-1.5 bg-black/30 border border-bia-border rounded text-sm text-bia-text-secondary">
                    {m.processName}
                  </span>
                ))}
              </div>
              <p className="text-xs text-bia-text-tertiary mt-2">These processes have no resource dependencies mapped in Process Dependencies</p>
            </div>
          )}

          {/* Recovery Priority Matrix */}
          <div className="glass-panel p-6">
            <h3 className="text-lg font-semibold text-bia-text-primary mb-4 flex items-center gap-2">
              <Shield className="w-5 h-5 text-bia-primary" /> Recovery Priority Matrix
            </h3>
            <p className="text-sm text-bia-text-tertiary mb-4">Suggested recovery order based on criticality, impact scores, and RTO requirements</p>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-black/20">
                  <tr className="text-left text-xs text-bia-text-secondary uppercase">
                    <th className="p-3">Priority</th>
                    <th className="p-3">Process</th>
                    <th className="p-3">Criticality</th>
                    <th className="p-3">RTO</th>
                    <th className="p-3">Priority Score</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-[rgba(255,255,255,0.05)]">
                  {bcdrAnalysis.recoveryPriority.map((p, i) => (
                    <tr key={p.processId} className="hover:bg-[rgba(255,255,255,0.02)]">
                      <td className="p-3">
                        <span className={`w-6 h-6 rounded-full inline-flex items-center justify-center text-xs font-bold ${
                          i < 3 ? 'bg-bia-critical text-white' : i < 6 ? 'bg-bia-warning text-black' : 'bg-bia-border text-bia-text-primary'
                        }`}>{i + 1}</span>
                      </td>
                      <td className="p-3 text-bia-text-primary font-medium">{p.processName}</td>
                      <td className="p-3"><span className={`px-2 py-1 rounded-full text-xs font-medium criticality-${p.criticality}`}>{p.criticality}</span></td>
                      <td className="p-3 text-bia-text-secondary">{p.rto === 999 ? 'Not set' : `${p.rto}h`}</td>
                      <td className="p-3 text-bia-primary font-bold">{p.score}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      )}

      {/* Executive Summary */}
      {activeReport === 'executive' && (
        <div className="space-y-6">
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div className="glass-panel p-6 text-center">
              <p className="text-bia-text-secondary text-sm">Total Processes</p>
              <p className="text-4xl font-bold text-bia-primary mt-2">{processes.length}</p>
            </div>
            <div className="glass-panel p-6 text-center">
              <p className="text-bia-text-secondary text-sm">Critical</p>
              <p className="text-4xl font-bold text-bia-critical mt-2">{criticalCount}</p>
            </div>
            <div className="glass-panel p-6 text-center">
              <p className="text-bia-text-secondary text-sm">Avg Risk Score</p>
              <p className="text-4xl font-bold text-bia-warning mt-2">{avgRisk}</p>
            </div>
            <div className="glass-panel p-6 text-center">
              <p className="text-bia-text-secondary text-sm">Compliance</p>
              <p className="text-4xl font-bold text-bia-success mt-2">{processes.length > 0 ? ((compliantCount / processes.length) * 100).toFixed(0) : 0}%</p>
            </div>
          </div>

          <div className="glass-panel p-6">
            <h3 className="text-lg font-semibold text-bia-text-primary mb-4">Impact Categories</h3>
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
              {categories.map(cat => (
                <div key={cat.id} className="p-3 bg-black/20 rounded-lg text-center">
                  <div className="w-4 h-4 rounded mx-auto mb-2" style={{ backgroundColor: cat.color }} />
                  <p className="text-sm text-bia-text-primary font-medium">{cat.name}</p>
                  <p className="text-xs text-bia-text-tertiary">{cat.weight}%</p>
                </div>
              ))}
            </div>
          </div>

          <div className="glass-panel p-6">
            <h3 className="text-lg font-semibold text-bia-text-primary mb-4">Critical Process Summary</h3>
            <div className="space-y-3">
              {processes.filter(p => p.criticality === 'critical' || p.criticality === 'high').map(p => (
                <div key={p.id} className="flex items-center justify-between p-3 rounded-bia-sm bg-black/20">
                  <div>
                    <p className="text-bia-text-primary font-medium">{p.name}</p>
                    <p className="text-sm text-bia-text-tertiary">{p.department} - {p.owner}</p>
                  </div>
                  <div className="flex items-center gap-4">
                    <span className={`px-2 py-1 rounded-full text-xs font-medium criticality-${p.criticality}`}>{p.criticality}</span>
                    <span className="text-bia-text-primary font-mono">Risk: {calculateRiskScore(p.id)}</span>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* Risk Matrix */}
      {activeReport === 'risk-matrix' && (
        <RiskMatrixView 
          processes={processes} 
          impacts={impacts} 
          categories={categories}
          calculateRiskScore={calculateRiskScore}
        />
      )}

      {/* Compliance */}
      {activeReport === 'compliance' && (
        <div className="glass-panel p-6">
          <h3 className="text-lg font-semibold text-bia-text-primary mb-4">ISO 22301:2019 Compliance Status</h3>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-black/20">
                <tr className="text-left text-xs text-bia-text-secondary uppercase">
                  <th className="p-3">Process</th>
                  <th className="p-3">Status</th>
                  <th className="p-3">RTO</th>
                  <th className="p-3">RPO</th>
                  <th className="p-3">MTPD</th>
                  <th className="p-3">Strategy</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-[rgba(255,255,255,0.05)]">
                {processes.map((p) => {
                  const r = recoveryObjectives[p.id];
                  return (
                    <tr key={p.id} className="hover:bg-[rgba(255,255,255,0.02)]">
                      <td className="p-3 text-bia-text-primary">{p.name}</td>
                      <td className="p-3">
                        {p.status === 'approved' ? <CheckCircle className="w-5 h-5 text-bia-success" /> : <XCircle className="w-5 h-5 text-bia-warning" />}
                      </td>
                      <td className="p-3 text-bia-text-secondary">{r?.rto || '-'}h</td>
                      <td className="p-3 text-bia-text-secondary">{r?.rpo || '-'}h</td>
                      <td className="p-3 text-bia-text-secondary">{r?.mtpd || '-'}h</td>
                      <td className="p-3 text-bia-text-secondary capitalize">{r?.recoveryStrategy?.replace('-', ' ') || '-'}</td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </div>
      )}
    </div>
  );
}


--- FILE END: src\components\Reports.tsx ---


--- FILE START: src\components\Settings.tsx ---

import { useState } from 'react';
import { useStore } from '../store/useStore';
import { Settings as SettingsType, DEFAULT_SETTINGS, CustomTimelinePoint, DEFAULT_CUSTOM_TIMELINE_POINTS, ImpactCategory, DEFAULT_IMPACT_CATEGORIES, BusinessResource, RESOURCE_TYPES, DEFAULT_BUSINESS_RESOURCES, TimeValue, TimeUnit } from '../types';
import { Save, RotateCcw, Download, Upload, Trash2, AlertTriangle, HelpCircle, BookOpen, Plus, Clock, Edit2, X, Layers, ChevronDown, ChevronUp, Package } from 'lucide-react';

export function Settings() {
  const { settings, updateSettings, exportData, importData, clearAllData, toggleGlossary } = useStore();
  const [localSettings, setLocalSettings] = useState<SettingsType>(settings);
  const [saved, setSaved] = useState(false);
  const [showClearConfirm, setShowClearConfirm] = useState(false);
  const [importError, setImportError] = useState('');
  const [importSuccess, setImportSuccess] = useState(false);

  const handleSave = () => {
    updateSettings(localSettings);
    setSaved(true);
    setTimeout(() => setSaved(false), 2000);
  };

  const handleReset = () => {
    setLocalSettings(DEFAULT_SETTINGS);
    updateSettings(DEFAULT_SETTINGS);
  };

  const handleExport = () => {
    const data = exportData();
    const blob = new Blob([data], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `bia-export-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    URL.revokeObjectURL(url);
  };

  const handleImport = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      const result = ev.target?.result as string;
      if (importData(result)) {
        setImportSuccess(true);
        setImportError('');
        setTimeout(() => setImportSuccess(false), 3000);
      } else {
        setImportError('Invalid file format. Please use a valid BIA export file.');
      }
    };
    reader.readAsText(file);
  };

  const handleClearAll = () => {
    clearAllData();
    setShowClearConfirm(false);
  };

  const weights = localSettings.impactWeights;
  const totalWeight = Object.values(weights).reduce((a, b) => a + b, 0);
  const [editingPoint, setEditingPoint] = useState<CustomTimelinePoint | null>(null);
  const [newPoint, setNewPoint] = useState<Omit<CustomTimelinePoint, 'id'>>({ label: '', value: 1, unit: 'hours' });
  const [showAddPoint, setShowAddPoint] = useState(false);

  const handleAddTimelinePoint = () => {
    if (!newPoint.label.trim()) return;
    const point: CustomTimelinePoint = { ...newPoint, id: `ctp-${Date.now()}` };
    setLocalSettings({
      ...localSettings,
      customTimelinePoints: [...(localSettings.customTimelinePoints || []), point]
    });
    setNewPoint({ label: '', value: 1, unit: 'hours' });
    setShowAddPoint(false);
  };

  const handleUpdateTimelinePoint = (updated: CustomTimelinePoint) => {
    setLocalSettings({
      ...localSettings,
      customTimelinePoints: localSettings.customTimelinePoints.map(p => p.id === updated.id ? updated : p)
    });
    setEditingPoint(null);
  };

  const handleDeleteTimelinePoint = (id: string) => {
    setLocalSettings({
      ...localSettings,
      customTimelinePoints: localSettings.customTimelinePoints.filter(p => p.id !== id)
    });
  };

  const handleResetTimelinePoints = () => {
    setLocalSettings({ ...localSettings, customTimelinePoints: DEFAULT_CUSTOM_TIMELINE_POINTS });
  };

  // Impact Categories state
  const [expandedCategory, setExpandedCategory] = useState<string | null>(null);
  const [editingCategory, setEditingCategory] = useState<ImpactCategory | null>(null);
  const [showAddCategory, setShowAddCategory] = useState(false);
  const [newCategory, setNewCategory] = useState<Omit<ImpactCategory, 'id' | 'timeBasedDefinitions'>>({ name: '', description: '', weight: 10, color: '#818CF8' });

  const impactCategories = localSettings.impactCategories || DEFAULT_IMPACT_CATEGORIES;
  const timelinePoints = localSettings.customTimelinePoints || DEFAULT_CUSTOM_TIMELINE_POINTS;

  const handleAddCategory = () => {
    if (!newCategory.name.trim()) return;
    const cat: ImpactCategory = {
      ...newCategory,
      id: `cat-${Date.now()}`,
      timeBasedDefinitions: timelinePoints.map(tp => ({ timelinePointId: tp.id, description: '' }))
    };
    setLocalSettings({ ...localSettings, impactCategories: [...impactCategories, cat] });
    setNewCategory({ name: '', description: '', weight: 10, color: '#818CF8' });
    setShowAddCategory(false);
  };

  const handleUpdateCategory = (updated: ImpactCategory) => {
    setLocalSettings({
      ...localSettings,
      impactCategories: impactCategories.map(c => c.id === updated.id ? updated : c)
    });
    setEditingCategory(null);
  };

  const handleDeleteCategory = (id: string) => {
    setLocalSettings({ ...localSettings, impactCategories: impactCategories.filter(c => c.id !== id) });
  };

  const handleUpdateDefinition = (categoryId: string, timelinePointId: string, description: string) => {
    setLocalSettings({
      ...localSettings,
      impactCategories: impactCategories.map(c => {
        if (c.id !== categoryId) return c;
        const defs = c.timeBasedDefinitions.map(d => d.timelinePointId === timelinePointId ? { ...d, description } : d);
        // Add missing timeline points
        timelinePoints.forEach(tp => {
          if (!defs.find(d => d.timelinePointId === tp.id)) {
            defs.push({ timelinePointId: tp.id, description: '' });
          }
        });
        return { ...c, timeBasedDefinitions: defs };
      })
    });
  };

  const handleResetCategories = () => {
    setLocalSettings({ ...localSettings, impactCategories: DEFAULT_IMPACT_CATEGORIES });
  };

  // Business Resources state
  const [editingResource, setEditingResource] = useState<BusinessResource | null>(null);
  const [showAddResource, setShowAddResource] = useState(false);
  const [expandedResourceId, setExpandedResourceId] = useState<string | null>(null);
  const [newResource, setNewResource] = useState<Omit<BusinessResource, 'id'>>({
    name: '', type: 'systems', description: '',
    rto: { value: 4, unit: 'hours' },
    rpo: { value: 1, unit: 'hours' },
    quantityAtIntervals: {}
  });

  const formatTimeValue = (tv?: TimeValue) => tv ? `${tv.value} ${tv.unit}` : '-';

  const businessResources = localSettings.businessResources || DEFAULT_BUSINESS_RESOURCES;

  const handleAddResource = () => {
    if (!newResource.name.trim()) return;
    const resource: BusinessResource = { ...newResource, id: `res-${Date.now()}` };
    setLocalSettings({ ...localSettings, businessResources: [...businessResources, resource] });
    setNewResource({ name: '', type: 'systems', description: '' });
    setShowAddResource(false);
  };

  const handleUpdateResource = (updated: BusinessResource) => {
    setLocalSettings({
      ...localSettings,
      businessResources: businessResources.map(r => r.id === updated.id ? updated : r)
    });
    setEditingResource(null);
  };

  const handleDeleteResource = (id: string) => {
    setLocalSettings({ ...localSettings, businessResources: businessResources.filter(r => r.id !== id) });
  };

  const handleResetResources = () => {
    setLocalSettings({ ...localSettings, businessResources: DEFAULT_BUSINESS_RESOURCES });
  };

  const getResourceTypeLabel = (type: string) => RESOURCE_TYPES.find(t => t.value === type)?.label || type;

  return (
    <div className="animate-fade-in space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Settings</h1>
          <p className="text-bia-text-secondary mt-1">Configure BIA Tool preferences and manage data</p>
        </div>
        <button onClick={toggleGlossary} className="glass-button flex items-center gap-2">
          <BookOpen className="w-4 h-4" /> Open Glossary
        </button>
      </div>

      {/* Impact Weights - Note: Now managed via Impact Categories below */}
      <div className="glass-panel p-6 space-y-4">
        <div className="flex items-center justify-between">
          <h3 className="text-lg font-semibold text-bia-text-primary">Impact Dimension Weights Summary</h3>
          <span className={`text-sm ${impactCategories.reduce((a, c) => a + c.weight, 0) === 100 ? 'text-bia-success' : 'text-bia-warning'}`}>
            Total: {impactCategories.reduce((a, c) => a + c.weight, 0)}%
          </span>
        </div>
        <p className="text-sm text-bia-text-tertiary">Weights are configured in the Impact Categories section below</p>
        <div className="flex flex-wrap gap-3">
          {impactCategories.map((cat) => (
            <div key={cat.id} className="flex items-center gap-2 px-3 py-2 bg-black/20 rounded-lg">
              <div className="w-3 h-3 rounded" style={{ backgroundColor: cat.color }} />
              <span className="text-bia-text-primary text-sm">{cat.name}</span>
              <span className="text-bia-text-tertiary text-sm">({cat.weight}%)</span>
            </div>
          ))}
        </div>
      </div>

      {/* Threshold */}
      <div className="glass-panel p-6 space-y-4">
        <h3 className="text-lg font-semibold text-bia-text-primary">Impact Threshold</h3>
        <p className="text-sm text-bia-text-tertiary">When any impact dimension reaches this level, it triggers MTPD calculation</p>
        <div className="flex items-center gap-4">
          <input type="range" min="1" max="5" value={localSettings.impactThreshold}
            onChange={(e) => setLocalSettings({ ...localSettings, impactThreshold: parseInt(e.target.value) })}
            className="w-48 accent-bia-primary" />
          <span className="text-2xl font-bold text-bia-warning">{localSettings.impactThreshold}</span>
          <span className="text-bia-text-tertiary">(1=Minor to 5=Catastrophic)</span>
        </div>
      </div>

      {/* Custom Timeline Points */}
      <div className="glass-panel p-6 space-y-4">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="text-lg font-semibold text-bia-text-primary flex items-center gap-2">
              <Clock className="w-5 h-5" /> Custom Timeline Points
            </h3>
            <p className="text-sm text-bia-text-tertiary mt-1">Define time intervals for temporal impact analysis</p>
          </div>
          <div className="flex gap-2">
            <button onClick={handleResetTimelinePoints} className="glass-button text-sm">Reset to Default</button>
            <button onClick={() => setShowAddPoint(true)} className="glass-button-solid text-sm flex items-center gap-1">
              <Plus className="w-4 h-4" /> Add Point
            </button>
          </div>
        </div>

        {/* Timeline Points List */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
          {(localSettings.customTimelinePoints || []).map((point) => (
            <div key={point.id} className="p-3 bg-black/20 rounded-lg border border-bia-border flex items-center justify-between">
              {editingPoint?.id === point.id ? (
                <div className="flex-1 flex items-center gap-2">
                  <input
                    type="text"
                    value={editingPoint.label}
                    onChange={(e) => setEditingPoint({ ...editingPoint, label: e.target.value })}
                    className="glass-input w-24 text-sm py-1"
                    placeholder="Label"
                  />
                  <input
                    type="number"
                    min="0"
                    value={editingPoint.value}
                    onChange={(e) => setEditingPoint({ ...editingPoint, value: parseInt(e.target.value) || 0 })}
                    className="glass-input w-16 text-sm py-1"
                  />
                  <select
                    value={editingPoint.unit}
                    onChange={(e) => setEditingPoint({ ...editingPoint, unit: e.target.value as 'hours' | 'days' | 'weeks' })}
                    className="glass-input text-sm py-1"
                  >
                    <option value="hours">hours</option>
                    <option value="days">days</option>
                    <option value="weeks">weeks</option>
                  </select>
                  <button onClick={() => handleUpdateTimelinePoint(editingPoint)} className="text-bia-success hover:opacity-80">
                    <Save className="w-4 h-4" />
                  </button>
                  <button onClick={() => setEditingPoint(null)} className="text-bia-text-tertiary hover:opacity-80">
                    <X className="w-4 h-4" />
                  </button>
                </div>
              ) : (
                <>
                  <div>
                    <span className="text-bia-text-primary font-medium">{point.label}</span>
                    <span className="text-bia-text-tertiary text-sm ml-2">({point.value} {point.unit})</span>
                  </div>
                  <div className="flex items-center gap-1">
                    <button onClick={() => setEditingPoint(point)} className="p-1 text-bia-text-tertiary hover:text-bia-primary">
                      <Edit2 className="w-4 h-4" />
                    </button>
                    <button onClick={() => handleDeleteTimelinePoint(point.id)} className="p-1 text-bia-text-tertiary hover:text-bia-critical">
                      <Trash2 className="w-4 h-4" />
                    </button>
                  </div>
                </>
              )}
            </div>
          ))}
        </div>

        {/* Add New Point Form */}
        {showAddPoint && (
          <div className="p-4 bg-black/30 rounded-lg border border-bia-primary/30 space-y-3">
            <h4 className="text-sm font-medium text-bia-text-primary">Add New Timeline Point</h4>
            <div className="flex items-center gap-3">
              <input
                type="text"
                value={newPoint.label}
                onChange={(e) => setNewPoint({ ...newPoint, label: e.target.value })}
                className="glass-input flex-1"
                placeholder="Label (e.g., '12 hours', '2 days')"
              />
              <input
                type="number"
                min="0"
                value={newPoint.value}
                onChange={(e) => setNewPoint({ ...newPoint, value: parseInt(e.target.value) || 0 })}
                className="glass-input w-20"
              />
              <select
                value={newPoint.unit}
                onChange={(e) => setNewPoint({ ...newPoint, unit: e.target.value as 'hours' | 'days' | 'weeks' })}
                className="glass-input"
              >
                <option value="hours">hours</option>
                <option value="days">days</option>
                <option value="weeks">weeks</option>
              </select>
              <button onClick={handleAddTimelinePoint} className="glass-button-solid">Add</button>
              <button onClick={() => setShowAddPoint(false)} className="glass-button">Cancel</button>
            </div>
          </div>
        )}
      </div>

      {/* Impact Categories */}
      <div className="glass-panel p-6 space-y-4">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="text-lg font-semibold text-bia-text-primary flex items-center gap-2">
              <Layers className="w-5 h-5" /> Impact Categories
            </h3>
            <p className="text-sm text-bia-text-tertiary mt-1">Define impact dimensions with time-based severity definitions</p>
          </div>
          <div className="flex gap-2">
            <button onClick={handleResetCategories} className="glass-button text-sm">Reset to Default</button>
            <button onClick={() => setShowAddCategory(true)} className="glass-button-solid text-sm flex items-center gap-1">
              <Plus className="w-4 h-4" /> Add Category
            </button>
          </div>
        </div>

        {/* Add New Category Form */}
        {showAddCategory && (
          <div className="p-4 bg-black/30 rounded-lg border border-bia-primary/30 space-y-3">
            <h4 className="text-sm font-medium text-bia-text-primary">Add New Impact Category</h4>
            <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
              <input type="text" value={newCategory.name} onChange={(e) => setNewCategory({ ...newCategory, name: e.target.value })}
                className="glass-input" placeholder="Category Name" />
              <input type="text" value={newCategory.description} onChange={(e) => setNewCategory({ ...newCategory, description: e.target.value })}
                className="glass-input" placeholder="Description" />
              <div className="flex items-center gap-2">
                <label className="text-sm text-bia-text-secondary">Weight:</label>
                <input type="number" min="1" max="100" value={newCategory.weight}
                  onChange={(e) => setNewCategory({ ...newCategory, weight: parseInt(e.target.value) || 10 })}
                  className="glass-input w-20" />
              </div>
              <div className="flex items-center gap-2">
                <label className="text-sm text-bia-text-secondary">Color:</label>
                <input type="color" value={newCategory.color} onChange={(e) => setNewCategory({ ...newCategory, color: e.target.value })}
                  className="w-10 h-8 rounded cursor-pointer" />
                <button onClick={handleAddCategory} className="glass-button-solid flex-1">Add</button>
                <button onClick={() => setShowAddCategory(false)} className="glass-button">Cancel</button>
              </div>
            </div>
          </div>
        )}

        {/* Categories List */}
        <div className="space-y-3">
          {impactCategories.map((cat) => (
            <div key={cat.id} className="bg-black/20 rounded-lg border border-bia-border overflow-hidden">
              {/* Category Header */}
              <div className="p-4 flex items-center justify-between cursor-pointer hover:bg-white/5"
                onClick={() => setExpandedCategory(expandedCategory === cat.id ? null : cat.id)}>
                <div className="flex items-center gap-3">
                  <div className="w-4 h-4 rounded" style={{ backgroundColor: cat.color }} />
                  {editingCategory?.id === cat.id ? (
                    <div className="flex items-center gap-2" onClick={(e) => e.stopPropagation()}>
                      <input type="text" value={editingCategory.name}
                        onChange={(e) => setEditingCategory({ ...editingCategory, name: e.target.value })}
                        className="glass-input text-sm py-1 w-32" />
                      <input type="text" value={editingCategory.description}
                        onChange={(e) => setEditingCategory({ ...editingCategory, description: e.target.value })}
                        className="glass-input text-sm py-1 w-48" placeholder="Description" />
                      <input type="number" min="1" max="100" value={editingCategory.weight}
                        onChange={(e) => setEditingCategory({ ...editingCategory, weight: parseInt(e.target.value) || 10 })}
                        className="glass-input text-sm py-1 w-16" />
                      <input type="color" value={editingCategory.color}
                        onChange={(e) => setEditingCategory({ ...editingCategory, color: e.target.value })}
                        className="w-8 h-6 rounded cursor-pointer" />
                      <button onClick={() => handleUpdateCategory(editingCategory)} className="text-bia-success"><Save className="w-4 h-4" /></button>
                      <button onClick={() => setEditingCategory(null)} className="text-bia-text-tertiary"><X className="w-4 h-4" /></button>
                    </div>
                  ) : (
                    <div>
                      <span className="text-bia-text-primary font-medium">{cat.name}</span>
                      <span className="text-bia-text-tertiary text-sm ml-2">({cat.weight}%)</span>
                      <p className="text-xs text-bia-text-tertiary">{cat.description}</p>
                    </div>
                  )}
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={(e) => { e.stopPropagation(); setEditingCategory(cat); }} className="p-1 text-bia-text-tertiary hover:text-bia-primary">
                    <Edit2 className="w-4 h-4" />
                  </button>
                  <button onClick={(e) => { e.stopPropagation(); handleDeleteCategory(cat.id); }} className="p-1 text-bia-text-tertiary hover:text-bia-critical">
                    <Trash2 className="w-4 h-4" />
                  </button>
                  {expandedCategory === cat.id ? <ChevronUp className="w-4 h-4 text-bia-text-tertiary" /> : <ChevronDown className="w-4 h-4 text-bia-text-tertiary" />}
                </div>
              </div>

              {/* Time-Based Definitions (Expanded) */}
              {expandedCategory === cat.id && (
                <div className="p-4 pt-0 border-t border-bia-border/50 mt-2">
                  <h5 className="text-sm font-medium text-bia-text-secondary mb-3">Time-Based Impact Definitions</h5>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    {timelinePoints.map((tp) => {
                      const def = cat.timeBasedDefinitions.find(d => d.timelinePointId === tp.id);
                      return (
                        <div key={tp.id} className="flex items-center gap-2">
                          <span className="text-xs text-bia-text-tertiary w-24 shrink-0">{tp.label}:</span>
                          <input type="text" value={def?.description || ''}
                            onChange={(e) => handleUpdateDefinition(cat.id, tp.id, e.target.value)}
                            className="glass-input text-sm py-1 flex-1"
                            placeholder={`Impact at ${tp.label}...`} />
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          ))}
        </div>
      </div>

      {/* Business Resources */}
      <div className="glass-panel p-6 space-y-4">
        <div className="flex items-center justify-between">
          <div>
            <h3 className="text-lg font-semibold text-bia-text-primary flex items-center gap-2">
              <Package className="w-5 h-5" /> Business Resources
            </h3>
            <p className="text-sm text-bia-text-tertiary mt-1">Define resources that business processes depend on</p>
          </div>
          <div className="flex gap-2">
            <button onClick={handleResetResources} className="glass-button text-sm">Reset to Default</button>
            <button onClick={() => setShowAddResource(true)} className="glass-button-solid text-sm flex items-center gap-1">
              <Plus className="w-4 h-4" /> Add Resource
            </button>
          </div>
        </div>

        {/* Add New Resource Form */}
        {showAddResource && (
          <div className="p-4 bg-black/30 rounded-lg border border-bia-primary/30 space-y-3">
            <h4 className="text-sm font-medium text-bia-text-primary">Add New Business Resource</h4>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
              <input type="text" value={newResource.name} onChange={(e) => setNewResource({ ...newResource, name: e.target.value })}
                className="glass-input" placeholder="Resource Name" />
              <select value={newResource.type} onChange={(e) => setNewResource({ ...newResource, type: e.target.value as any })}
                className="glass-input">
                {RESOURCE_TYPES.map(rt => <option key={rt.value} value={rt.value}>{rt.label}</option>)}
              </select>
              <input type="text" value={newResource.description} onChange={(e) => setNewResource({ ...newResource, description: e.target.value })}
                className="glass-input" placeholder="Description" />
            </div>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div>
                <label className="text-xs text-bia-text-tertiary block mb-1">RTO (Recovery Time Objective)</label>
                <div className="flex gap-2">
                  <input type="number" min="0" value={newResource.rto?.value || 0}
                    onChange={(e) => setNewResource({ ...newResource, rto: { ...newResource.rto!, value: parseInt(e.target.value) || 0 } })}
                    className="glass-input w-20" />
                  <select value={newResource.rto?.unit || 'hours'}
                    onChange={(e) => setNewResource({ ...newResource, rto: { ...newResource.rto!, unit: e.target.value as TimeUnit } })}
                    className="glass-input">
                    <option value="minutes">minutes</option>
                    <option value="hours">hours</option>
                    <option value="days">days</option>
                  </select>
                </div>
              </div>
              <div>
                <label className="text-xs text-bia-text-tertiary block mb-1">RPO (Recovery Point Objective)</label>
                <div className="flex gap-2">
                  <input type="number" min="0" value={newResource.rpo?.value || 0}
                    onChange={(e) => setNewResource({ ...newResource, rpo: { ...newResource.rpo!, value: parseInt(e.target.value) || 0 } })}
                    className="glass-input w-20" />
                  <select value={newResource.rpo?.unit || 'hours'}
                    onChange={(e) => setNewResource({ ...newResource, rpo: { ...newResource.rpo!, unit: e.target.value as TimeUnit } })}
                    className="glass-input">
                    <option value="minutes">minutes</option>
                    <option value="hours">hours</option>
                    <option value="days">days</option>
                  </select>
                </div>
              </div>
            </div>
            <div className="flex gap-2 justify-end">
              <button onClick={() => setShowAddResource(false)} className="glass-button">Cancel</button>
              <button onClick={handleAddResource} className="glass-button-solid">Add Resource</button>
            </div>
          </div>
        )}

        {/* Resources List */}
        <div className="space-y-3">
          {businessResources.map((resource) => (
            <div key={resource.id} className="bg-black/20 rounded-lg border border-bia-border overflow-hidden">
              {editingResource?.id === resource.id ? (
                <div className="p-4 space-y-3">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <input type="text" value={editingResource.name}
                      onChange={(e) => setEditingResource({ ...editingResource, name: e.target.value })}
                      className="glass-input text-sm" placeholder="Name" />
                    <select value={editingResource.type}
                      onChange={(e) => setEditingResource({ ...editingResource, type: e.target.value as any })}
                      className="glass-input text-sm">
                      {RESOURCE_TYPES.map(rt => <option key={rt.value} value={rt.value}>{rt.label}</option>)}
                    </select>
                    <input type="text" value={editingResource.description}
                      onChange={(e) => setEditingResource({ ...editingResource, description: e.target.value })}
                      className="glass-input text-sm" placeholder="Description" />
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div>
                      <label className="text-xs text-bia-text-tertiary block mb-1">RTO (Recovery Time Objective)</label>
                      <div className="flex gap-2">
                        <input type="number" min="0" value={editingResource.rto?.value || 0}
                          onChange={(e) => setEditingResource({ ...editingResource, rto: { value: parseInt(e.target.value) || 0, unit: editingResource.rto?.unit || 'hours' } })}
                          className="glass-input w-20 text-sm" />
                        <select value={editingResource.rto?.unit || 'hours'}
                          onChange={(e) => setEditingResource({ ...editingResource, rto: { value: editingResource.rto?.value || 0, unit: e.target.value as TimeUnit } })}
                          className="glass-input text-sm">
                          <option value="minutes">minutes</option>
                          <option value="hours">hours</option>
                          <option value="days">days</option>
                        </select>
                      </div>
                    </div>
                    <div>
                      <label className="text-xs text-bia-text-tertiary block mb-1">RPO (Recovery Point Objective)</label>
                      <div className="flex gap-2">
                        <input type="number" min="0" value={editingResource.rpo?.value || 0}
                          onChange={(e) => setEditingResource({ ...editingResource, rpo: { value: parseInt(e.target.value) || 0, unit: editingResource.rpo?.unit || 'hours' } })}
                          className="glass-input w-20 text-sm" />
                        <select value={editingResource.rpo?.unit || 'hours'}
                          onChange={(e) => setEditingResource({ ...editingResource, rpo: { value: editingResource.rpo?.value || 0, unit: e.target.value as TimeUnit } })}
                          className="glass-input text-sm">
                          <option value="minutes">minutes</option>
                          <option value="hours">hours</option>
                          <option value="days">days</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  {/* Quantity at Intervals */}
                  <div>
                    <label className="text-xs text-bia-text-tertiary block mb-2">Quantity Required at Timeline Points</label>
                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2">
                      {timelinePoints.map(tp => (
                        <div key={tp.id} className="text-center">
                          <span className="text-xs text-bia-text-tertiary block mb-1">{tp.label}</span>
                          <input type="number" min="0"
                            value={editingResource.quantityAtIntervals?.[tp.id] || 0}
                            onChange={(e) => setEditingResource({
                              ...editingResource,
                              quantityAtIntervals: { ...editingResource.quantityAtIntervals, [tp.id]: parseInt(e.target.value) || 0 }
                            })}
                            className="glass-input w-full text-sm text-center py-1" />
                        </div>
                      ))}
                    </div>
                  </div>
                  <div className="flex justify-end gap-2">
                    <button onClick={() => setEditingResource(null)} className="glass-button text-sm">Cancel</button>
                    <button onClick={() => handleUpdateResource(editingResource)} className="glass-button-solid text-sm">Save</button>
                  </div>
                </div>
              ) : (
                <>
                  <div className="p-3 flex items-center justify-between cursor-pointer hover:bg-white/5"
                    onClick={() => setExpandedResourceId(expandedResourceId === resource.id ? null : resource.id)}>
                    <div className="flex items-center gap-3">
                      <div>
                        <span className="text-bia-text-primary font-medium">{resource.name}</span>
                        <span className="ml-2 px-2 py-0.5 text-xs rounded bg-bia-primary/20 text-bia-primary">{getResourceTypeLabel(resource.type)}</span>
                      </div>
                      <div className="flex gap-4 text-xs text-bia-text-tertiary">
                        <span>RTO: <span className="text-bia-warning">{formatTimeValue(resource.rto)}</span></span>
                        <span>RPO: <span className="text-bia-secondary">{formatTimeValue(resource.rpo)}</span></span>
                      </div>
                    </div>
                    <div className="flex items-center gap-1">
                      <button onClick={(e) => { e.stopPropagation(); setEditingResource(resource); }} className="p-1 text-bia-text-tertiary hover:text-bia-primary">
                        <Edit2 className="w-4 h-4" />
                      </button>
                      <button onClick={(e) => { e.stopPropagation(); handleDeleteResource(resource.id); }} className="p-1 text-bia-text-tertiary hover:text-bia-critical">
                        <Trash2 className="w-4 h-4" />
                      </button>
                      {expandedResourceId === resource.id ? <ChevronUp className="w-4 h-4 text-bia-text-tertiary" /> : <ChevronDown className="w-4 h-4 text-bia-text-tertiary" />}
                    </div>
                  </div>
                  {expandedResourceId === resource.id && (
                    <div className="px-3 pb-3 pt-0 border-t border-bia-border/50">
                      <p className="text-xs text-bia-text-tertiary mt-2 mb-2">{resource.description}</p>
                      {resource.quantityAtIntervals && Object.keys(resource.quantityAtIntervals).length > 0 && (
                        <div>
                          <span className="text-xs text-bia-text-tertiary">Quantity at Intervals:</span>
                          <div className="flex flex-wrap gap-2 mt-1">
                            {timelinePoints.map(tp => {
                              const qty = resource.quantityAtIntervals?.[tp.id];
                              if (!qty) return null;
                              return (
                                <span key={tp.id} className="px-2 py-1 bg-black/30 rounded text-xs text-bia-text-secondary">
                                  {tp.label}: <span className="text-bia-primary font-medium">{qty}</span>
                                </span>
                              );
                            })}
                          </div>
                        </div>
                      )}
                    </div>
                  )}
                </>
              )}
            </div>
          ))}
        </div>
      </div>

      {/* Save/Reset */}
      <div className="flex gap-4">
        <button onClick={handleSave} className="glass-button-solid flex items-center gap-2">
          <Save className="w-4 h-4" /> {saved ? 'Saved!' : 'Save Settings'}
        </button>
        <button onClick={handleReset} className="glass-button flex items-center gap-2">
          <RotateCcw className="w-4 h-4" /> Reset to Defaults
        </button>
      </div>

      {/* Data Management */}
      <div className="glass-panel p-6 space-y-4">
        <h3 className="text-lg font-semibold text-bia-text-primary">Data Management</h3>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {/* Export */}
          <div className="p-4 rounded-bia-md border border-bia-border space-y-2">
            <h4 className="font-medium text-bia-text-primary flex items-center gap-2"><Download className="w-4 h-4" /> Export Data</h4>
            <p className="text-xs text-bia-text-tertiary">Download all BIA data as JSON</p>
            <button onClick={handleExport} className="glass-button w-full">Export JSON</button>
          </div>

          {/* Import */}
          <div className="p-4 rounded-bia-md border border-bia-border space-y-2">
            <h4 className="font-medium text-bia-text-primary flex items-center gap-2"><Upload className="w-4 h-4" /> Import Data</h4>
            <p className="text-xs text-bia-text-tertiary">Load data from JSON file</p>
            <label className="glass-button w-full block text-center cursor-pointer">
              Import JSON
              <input type="file" accept=".json" className="hidden" onChange={handleImport} />
            </label>
            {importError && <p className="text-xs text-bia-critical">{importError}</p>}
            {importSuccess && <p className="text-xs text-bia-success">Data imported successfully!</p>}
          </div>

          {/* Clear */}
          <div className="p-4 rounded-bia-md border border-bia-critical/30 space-y-2">
            <h4 className="font-medium text-bia-critical flex items-center gap-2"><Trash2 className="w-4 h-4" /> Clear All Data</h4>
            <p className="text-xs text-bia-text-tertiary">Permanently delete all data</p>
            <button onClick={() => setShowClearConfirm(true)} className="w-full px-4 py-2 bg-bia-critical/20 text-bia-critical rounded-bia-sm hover:bg-bia-critical/30 transition-colors">
              Clear Data
            </button>
          </div>
        </div>
      </div>

      {/* ISO Reference */}
      <div className="glass-panel p-6 space-y-4">
        <h3 className="text-lg font-semibold text-bia-text-primary flex items-center gap-2">
          <HelpCircle className="w-5 h-5" /> ISO 22301:2019 Reference
        </h3>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
          <div className="p-3 bg-black/20 rounded">
            <p className="text-bia-primary font-medium">Clause 8.2.2 - Business Impact Analysis</p>
            <p className="text-bia-text-tertiary mt-1">Organizations shall identify and document prioritized timeframes for resumption of activities, their dependencies, and supporting resources.</p>
          </div>
          <div className="p-3 bg-black/20 rounded">
            <p className="text-bia-primary font-medium">Clause 8.2.3 - Risk Assessment</p>
            <p className="text-bia-text-tertiary mt-1">Organizations shall identify risks of disruption to prioritized activities and assess impact severity.</p>
          </div>
        </div>
      </div>

      {/* Clear Confirm Modal */}
      {showClearConfirm && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
          <div className="glass-panel p-6 max-w-md animate-scale-in">
            <div className="flex items-center gap-3 text-bia-critical mb-4">
              <AlertTriangle className="w-6 h-6" />
              <h3 className="text-lg font-semibold">Confirm Clear All Data</h3>
            </div>
            <p className="text-bia-text-secondary mb-6">This will permanently delete all processes, impacts, recovery objectives, and dependencies. This action cannot be undone.</p>
            <div className="flex justify-end gap-3">
              <button onClick={() => setShowClearConfirm(false)} className="glass-button">Cancel</button>
              <button onClick={handleClearAll} className="px-4 py-2 bg-bia-critical text-white rounded-bia-sm hover:bg-bia-critical/90">Delete All</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}


--- FILE END: src\components\Settings.tsx ---


--- FILE START: src\components\Sidebar.tsx ---

import { useState } from 'react';
import { useStore } from '../store/useStore';
import { LayoutDashboard, Database, Clock, FileText, ChevronLeft, ChevronRight, ChevronDown, Shield, TrendingUp, GitBranch, Settings, Network } from 'lucide-react';

type NavItem = {
  id: string;
  label: string;
  icon: any;
  subItems?: { id: string; label: string; icon: any }[];
};

const navItems: NavItem[] = [
  { id: 'dashboard', label: 'Dashboard', icon: LayoutDashboard },
  {
    id: 'process-group',
    label: 'Process Registry',
    icon: Database,
    subItems: [
      { id: 'processes', label: 'Registry', icon: Database },
      { id: 'process-deps', label: 'Dependencies', icon: Network },
    ]
  },
  { id: 'temporal', label: 'BIA', icon: TrendingUp },
  { id: 'dependencies', label: 'Dependencies', icon: GitBranch },
  { id: 'recovery', label: 'Recovery Objectives', icon: Clock },
  { id: 'reports', label: 'Reports', icon: FileText },
  { id: 'settings', label: 'Settings', icon: Settings },
];

export function Sidebar() {
  const { currentView, setCurrentView, sidebarCollapsed, toggleSidebar } = useStore();
  const [expandedGroups, setExpandedGroups] = useState<Record<string, boolean>>({
    'process-group': true
  });

  const toggleGroup = (id: string) => {
    setExpandedGroups(prev => ({ ...prev, [id]: !prev[id] }));
  };

  return (
    <aside className={`fixed left-0 top-0 h-screen glass-sidebar z-50 transition-all duration-300 ${sidebarCollapsed ? 'w-16' : 'w-64'}`}>
      <div className="flex flex-col h-full">
        {/* Logo */}
        <div className={`flex items-center gap-3 p-4 border-b border-white/5 ${sidebarCollapsed ? 'justify-center' : ''}`}>
          <div className="flex-shrink-0 w-10 h-10 rounded-bia-md bg-gradient-to-br from-bia-primary to-bia-secondary flex items-center justify-center shadow-lg shadow-bia-primary/20">
            <Shield className="w-6 h-6 text-white" />
          </div>
          <div className={`transition-all duration-300 overflow-hidden ${sidebarCollapsed ? 'w-0 opacity-0' : 'w-40 opacity-100'}`}>
            <h1 className="text-base font-bold text-bia-text-primary tracking-tight whitespace-nowrap">BIA MiniMax</h1>
            <p className="text-[10px] text-bia-text-tertiary font-bold uppercase tracking-widest whitespace-nowrap">Enterprise GRC</p>
          </div>
        </div>

        {/* Navigation */}
        <nav className="flex-1 p-3 space-y-1 overflow-y-auto">
          {navItems.map((item) => {
            // Flatten for collapsed mode
            if (sidebarCollapsed) {
              if (item.subItems) {
                return item.subItems.map(subItem => (
                  <button
                    key={subItem.id}
                    onClick={() => setCurrentView(subItem.id)}
                    className={`nav-item w-full text-sm justify-center px-2 ${currentView === subItem.id ? 'nav-item-active' : ''}`}
                    title={`${item.label} - ${subItem.label}`}
                  >
                    <subItem.icon className="w-5 h-5 flex-shrink-0" />
                  </button>
                ));
              }
              return (
                <button
                  key={item.id}
                  onClick={() => setCurrentView(item.id)}
                  className={`nav-item w-full text-sm justify-center px-2 ${currentView === item.id ? 'nav-item-active' : ''}`}
                  title={item.label}
                >
                  <item.icon className="w-5 h-5 flex-shrink-0" />
                </button>
              );
            }

            // Expanded Mode
            if (item.subItems) {
              const isExpanded = expandedGroups[item.id];
              const isActive = item.subItems.some(sub => sub.id === currentView);

              return (
                <div key={item.id} className="space-y-1">
                  <button
                    onClick={() => toggleGroup(item.id)}
                    className={`nav-item w-full text-sm justify-between ${isActive ? 'text-bia-text-primary' : ''}`}
                  >
                    <div className="flex items-center gap-3">
                      <item.icon className="w-5 h-5 flex-shrink-0" />
                      <span>{item.label}</span>
                    </div>
                    {isExpanded ? <ChevronDown className="w-4 h-4 opacity-50" /> : <ChevronRight className="w-4 h-4 opacity-50" />}
                  </button>

                  {isExpanded && (
                    <div className="space-y-1">
                      {item.subItems.map(subItem => (
                        <button
                          key={subItem.id}
                          onClick={() => setCurrentView(subItem.id)}
                          className={`nav-item w-full text-sm pl-12 ${currentView === subItem.id ? 'nav-item-active' : 'text-bia-text-tertiary'}`}
                        >
                          <div className="flex items-center gap-3">
                            <subItem.icon className="w-4 h-4 flex-shrink-0" />
                            <span>{subItem.label}</span>
                          </div>
                        </button>
                      ))}
                    </div>
                  )}
                </div>
              );
            }

            return (
              <button
                key={item.id}
                onClick={() => setCurrentView(item.id)}
                className={`nav-item w-full text-sm ${currentView === item.id ? 'nav-item-active' : ''}`}
              >
                <item.icon className="w-5 h-5 flex-shrink-0" />
                <span>{item.label}</span>
              </button>
            );
          })}
        </nav>

        {/* Collapse toggle */}
        <button
          onClick={toggleSidebar}
          className={`p-3 border-t border-[rgba(255,255,255,0.05)] text-bia-text-secondary hover:text-bia-text-primary transition-colors flex items-center ${sidebarCollapsed ? 'justify-center' : 'px-4 gap-3'}`}
        >
          {sidebarCollapsed ? <ChevronRight className="w-5 h-5" /> : (
            <>
              <ChevronLeft className="w-5 h-5" />
              <span className="text-sm font-medium">Collapse Sidebar</span>
            </>
          )}
        </button>
      </div>
    </aside>
  );
}


--- FILE END: src\components\Sidebar.tsx ---


--- FILE START: src\components\TemporalAnalysis.tsx ---

import { useState, useEffect, useMemo } from 'react';
import { useStore } from '../store/useStore';
import { getTimelinePointsFromCustom, DEFAULT_IMPACT_CATEGORIES } from '../types';
import { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, Legend, ReferenceLine } from 'recharts';
import { ChevronLeft, Save, AlertTriangle, Info, Search, Filter } from 'lucide-react';

interface DynamicTimelinePoint {
  timeOffset: number;
  timeLabel: string;
  [key: string]: number | string;
}

export function TemporalAnalysis() {
  const { processes, selectedProcessId, setSelectedProcessId, temporalData, updateTemporalData, getProcessById, settings } = useStore();
  const [localData, setLocalData] = useState<DynamicTimelinePoint[]>([]);
  const [saved, setSaved] = useState(false);
  const [hoveredCell, setHoveredCell] = useState<{ idx: number; catId: string } | null>(null);

  const process = selectedProcessId ? getProcessById(selectedProcessId) : null;
  const categories = useMemo(() => settings.impactCategories || DEFAULT_IMPACT_CATEGORIES, [settings.impactCategories]);
  const timelinePoints = useMemo(() => settings.customTimelinePoints || [], [settings.customTimelinePoints]);
  const timelineStructure = useMemo(() => getTimelinePointsFromCustom(timelinePoints), [timelinePoints]);

  useEffect(() => {
    if (selectedProcessId) {
      const existing = temporalData[selectedProcessId];
      // Only set local data if it's drastically different (e.g. initial load or different process)
      // We check length and presence. If length matches, we assume it's the data we want unless we have nothing.
      if (existing && existing.length === timelineStructure.length) {
        // Only initialize if localData is empty or belongs to a different process (checked by structure/length context here)
        // To be safe, we only overwrite if we haven't initialized localData for THIS process yet.
        setLocalData(prev => {
          if (prev.length === existing.length && prev[0]?.timeOffset === existing[0]?.timeOffset) {
            return prev; // Keep current local changes
          }
          return existing as unknown as DynamicTimelinePoint[];
        });
      } else {
        const newData: DynamicTimelinePoint[] = timelineStructure.map(tp => {
          const point: DynamicTimelinePoint = { timeOffset: tp.timeOffset, timeLabel: tp.timeLabel };
          categories.forEach(c => point[c.id] = 0);
          return point;
        });
        setLocalData(newData);
      }
    } else {
      setLocalData([]);
    }
  }, [selectedProcessId, temporalData, categories, timelineStructure]);

  const handleSliderChange = (idx: number, catId: string, value: number) => {
    const updated = [...localData];
    updated[idx] = { ...updated[idx], [catId]: value };
    setLocalData(updated);
    setSaved(false);
  };

  const handleSave = () => {
    if (selectedProcessId) {
      updateTemporalData(selectedProcessId, localData as any);
      setSaved(true);
      setTimeout(() => setSaved(false), 2000);
    }
  };

  const calculateMTPD = (): number | null => {
    const threshold = settings.impactThreshold;
    for (const point of localData) {
      const maxImpact = Math.max(...categories.map(c => (point[c.id] as number) || 0));
      if (maxImpact >= threshold) return point.timeOffset;
    }
    return null;
  };

  const getTimeBasedDefinition = (categoryId: string, timelinePointId: string): string | null => {
    const category = categories.find(c => c.id === categoryId);
    if (!category) return null;
    const def = category.timeBasedDefinitions.find(d => d.timelinePointId === timelinePointId);
    return def?.description || null;
  };

  // Custom tooltip for the chart with time-based definitions
  const CustomChartTooltip = ({ active, payload, label }: any) => {
    if (!active || !payload || !payload.length) return null;

    // Find the timeline point ID for this label
    const pointIdx = localData.findIndex(d => d.timeLabel === label);
    const timelinePointId = timelinePoints[pointIdx]?.id;

    return (
      <div className="bg-slate-800/95 border border-white/10 rounded-lg p-3 shadow-xl max-w-xs">
        <p className="text-white font-semibold mb-2 border-b border-white/10 pb-2">{label}</p>
        <div className="space-y-2">
          {payload.map((entry: any) => {
            const cat = categories.find(c => c.id === entry.dataKey);
            const definition = timelinePointId ? getTimeBasedDefinition(entry.dataKey, timelinePointId) : null;
            return (
              <div key={entry.dataKey} className="text-sm">
                <div className="flex items-center gap-2">
                  <div className="w-2 h-2 rounded" style={{ backgroundColor: entry.color }} />
                  <span className="text-white font-medium">{cat?.name || entry.name}:</span>
                  <span className="text-amber-400 font-bold">{entry.value}/5</span>
                </div>
                {definition && (
                  <p className="text-slate-300 text-xs ml-4 mt-1 italic">"{definition}"</p>
                )}
              </div>
            );
          })}
        </div>
      </div>
    );
  };

  const calculatedMTPD = calculateMTPD();

  // Calculate max impact per category across all timeline points (worst-case)
  const getMaxImpactPerCategory = (processId: string) => {
    const data = temporalData[processId] as unknown as DynamicTimelinePoint[] | undefined;
    if (!data) return {};
    const maxImpacts: Record<string, number> = {};
    categories.forEach(cat => {
      maxImpacts[cat.id] = Math.max(...data.map(d => (d[cat.id] as number) || 0));
    });
    return maxImpacts;
  };

  // Overall criticality = weighted average of max impacts
  const calculateOverallCriticality = (processId: string): number => {
    const maxImpacts = getMaxImpactPerCategory(processId);
    let total = 0, weightSum = 0;
    categories.forEach(cat => {
      total += (maxImpacts[cat.id] || 0) * cat.weight;
      weightSum += cat.weight;
    });
    return weightSum > 0 ? parseFloat((total / weightSum).toFixed(2)) : 0;
  };

  // Get process impact summary for list view
  const getImpactValueDisplay = (catId: string, value: number) => {
    if (value === 0) return 'None';
    const cat = categories.find(c => c.id === catId);
    // Map numerical level to standard labels or use description if available
    const def = cat?.timeBasedDefinitions.find(d => d.timelinePointId === `ctp-${Math.min(7, Math.max(1, Math.round(value)))}`);
    if (def) {
      return def.description.split(',')[0];
    }
    const labels = ['None', 'Minimal', 'Low', 'Medium', 'High', 'Critical'];
    return labels[Math.round(value)] || value.toString();
  };

  const getImpactLabel = (value: number) => {
    if (value >= 4.5) return 'Critical';
    if (value >= 3.5) return 'High';
    if (value >= 2.5) return 'Medium';
    if (value >= 1.5) return 'Low';
    if (value >= 0.5) return 'Minimal';
    return 'None';
  };

  const getProcessImpactSummary = (processId: string) => {
    const score = calculateOverallCriticality(processId);
    const maxImpacts = getMaxImpactPerCategory(processId);
    const highestCat = categories.reduce((max, cat) =>
      (maxImpacts[cat.id] || 0) > (maxImpacts[max.id] || 0) ? cat : max, categories[0]);
    return { score, highestCat, highestValue: maxImpacts[highestCat?.id] || 0 };
  };

  // Filter state
  const [searchTerm, setSearchTerm] = useState('');
  const [deptFilter, setDeptFilter] = useState('');
  const [criticalityFilter, setCriticalityFilter] = useState('');

  // Get unique departments
  const departments = useMemo(() =>
    [...new Set(processes.map(p => p.department))].sort(),
    [processes]
  );

  // Filtered processes
  const filteredProcesses = useMemo(() => {
    return processes.filter(p => {
      const matchesSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        p.department.toLowerCase().includes(searchTerm.toLowerCase());
      const matchesDept = !deptFilter || p.department === deptFilter;
      const matchesCrit = !criticalityFilter || p.criticality === criticalityFilter;
      return matchesSearch && matchesDept && matchesCrit;
    });
  }, [processes, searchTerm, deptFilter, criticalityFilter]);

  if (!selectedProcessId) {
    return (
      <div className="animate-fade-in space-y-6">
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Business Impact Analysis</h1>
          <p className="text-bia-text-secondary mt-1">Assess and analyze business impact across processes</p>
        </div>

        {/* Filter Bar */}
        <div className="glass-panel p-4">
          <div className="flex flex-wrap items-center gap-4">
            {/* Search */}
            <div className="relative flex-1 min-w-[200px]">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-bia-text-tertiary" />
              <input
                type="text"
                placeholder="Search processes..."
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
                className="glass-input w-full pl-10"
              />
            </div>
            {/* Department Filter */}
            <div className="flex items-center gap-2">
              <Filter className="w-4 h-4 text-bia-text-tertiary" />
              <select
                value={deptFilter}
                onChange={(e) => setDeptFilter(e.target.value)}
                className="glass-input"
              >
                <option value="">All Departments</option>
                {departments.map(d => <option key={d} value={d}>{d}</option>)}
              </select>
            </div>
            {/* Criticality Filter */}
            <select
              value={criticalityFilter}
              onChange={(e) => setCriticalityFilter(e.target.value)}
              className="glass-input"
            >
              <option value="">All Criticality</option>
              <option value="critical">Critical</option>
              <option value="high">High</option>
              <option value="medium">Medium</option>
              <option value="low">Low</option>
            </select>
            {/* Clear Filters */}
            {(searchTerm || deptFilter || criticalityFilter) && (
              <button
                onClick={() => { setSearchTerm(''); setDeptFilter(''); setCriticalityFilter(''); }}
                className="text-sm text-bia-text-tertiary hover:text-bia-text-primary"
              >
                Clear filters
              </button>
            )}
          </div>
        </div>

        {/* Process List Table */}
        <div className="glass-panel overflow-hidden">
          <table className="w-full">
            <thead className="bg-black/30">
              <tr className="text-left text-xs text-bia-text-secondary uppercase tracking-wider">
                <th className="px-6 py-4">Process Name</th>
                <th className="px-6 py-4">Department</th>
                <th className="px-6 py-4 text-center">Criticality</th>
                <th className="px-6 py-4 text-center">Impact Score</th>
                <th className="px-6 py-4">Peak Category</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-[rgba(255,255,255,0.05)]">
              {filteredProcesses.length === 0 ? (
                <tr>
                  <td colSpan={5} className="px-6 py-8 text-center text-bia-text-tertiary">
                    No processes match your filters
                  </td>
                </tr>
              ) : (
                filteredProcesses.map((p, idx) => {
                  const summary = getProcessImpactSummary(p.id);
                  return (
                    <tr
                      key={p.id}
                      onDoubleClick={() => setSelectedProcessId(p.id)}
                      className={`cursor-pointer transition-colors hover:bg-bia-primary/10 ${idx % 2 === 0 ? 'bg-white/[0.02]' : ''}`}
                      title="Double-click to assess"
                    >
                      <td className="px-6 py-4">
                        <p className="text-bia-text-primary font-medium">{p.name}</p>
                        <p className="text-xs text-bia-text-tertiary">{p.owner}</p>
                      </td>
                      <td className="px-6 py-4 text-bia-text-secondary">{p.department}</td>
                      <td className="px-6 py-4 text-center">
                        <span className={`px-3 py-1 rounded-full text-xs font-medium criticality-${p.criticality}`}>
                          {p.criticality}
                        </span>
                      </td>
                      <td className="px-6 py-4 text-center">
                        <span className={`text-xl font-bold ${summary.score >= 4 ? 'text-bia-critical' : summary.score >= 3 ? 'text-bia-warning' : summary.score > 0 ? 'text-bia-info' : 'text-bia-text-tertiary'}`}>
                          {summary.score}
                        </span>
                      </td>
                      <td className="px-6 py-4">
                        {summary.highestValue > 0 ? (
                          <div className="flex items-center gap-2">
                            <div className="w-3 h-3 rounded" style={{ backgroundColor: summary.highestCat?.color }} />
                            <span className="text-bia-text-primary">{summary.highestCat?.name}</span>
                            <span className="text-bia-text-tertiary text-sm">({summary.highestValue}/5)</span>
                          </div>
                        ) : (
                          <span className="text-bia-text-tertiary text-sm">Not assessed</span>
                        )}
                      </td>
                    </tr>
                  );
                })
              )}
            </tbody>
          </table>
          {/* Hint */}
          <div className="px-6 py-3 bg-black/20 text-xs text-bia-text-tertiary border-t border-[rgba(255,255,255,0.05)]">
            💡 Double-click a row to open the impact assessment for that process
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="animate-fade-in space-y-6">
      <div className="flex items-center gap-4">
        <button onClick={() => setSelectedProcessId(null)} className="p-2 hover:bg-bia-glass-hover rounded-lg">
          <ChevronLeft className="w-5 h-5 text-bia-text-secondary" />
        </button>
        <div>
          <h1 className="text-3xl font-bold text-bia-text-primary">Business Impact Analysis</h1>
          <p className="text-bia-text-secondary mt-1">Process: {process?.name}</p>
        </div>
      </div>

      {/* Overall Impact Summary Card */}
      {selectedProcessId && (
        <div className="glass-panel p-6">
          <h3 className="text-lg font-semibold text-bia-text-primary mb-4">Overall Impact Summary</h3>
          <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
            {/* Overall Score */}
            <div className="col-span-2 md:col-span-1 p-4 bg-black/30 rounded-lg text-center flex flex-col justify-center">
              <p className="text-xs text-bia-text-tertiary uppercase mb-1">Criticality</p>
              <p className={`text-2xl font-bold tracking-tight ${calculateOverallCriticality(selectedProcessId) >= 4 ? 'text-bia-critical' : calculateOverallCriticality(selectedProcessId) >= 3 ? 'text-bia-warning' : 'text-bia-success'}`}>
                {getImpactLabel(calculateOverallCriticality(selectedProcessId))}
              </p>
              <p className="text-[10px] text-bia-text-tertiary mt-1">Score: {calculateOverallCriticality(selectedProcessId)}</p>
            </div>
            {/* Per-category max impacts */}
            {categories.map(cat => {
              const maxVal = getMaxImpactPerCategory(selectedProcessId)[cat.id] || 0;
              return (
                <div key={cat.id} className="p-3 bg-black/20 rounded-lg text-center flex flex-col justify-center min-h-[100px]">
                  <div className="flex items-center justify-center gap-1 mb-2">
                    <div className="w-2 h-2 rounded" style={{ backgroundColor: cat.color }} />
                    <p className="text-[10px] text-bia-text-tertiary uppercase tracking-wider truncate">{cat.name}</p>
                  </div>
                  <p className={`text-lg font-bold leading-tight mb-1 ${maxVal >= 4 ? 'text-bia-critical' : maxVal >= 3 ? 'text-bia-warning' : 'text-bia-text-primary'}`}>
                    {getImpactValueDisplay(cat.id, maxVal)}
                  </p>
                  <p className="text-[10px] text-bia-text-tertiary">Peak Impact</p>
                </div>
              );
            })}
          </div>
        </div>
      )}

      {calculatedMTPD !== null && (
        <div className="glass-panel p-4 border-l-4 border-bia-warning flex items-center gap-3">
          <AlertTriangle className="w-5 h-5 text-bia-warning" />
          <div>
            <span className="text-bia-text-primary font-medium">Suggested MTPD: </span>
            <span className="text-bia-warning font-bold">{calculatedMTPD} hours</span>
            <span className="text-bia-text-tertiary ml-2">(Based on impact threshold of {settings.impactThreshold})</span>
          </div>
        </div>
      )}

      {/* Timeline Chart */}
      <div className="glass-panel p-6">
        <h3 className="text-lg font-semibold text-bia-text-primary mb-2">Impact Escalation Over Time</h3>
        <p className="text-sm text-bia-text-tertiary mb-4">Hover over data points to see impact definitions</p>
        <ResponsiveContainer width="100%" height={300}>
          <LineChart data={localData}>
            <XAxis dataKey="timeLabel" stroke="#94A3B8" />
            <YAxis domain={[0, 5]} stroke="#94A3B8" />
            <Tooltip content={<CustomChartTooltip />} />
            <Legend />
            <ReferenceLine y={settings.impactThreshold} stroke="#F87171" strokeDasharray="5 5" label={{ value: 'Threshold', fill: '#F87171', fontSize: 12 }} />
            {categories.map((cat) => (
              <Line key={cat.id} type="monotone" dataKey={cat.id} stroke={cat.color} strokeWidth={2} dot={{ r: 5 }} activeDot={{ r: 8 }} name={cat.name} />
            ))}
          </LineChart>
        </ResponsiveContainer>
      </div>

      {/* Timeline Point Editor */}
      <div className="glass-panel p-6 space-y-6">
        <div>
          <h3 className="text-lg font-semibold text-bia-text-primary">Edit Timeline Points</h3>
          <p className="text-sm text-bia-text-tertiary mt-1">Hover over the <Info className="w-3 h-3 inline" /> icon to see what each impact level means at that time</p>
        </div>
        <div className="overflow-x-auto">
          <table className="w-full min-w-[800px]">
            <thead>
              <tr className="text-left text-xs text-bia-text-secondary uppercase">
                <th className="p-2">Time</th>
                {categories.map((cat) => (
                  <th key={cat.id} className="p-2 min-w-[180px]">
                    <div className="flex items-center gap-1">
                      <div className="w-2 h-2 rounded" style={{ backgroundColor: cat.color }} />
                      {cat.name}
                    </div>
                  </th>
                ))}
              </tr>
            </thead>
            <tbody>
              {localData.map((point, idx) => {
                const timelinePointId = timelinePoints[idx]?.id;
                const timeLabel = point.timeLabel;
                return (
                  <tr key={idx} className="border-t border-bia-border hover:bg-white/5">
                    <td className="p-2 text-bia-text-primary font-medium whitespace-nowrap">{timeLabel}</td>
                    {categories.map((cat) => {
                      const isHovered = hoveredCell?.idx === idx && hoveredCell?.catId === cat.id;
                      const definition = timelinePointId ? getTimeBasedDefinition(cat.id, timelinePointId) : null;
                      return (
                        <td key={cat.id} className="p-2 relative min-w-[180px]"
                          onMouseEnter={() => setHoveredCell({ idx, catId: cat.id })}
                          onMouseLeave={() => setHoveredCell(null)}>
                          <div className="flex items-center gap-3">
                            <input type="range" min="0" max="5" value={(point[cat.id] as number) || 0}
                              onChange={(e) => handleSliderChange(idx, cat.id, parseInt(e.target.value))}
                              className="w-40 h-1.5 accent-bia-primary bg-white/10 rounded-lg appearance-none cursor-pointer" />
                            <span className="text-bia-text-primary w-4 font-bold">{point[cat.id] || 0}</span>
                            {definition && (
                              <Info className="w-4 h-4 text-bia-info cursor-help shrink-0" />
                            )}
                          </div>
                          {/* Enhanced tooltip with formatted content */}
                          {isHovered && definition && (
                            <div className="absolute z-20 left-0 top-full mt-1 p-3 bg-slate-800/95 border border-white/20 rounded-lg shadow-xl max-w-[280px]">
                              <div className="flex items-center gap-2 mb-2 pb-2 border-b border-white/10">
                                <div className="w-3 h-3 rounded" style={{ backgroundColor: cat.color }} />
                                <span className="text-white font-semibold text-sm">{cat.name}</span>
                                <span className="text-slate-400 text-xs">at {timeLabel}</span>
                              </div>
                              <p className="text-slate-200 text-sm leading-relaxed">{definition}</p>
                            </div>
                          )}
                        </td>
                      );
                    })}
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
        <button onClick={handleSave} className="glass-button-solid flex items-center gap-2">
          <Save className="w-4 h-4" /> {saved ? 'Saved!' : 'Save Timeline'}
        </button>
      </div>
    </div>
  );
}


--- FILE END: src\components\TemporalAnalysis.tsx ---


--- FILE START: src\components\Tooltip.tsx ---

import { useState, ReactNode } from 'react';
import { HelpCircle } from 'lucide-react';

interface TooltipProps {
  content: string;
  children?: ReactNode;
}

export function Tooltip({ content, children }: TooltipProps) {
  const [show, setShow] = useState(false);

  return (
    <div className="relative inline-block">
      <div onMouseEnter={() => setShow(true)} onMouseLeave={() => setShow(false)} className="cursor-help">
        {children || <HelpCircle className="w-4 h-4 text-bia-text-tertiary hover:text-bia-primary transition-colors" />}
      </div>
      {show && (
        <div className="absolute z-50 bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 bg-bia-glass backdrop-blur-lg border border-bia-border rounded-bia-sm shadow-lg text-sm text-bia-text-primary max-w-xs whitespace-normal animate-fade-in">
          {content}
          <div className="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-bia-border" />
        </div>
      )}
    </div>
  );
}

export function FieldLabel({ label, tooltip }: { label: string; tooltip: string }) {
  return (
    <div className="flex items-center gap-2">
      <span className="text-sm text-bia-text-secondary">{label}</span>
      <Tooltip content={tooltip} />
    </div>
  );
}


--- FILE END: src\components\Tooltip.tsx ---


--- FILE START: src\hooks\use-mobile.tsx ---

import * as React from "react"

const MOBILE_BREAKPOINT = 768

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }
    mql.addEventListener("change", onChange)
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    return () => mql.removeEventListener("change", onChange)
  }, [])

  return !!isMobile
}


--- FILE END: src\hooks\use-mobile.tsx ---


--- FILE START: src\index.css ---

@import url("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap");

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    @apply border-bia-border;
  }

  body {
    @apply bg-gradient-to-br from-bia-bg-start to-bia-bg-end min-h-screen text-bia-text-primary font-sans antialiased;
  }
}

@layer components {
  .glass-panel {
    @apply bg-white/[0.03] backdrop-blur-[24px] border border-white/10 rounded-bia-lg shadow-2xl;
  }

  .glass-panel-hover {
    @apply glass-panel transition-all duration-500 hover:bg-white/[0.06] hover:-translate-y-1.5 hover:shadow-bia-primary/5 hover:border-white/20;
  }

  .glass-input {
    @apply bg-bia-glass-input backdrop-blur-[8px] border border-bia-border rounded-bia-sm px-4 py-2 text-bia-text-primary placeholder:text-bia-text-tertiary focus:outline-none focus:border-bia-border-focus focus:ring-1 focus:ring-bia-border-focus transition-all;
  }

  .glass-button {
    @apply bg-bia-primary/20 backdrop-blur-[8px] border border-bia-primary/30 text-bia-primary rounded-bia-sm px-4 py-2 font-medium transition-all hover:bg-bia-primary/30 hover:shadow-glow-primary;
  }

  .glass-button-solid {
    @apply bg-bia-primary text-bia-bg-start rounded-bia-sm px-4 py-2 font-medium transition-all hover:bg-bia-primary/90 hover:shadow-glow-primary;
  }

  .glass-sidebar {
    @apply bg-[rgba(15,23,42,0.8)] backdrop-blur-[20px] border-r border-[rgba(255,255,255,0.05)];
  }

  .nav-item {
    @apply flex items-center gap-3 px-4 py-3 text-bia-text-secondary transition-all rounded-lg hover:bg-bia-glass-hover hover:text-bia-text-primary;
  }

  .nav-item-active {
    @apply bg-bia-glass-active text-bia-text-primary border-l-[3px] border-bia-primary;
  }

  .criticality-critical {
    @apply bg-bia-critical/20 text-bia-critical border border-bia-critical/30;
  }

  .criticality-high {
    @apply bg-bia-warning/20 text-bia-warning border border-bia-warning/30;
  }

  .criticality-medium {
    @apply bg-bia-info/20 text-bia-info border border-bia-info/30;
  }

  .criticality-low {
    @apply bg-bia-success/20 text-bia-success border border-bia-success/30;
  }
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(0, 0, 0, 0.2);
}

::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.2);
}


--- FILE END: src\index.css ---


--- FILE START: src\lib\utils.ts ---

import { clsx, ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}


--- FILE END: src\lib\utils.ts ---


--- FILE START: src\main.tsx ---

import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import { ErrorBoundary } from './components/ErrorBoundary.tsx'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <ErrorBoundary>
      <App />
    </ErrorBoundary>
  </StrictMode>,
)


--- FILE END: src\main.tsx ---


--- FILE START: src\store\useStore.ts ---

import { create } from "zustand";
import { persist } from "zustand/middleware";
import {
  Process,
  ImpactAssessment,
  RecoveryObjective,
  TimelinePoint,
  Dependency,
  Settings,
  DEFAULT_SETTINGS,
  getTimelinePointsFromCustom,
} from "../types";

const SAMPLE_PROCESSES: Process[] = [
  {
    id: "PROC-001",
    name: "Payment Processing",
    owner: "Jane Smith",
    department: "Finance",
    description: "Core payment processing system for customer transactions.",
    criticality: "critical",
    status: "approved",
    createdAt: "2024-01-15T10:00:00Z",
    updatedAt: "2024-12-01T14:30:00Z",
  },
  {
    id: "PROC-002",
    name: "Customer Service Platform",
    owner: "Mike Johnson",
    department: "Operations",
    description: "Multi-channel customer support platform.",
    criticality: "high",
    status: "approved",
    createdAt: "2024-01-20T09:00:00Z",
    updatedAt: "2024-11-15T11:20:00Z",
  },
  {
    id: "PROC-003",
    name: "Inventory Management",
    owner: "Sarah Williams",
    department: "Supply Chain",
    description: "Real-time inventory tracking system.",
    criticality: "high",
    status: "draft",
    createdAt: "2024-02-01T08:00:00Z",
    updatedAt: "2024-12-05T16:45:00Z",
  },
  {
    id: "PROC-004",
    name: "Order Fulfillment",
    owner: "Tom Brown",
    department: "Operations",
    description: "End-to-end order processing.",
    criticality: "medium",
    status: "in-review",
    createdAt: "2024-02-10T14:00:00Z",
    updatedAt: "2024-11-28T09:15:00Z",
  },
  {
    id: "PROC-005",
    name: "Email Communications",
    owner: "Lisa Davis",
    department: "IT",
    description: "Corporate email system.",
    criticality: "low",
    status: "approved",
    createdAt: "2024-02-15T11:00:00Z",
    updatedAt: "2024-10-20T13:30:00Z",
  },
];

const SAMPLE_IMPACTS: Record<string, ImpactAssessment> = {
  "PROC-001": {
    financial: 5,
    operational: 4,
    reputational: 5,
    legal: 4,
    health: 0,
    environmental: 0,
  },
  "PROC-002": {
    financial: 3,
    operational: 4,
    reputational: 4,
    legal: 2,
    health: 0,
    environmental: 0,
  },
  "PROC-003": {
    financial: 4,
    operational: 5,
    reputational: 3,
    legal: 2,
    health: 0,
    environmental: 1,
  },
  "PROC-004": {
    financial: 4,
    operational: 4,
    reputational: 4,
    legal: 3,
    health: 0,
    environmental: 0,
  },
  "PROC-005": {
    financial: 2,
    operational: 3,
    reputational: 2,
    legal: 1,
    health: 0,
    environmental: 0,
  },
};

const SAMPLE_RECOVERY: Record<string, RecoveryObjective> = {
  "PROC-001": {
    mtpd: 4,
    rto: 2,
    rpo: 0,
    mbco: true,
    recoveryStrategy: "high-availability",
    strategyNotes: "Active-active data center with automatic failover",
  },
  "PROC-002": {
    mtpd: 24,
    rto: 8,
    rpo: 4,
    mbco: false,
    recoveryStrategy: "warm-standby",
    strategyNotes: "Secondary contact center",
  },
  "PROC-003": {
    mtpd: 48,
    rto: 24,
    rpo: 8,
    mbco: false,
    recoveryStrategy: "cold-backup",
    strategyNotes: "Manual processes available",
  },
  "PROC-004": {
    mtpd: 24,
    rto: 12,
    rpo: 2,
    mbco: true,
    recoveryStrategy: "warm-standby",
    strategyNotes: "Backup system with 4-hour activation",
  },
  "PROC-005": {
    mtpd: 72,
    rto: 24,
    rpo: 24,
    mbco: false,
    recoveryStrategy: "cold-backup",
    strategyNotes: "Cloud-based email with 24-hour recovery",
  },
};

const INITIAL_TIMELINE = getTimelinePointsFromCustom(
  DEFAULT_SETTINGS.customTimelinePoints,
);
const SAMPLE_TEMPORAL: Record<string, TimelinePoint[]> = {
  "PROC-001": INITIAL_TIMELINE.map((tp, i) => ({
    ...tp,
    financial: Math.min(5, i),
    operational: Math.min(5, Math.floor(i * 0.8)),
    reputational: Math.min(5, i),
    legal: Math.min(5, Math.floor(i * 0.6)),
    health: 0,
    environmental: 0,
  })),
  "PROC-002": INITIAL_TIMELINE.map((tp, i) => ({
    ...tp,
    financial: Math.min(4, Math.floor(i * 0.6)),
    operational: Math.min(4, Math.floor(i * 0.7)),
    reputational: Math.min(4, i),
    legal: Math.min(2, Math.floor(i * 0.3)),
    health: 0,
    environmental: 0,
  })),
};

const SAMPLE_DEPENDENCIES: Dependency[] = [
  {
    id: "DEP-001",
    sourceProcessId: "PROC-004",
    targetProcessId: "PROC-001",
    type: "technical",
    criticality: 5,
    description: "Order fulfillment requires payment processing",
  },
  {
    id: "DEP-002",
    sourceProcessId: "PROC-004",
    targetProcessId: "PROC-003",
    type: "operational",
    criticality: 4,
    description: "Order fulfillment depends on inventory data",
  },
  {
    id: "DEP-003",
    sourceProcessId: "PROC-002",
    targetProcessId: "PROC-005",
    type: "technical",
    criticality: 3,
    description: "Customer service uses email for notifications",
  },
  {
    id: "DEP-004",
    sourceProcessId: "PROC-001",
    targetProcessId: "PROC-005",
    type: "technical",
    criticality: 2,
    description: "Payment confirmations sent via email",
  },
];

interface StoreState {
  processes: Process[];
  impacts: Record<string, ImpactAssessment>;
  recoveryObjectives: Record<string, RecoveryObjective>;
  temporalData: Record<string, TimelinePoint[]>;
  dependencies: Dependency[];
  settings: Settings;
  currentView: string;
  selectedProcessId: string | null;
  sidebarCollapsed: boolean;
  showGlossary: boolean;

  // Navigation
  setCurrentView: (view: string) => void;
  setSelectedProcessId: (id: string | null) => void;
  toggleSidebar: () => void;
  toggleGlossary: () => void;

  // Process CRUD
  addProcess: (process: Process) => void;
  updateProcess: (id: string, updates: Partial<Process>) => void;
  deleteProcess: (id: string) => void;
  getProcessById: (id: string) => Process | undefined;

  // Impact
  updateImpact: (processId: string, impact: ImpactAssessment) => void;

  // Recovery
  updateRecoveryObjective: (
    processId: string,
    objective: RecoveryObjective,
  ) => void;

  // Temporal
  updateTemporalData: (processId: string, data: TimelinePoint[]) => void;
  initTemporalData: (processId: string) => void;

  // Dependencies
  addDependency: (dep: Dependency) => void;
  removeDependency: (id: string) => void;
  getDependenciesForProcess: (processId: string) => {
    upstream: Dependency[];
    downstream: Dependency[];
  };

  // Settings
  updateSettings: (settings: Partial<Settings>) => void;

  // Calculations
  calculateRiskScore: (processId: string) => number;
  calculateMTPDFromTimeline: (processId: string) => number | null;

  // Data Management
  exportData: () => string;
  importData: (json: string) => boolean;
  clearAllData: () => void;
}

export const useStore = create<StoreState>()(
  persist(
    (set, get) => ({
      processes: SAMPLE_PROCESSES,
      impacts: SAMPLE_IMPACTS,
      recoveryObjectives: SAMPLE_RECOVERY,
      temporalData: SAMPLE_TEMPORAL,
      dependencies: SAMPLE_DEPENDENCIES,
      settings: DEFAULT_SETTINGS,
      currentView: "dashboard",
      selectedProcessId: null,
      sidebarCollapsed: false,
      showGlossary: false,

      setCurrentView: (view) => set({ currentView: view }),
      setSelectedProcessId: (id) => set({ selectedProcessId: id }),
      toggleSidebar: () =>
        set((s) => ({ sidebarCollapsed: !s.sidebarCollapsed })),
      toggleGlossary: () => set((s) => ({ showGlossary: !s.showGlossary })),

      addProcess: (process) =>
        set((s) => ({
          processes: [...s.processes, process],
          impacts: {
            ...s.impacts,
            [process.id]: {
              financial: 0,
              operational: 0,
              reputational: 0,
              legal: 0,
              health: 0,
              environmental: 0,
            },
          },
          recoveryObjectives: {
            ...s.recoveryObjectives,
            [process.id]: {
              mtpd: 24,
              rto: 12,
              rpo: 4,
              mbco: false,
              recoveryStrategy: "warm-standby",
              strategyNotes: "",
            },
          },
        })),

      updateProcess: (id, updates) =>
        set((s) => ({
          processes: s.processes.map((p) =>
            p.id === id
              ? { ...p, ...updates, updatedAt: new Date().toISOString() }
              : p,
          ),
        })),

      deleteProcess: (id) =>
        set((s) => {
          const { [id]: _i, ...remainingImpacts } = s.impacts;
          const { [id]: _r, ...remainingRecovery } = s.recoveryObjectives;
          const { [id]: _t, ...remainingTemporal } = s.temporalData;
          return {
            processes: s.processes.filter((p) => p.id !== id),
            impacts: remainingImpacts,
            recoveryObjectives: remainingRecovery,
            temporalData: remainingTemporal,
            dependencies: s.dependencies.filter(
              (d) => d.sourceProcessId !== id && d.targetProcessId !== id,
            ),
          };
        }),

      getProcessById: (id) => get().processes.find((p) => p.id === id),

      updateImpact: (processId, impact) =>
        set((s) => ({ impacts: { ...s.impacts, [processId]: impact } })),

      updateRecoveryObjective: (processId, objective) =>
        set((s) => ({
          recoveryObjectives: {
            ...s.recoveryObjectives,
            [processId]: objective,
          },
        })),

      updateTemporalData: (processId, data) =>
        set((s) => ({
          temporalData: { ...s.temporalData, [processId]: data },
        })),

      initTemporalData: (processId) => {
        const existing = get().temporalData[processId];
        const customPoints = getTimelinePointsFromCustom(
          get().settings.customTimelinePoints || [],
        );
        const numPoints = customPoints.length || 7;
        if (!existing || existing.length !== numPoints) {
          const impact = get().impacts[processId] || {
            financial: 0,
            operational: 0,
            reputational: 0,
            legal: 0,
            health: 0,
            environmental: 0,
          };
          const data = customPoints.map((tp, i) => ({
            ...tp,
            financial: Math.min(
              impact.financial,
              Math.floor((i * impact.financial) / numPoints),
            ),
            operational: Math.min(
              impact.operational,
              Math.floor((i * impact.operational) / numPoints),
            ),
            reputational: Math.min(
              impact.reputational,
              Math.floor((i * impact.reputational) / numPoints),
            ),
            legal: Math.min(
              impact.legal,
              Math.floor((i * impact.legal) / numPoints),
            ),
            health: Math.min(
              impact.health,
              Math.floor((i * impact.health) / numPoints),
            ),
            environmental: Math.min(
              impact.environmental,
              Math.floor((i * impact.environmental) / numPoints),
            ),
          }));
          set((s) => ({
            temporalData: { ...s.temporalData, [processId]: data },
          }));
        }
      },

      addDependency: (dep) =>
        set((s) => ({ dependencies: [...s.dependencies, dep] })),
      removeDependency: (id) =>
        set((s) => ({
          dependencies: s.dependencies.filter((d) => d.id !== id),
        })),

      getDependenciesForProcess: (processId) => {
        const deps = get().dependencies;
        return {
          upstream: deps.filter((d) => d.sourceProcessId === processId),
          downstream: deps.filter((d) => d.targetProcessId === processId),
        };
      },

      updateSettings: (settings) =>
        set((s) => ({ settings: { ...s.settings, ...settings } })),

      calculateRiskScore: (processId) => {
        const impact = get().impacts[processId];
        const weights = get().settings.impactWeights;
        if (!impact) return 0;
        let total = 0,
          weightSum = 0;
        Object.entries(weights).forEach(([key, weight]) => {
          total += (impact[key as keyof ImpactAssessment] || 0) * weight;
          weightSum += weight;
        });
        return parseFloat((total / weightSum).toFixed(2));
      },

      calculateMTPDFromTimeline: (processId) => {
        const timeline = get().temporalData[processId];
        const threshold = get().settings.impactThreshold;
        if (!timeline) return null;
        for (const point of timeline) {
          const maxImpact = Math.max(
            point.financial,
            point.operational,
            point.reputational,
            point.legal,
            point.health,
            point.environmental,
          );
          if (maxImpact >= threshold) return point.timeOffset;
        }
        return null;
      },

      exportData: () => {
        const {
          processes,
          impacts,
          recoveryObjectives,
          temporalData,
          dependencies,
          settings,
        } = get();
        return JSON.stringify(
          {
            processes,
            impacts,
            recoveryObjectives,
            temporalData,
            dependencies,
            settings,
            exportedAt: new Date().toISOString(),
          },
          null,
          2,
        );
      },

      importData: (json) => {
        try {
          const data = JSON.parse(json);
          if (!data.processes || !Array.isArray(data.processes)) return false;
          set({
            processes: data.processes,
            impacts: data.impacts || {},
            recoveryObjectives: data.recoveryObjectives || {},
            temporalData: data.temporalData || {},
            dependencies: data.dependencies || [],
            settings: data.settings || DEFAULT_SETTINGS,
          });
          return true;
        } catch {
          return false;
        }
      },

      clearAllData: () =>
        set({
          processes: [],
          impacts: {},
          recoveryObjectives: {},
          temporalData: {},
          dependencies: [],
          settings: DEFAULT_SETTINGS,
        }),
    }),
    {
      name: "bia-tool-storage-v3",
      partialize: (state) => ({
        processes: state.processes,
        impacts: state.impacts,
        recoveryObjectives: state.recoveryObjectives,
        temporalData: state.temporalData,
        dependencies: state.dependencies,
        settings: state.settings,
        sidebarCollapsed: state.sidebarCollapsed,
      }),
    },
  ),
);


--- FILE END: src\store\useStore.ts ---


--- FILE START: src\types\index.ts ---

export type Criticality = 'critical' | 'high' | 'medium' | 'low' | 'minimal';
export type ProcessStatus = 'draft' | 'in-review' | 'approved';
export type RecoveryStrategy = 'high-availability' | 'warm-standby' | 'cold-backup' | 'manual' | 'cloud-based';
export type DependencyType = 'technical' | 'operational' | 'resource';

export interface Process {
  id: string;
  name: string;
  owner: string;
  department: string;
  description: string;
  criticality: Criticality;
  status: ProcessStatus;
  createdAt: string;
  updatedAt: string;
}

export interface ImpactAssessment {
  financial: number;
  operational: number;
  reputational: number;
  legal: number;
  health: number;
  environmental: number;
}

export interface RecoveryObjective {
  mtpd: number;
  rto: number;
  rpo: number;
  mbco: boolean;
  recoveryStrategy: RecoveryStrategy;
  strategyNotes: string;
}

export interface TimelinePoint {
  timeOffset: number;
  timeLabel: string;
  financial: number;
  operational: number;
  reputational: number;
  legal: number;
  health: number;
  environmental: number;
}

export interface Dependency {
  id: string;
  sourceProcessId: string;
  targetProcessId: string;
  type: DependencyType;
  criticality: number;
  description: string;
}

export interface CustomTimelinePoint {
  id: string;
  label: string;
  value: number;
  unit: 'hours' | 'days' | 'weeks';
}

export interface TimeBasedDefinition {
  timelinePointId: string;
  description: string;
}

export interface ImpactCategory {
  id: string;
  name: string;
  description: string;
  weight: number;
  color: string;
  timeBasedDefinitions: TimeBasedDefinition[];
}

export type ResourceType = 'personnel' | 'systems' | 'equipment' | 'facilities' | 'vendors' | 'data';
export type TimeUnit = 'minutes' | 'hours' | 'days';

export interface TimeValue {
  value: number;
  unit: TimeUnit;
}

export interface BusinessResource {
  id: string;
  name: string;
  type: ResourceType;
  description: string;
  rto?: TimeValue;
  rpo?: TimeValue;
  quantityAtIntervals?: Record<string, number>; // timelinePointId -> quantity
}

export interface Settings {
  impactWeights: Record<string, number>;
  theme: 'dark' | 'light';
  impactThreshold: number;
  customTimelinePoints: CustomTimelinePoint[];
  impactCategories: ImpactCategory[];
  businessResources: BusinessResource[];
}

export const RESOURCE_TYPES: { value: ResourceType; label: string }[] = [
  { value: 'personnel', label: 'Personnel' },
  { value: 'systems', label: 'Systems/Applications' },
  { value: 'equipment', label: 'Equipment' },
  { value: 'facilities', label: 'Facilities' },
  { value: 'vendors', label: 'Vendors/Suppliers' },
  { value: 'data', label: 'Data/Records' },
];

export const DEFAULT_BUSINESS_RESOURCES: BusinessResource[] = [
  { id: 'res-1', name: 'ERP System', type: 'systems', description: 'Enterprise resource planning platform', rto: { value: 4, unit: 'hours' }, rpo: { value: 1, unit: 'hours' } },
  { id: 'res-2', name: 'IT Support Team', type: 'personnel', description: 'Technical support and infrastructure team', rto: { value: 2, unit: 'hours' } },
  { id: 'res-3', name: 'Primary Data Center', type: 'facilities', description: 'Main data center hosting critical systems', rto: { value: 8, unit: 'hours' }, rpo: { value: 4, unit: 'hours' } },
];

export interface AppState {
  processes: Process[];
  impacts: Record<string, ImpactAssessment>;
  recoveryObjectives: Record<string, RecoveryObjective>;
  temporalData: Record<string, TimelinePoint[]>;
  dependencies: Dependency[];
  settings: Settings;
}

export const DEFAULT_TIMELINE_POINTS = [
  { timeOffset: 0, timeLabel: 'Immediate' },
  { timeOffset: 4, timeLabel: '4 hours' },
  { timeOffset: 8, timeLabel: '8 hours' },
  { timeOffset: 24, timeLabel: '24 hours' },
  { timeOffset: 48, timeLabel: '48 hours' },
  { timeOffset: 72, timeLabel: '72 hours' },
  { timeOffset: 168, timeLabel: '1 week' },
];

export const GLOSSARY: Record<string, { term: string; definition: string; isoRef: string }> = {
  MTPD: {
    term: 'Maximum Tolerable Period of Disruption',
    definition: 'The maximum duration a business process can be unavailable before causing unacceptable consequences to the organization.',
    isoRef: 'ISO 22301:2019 Clause 8.2.2'
  },
  RTO: {
    term: 'Recovery Time Objective',
    definition: 'The target time within which a business process must be restored after a disruption to avoid unacceptable consequences.',
    isoRef: 'ISO 22301:2019 Clause 8.2.2'
  },
  RPO: {
    term: 'Recovery Point Objective',
    definition: 'The maximum acceptable amount of data loss measured in time. It indicates the point in time to which data must be recovered.',
    isoRef: 'ISO 22301:2019 Clause 8.2.2'
  },
  MBCO: {
    term: 'Minimum Business Continuity Objective',
    definition: 'The minimum level of services and/or products that is acceptable to achieve business objectives during a disruption.',
    isoRef: 'ISO 22301:2019 Clause 8.2.2'
  },
  BIA: {
    term: 'Business Impact Analysis',
    definition: 'The process of analyzing business functions and the effect that a disruption might have on them.',
    isoRef: 'ISO 22301:2019 Clause 8.2.2'
  },
  BCMS: {
    term: 'Business Continuity Management System',
    definition: 'Part of the overall management system that establishes, implements, operates, monitors, reviews, maintains and improves business continuity.',
    isoRef: 'ISO 22301:2019 Clause 3.5'
  }
};

export const DEFAULT_CUSTOM_TIMELINE_POINTS: CustomTimelinePoint[] = [
  { id: 'ctp-1', label: 'Immediate', value: 0, unit: 'hours' },
  { id: 'ctp-2', label: '4 hours', value: 4, unit: 'hours' },
  { id: 'ctp-3', label: '8 hours', value: 8, unit: 'hours' },
  { id: 'ctp-4', label: '24 hours', value: 24, unit: 'hours' },
  { id: 'ctp-5', label: '48 hours', value: 48, unit: 'hours' },
  { id: 'ctp-6', label: '72 hours', value: 72, unit: 'hours' },
  { id: 'ctp-7', label: '1 week', value: 1, unit: 'weeks' },
];

export const DEFAULT_IMPACT_CATEGORIES: ImpactCategory[] = [
  {
    id: 'financial', name: 'Financial', description: 'Direct monetary losses and revenue impact', weight: 25, color: '#F87171',
    timeBasedDefinitions: [
      { timelinePointId: 'ctp-1', description: 'Negligible, <$1,000' },
      { timelinePointId: 'ctp-2', description: 'Minor delays, $1,000-$5,000' },
      { timelinePointId: 'ctp-3', description: 'Moderate, $5,000-$10,000' },
      { timelinePointId: 'ctp-4', description: 'Significant, $10,000-$50,000' },
      { timelinePointId: 'ctp-5', description: 'Major, $50,000-$100,000' },
      { timelinePointId: 'ctp-6', description: 'Severe, $100,000-$500,000' },
      { timelinePointId: 'ctp-7', description: 'Catastrophic, >$500,000' },
    ]
  },
  {
    id: 'operational', name: 'Operational', description: 'Business process and productivity impact', weight: 25, color: '#FBBF24',
    timeBasedDefinitions: [
      { timelinePointId: 'ctp-1', description: 'No disruption' },
      { timelinePointId: 'ctp-2', description: 'Minor workflow delays' },
      { timelinePointId: 'ctp-3', description: 'Some processes affected' },
      { timelinePointId: 'ctp-4', description: 'Significant backlog' },
      { timelinePointId: 'ctp-5', description: 'Major operations halted' },
      { timelinePointId: 'ctp-6', description: 'Critical services down' },
      { timelinePointId: 'ctp-7', description: 'Complete operational failure' },
    ]
  },
  {
    id: 'reputational', name: 'Reputational', description: 'Brand and customer trust impact', weight: 20, color: '#818CF8',
    timeBasedDefinitions: [
      { timelinePointId: 'ctp-1', description: 'No public awareness' },
      { timelinePointId: 'ctp-2', description: 'Internal awareness only' },
      { timelinePointId: 'ctp-3', description: 'Some customer complaints' },
      { timelinePointId: 'ctp-4', description: 'Social media mentions' },
      { timelinePointId: 'ctp-5', description: 'Media coverage begins' },
      { timelinePointId: 'ctp-6', description: 'Widespread negative press' },
      { timelinePointId: 'ctp-7', description: 'Long-term brand damage' },
    ]
  },
  {
    id: 'legal', name: 'Legal/Compliance', description: 'Regulatory and legal exposure', weight: 15, color: '#38BDF8',
    timeBasedDefinitions: [
      { timelinePointId: 'ctp-1', description: 'No compliance issues' },
      { timelinePointId: 'ctp-2', description: 'Minor documentation gaps' },
      { timelinePointId: 'ctp-3', description: 'SLA breach warnings' },
      { timelinePointId: 'ctp-4', description: 'Regulatory notification required' },
      { timelinePointId: 'ctp-5', description: 'Formal investigation likely' },
      { timelinePointId: 'ctp-6', description: 'Regulatory fines expected' },
      { timelinePointId: 'ctp-7', description: 'Major legal action, license risk' },
    ]
  },
  {
    id: 'health', name: 'Health & Safety', description: 'Employee and public safety impact', weight: 10, color: '#34D399',
    timeBasedDefinitions: [
      { timelinePointId: 'ctp-1', description: 'No safety concerns' },
      { timelinePointId: 'ctp-2', description: 'Minor inconvenience' },
      { timelinePointId: 'ctp-3', description: 'First aid incidents' },
      { timelinePointId: 'ctp-4', description: 'Medical attention needed' },
      { timelinePointId: 'ctp-5', description: 'Serious injuries possible' },
      { timelinePointId: 'ctp-6', description: 'Life-threatening situations' },
      { timelinePointId: 'ctp-7', description: 'Fatalities possible' },
    ]
  },
  {
    id: 'environmental', name: 'Environmental', description: 'Environmental and sustainability impact', weight: 5, color: '#10B981',
    timeBasedDefinitions: [
      { timelinePointId: 'ctp-1', description: 'No environmental impact' },
      { timelinePointId: 'ctp-2', description: 'Minor waste increase' },
      { timelinePointId: 'ctp-3', description: 'Localized contamination' },
      { timelinePointId: 'ctp-4', description: 'Cleanup required' },
      { timelinePointId: 'ctp-5', description: 'Environmental agency notified' },
      { timelinePointId: 'ctp-6', description: 'Significant remediation' },
      { timelinePointId: 'ctp-7', description: 'Long-term ecological damage' },
    ]
  },
];

export const DEFAULT_SETTINGS: Settings = {
  impactWeights: { financial: 25, operational: 25, reputational: 20, legal: 15, health: 10, environmental: 5 },
  theme: 'dark',
  impactThreshold: 3,
  customTimelinePoints: DEFAULT_CUSTOM_TIMELINE_POINTS,
  impactCategories: DEFAULT_IMPACT_CATEGORIES,
  businessResources: DEFAULT_BUSINESS_RESOURCES
};

export function getTimelinePointsFromCustom(customPoints: CustomTimelinePoint[]): { timeOffset: number; timeLabel: string }[] {
  return customPoints
    .map(cp => {
      let hours = cp.value;
      if (cp.unit === 'days') hours = cp.value * 24;
      if (cp.unit === 'weeks') hours = cp.value * 168;
      return { timeOffset: hours, timeLabel: cp.label };
    })
    .sort((a, b) => a.timeOffset - b.timeOffset);
}


--- FILE END: src\types\index.ts ---


--- FILE START: src\vite-env.d.ts ---

/// <reference types="vite/client" />


--- FILE END: src\vite-env.d.ts ---


--- FILE START: tailwind.config.js ---

/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ["class"],
  content: [
    "./pages/**/*.{ts,tsx}",
    "./components/**/*.{ts,tsx}",
    "./app/**/*.{ts,tsx}",
    "./src/**/*.{ts,tsx}",
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        // BIA Glass Dark Theme
        "bia-bg-start": "#0F172A",
        "bia-bg-end": "#1E293B",
        "bia-glass": "rgba(30, 41, 59, 0.7)",
        "bia-glass-hover": "rgba(51, 65, 85, 0.6)",
        "bia-glass-active": "rgba(56, 189, 248, 0.15)",
        "bia-glass-input": "rgba(15, 23, 42, 0.6)",
        "bia-border": "rgba(255, 255, 255, 0.08)",
        "bia-border-focus": "rgba(56, 189, 248, 0.5)",
        "bia-primary": "#38BDF8",
        "bia-secondary": "#818CF8",
        "bia-accent": "#C084FC",
        "bia-critical": "#F87171",
        "bia-warning": "#FBBF24",
        "bia-success": "#34D399",
        "bia-info": "#60A5FA",
        "bia-text-primary": "#F8FAFC",
        "bia-text-secondary": "#94A3B8",
        "bia-text-tertiary": "#64748B",
      },
      fontFamily: {
        sans: ["Montserrat", "system-ui", "-apple-system", "sans-serif"],
        mono: ["JetBrains Mono", "monospace"],
      },
      borderRadius: {
        "bia-sm": "8px",
        "bia-md": "12px",
        "bia-lg": "16px",
        "bia-xl": "24px",
      },
      boxShadow: {
        glass: "0 8px 32px 0 rgba(0, 0, 0, 0.37)",
        lift: "0 10px 40px 0 rgba(0, 0, 0, 0.45)",
        "glow-primary": "0 0 15px rgba(56, 189, 248, 0.3)",
        "glow-critical": "0 0 15px rgba(248, 113, 113, 0.3)",
      },
      backdropBlur: {
        glass: "12px",
        "glass-lg": "20px",
      },
      animation: {
        "fade-in": "fadeIn 0.3s ease-out",
        "slide-up": "slideUp 0.3s ease-out",
        "scale-in": "scaleIn 0.3s ease-out",
      },
      keyframes: {
        fadeIn: {
          "0%": { opacity: "0" },
          "100%": { opacity: "1" },
        },
        slideUp: {
          "0%": { opacity: "0", transform: "translateY(20px)" },
          "100%": { opacity: "1", transform: "translateY(0)" },
        },
        scaleIn: {
          "0%": { opacity: "0", transform: "scale(0.95)" },
          "100%": { opacity: "1", transform: "scale(1)" },
        },
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
};


--- FILE END: tailwind.config.js ---


--- FILE START: tsconfig.app.json ---

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": [
      "ES2020",
      "DOM",
      "DOM.Iterable"
    ],
    "module": "ESNext",
    "skipLibCheck": true,
    /* Tailwind stuff */
    "baseUrl": ".",
    "paths": {
      "@/*": [
        "./src/*"
      ]
    },
    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",
    /* Linting */
    "strict": false,
    "noImplicitAny": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noFallthroughCasesInSwitch": false,
    "noUncheckedIndexedAccess": false,
    "noImplicitReturns": false,
    "noImplicitThis": false,
    "noPropertyAccessFromIndexSignature": false,
    "noUncheckedSideEffectImports": false
  },
  "include": [
    "src"
  ]
}


--- FILE END: tsconfig.app.json ---


--- FILE START: tsconfig.json ---

{
  "files": [],
  "references": [
    {
      "path": "./tsconfig.app.json"
    },
    {
      "path": "./tsconfig.node.json"
    }
  ],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}


--- FILE END: tsconfig.json ---


--- FILE START: tsconfig.node.json ---

{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}


--- FILE END: tsconfig.node.json ---


--- FILE START: vite.config.ts ---

import path from "path"
import react from "@vitejs/plugin-react"
import { defineConfig } from "vite"
import sourceIdentifierPlugin from 'vite-plugin-source-identifier'

const isProd = process.env.BUILD_MODE === 'prod'
export default defineConfig({
  plugins: [
    react(),
    sourceIdentifierPlugin({
      enabled: !isProd,
      attributePrefix: 'data-matrix',
      includeProps: true,
    })
  ],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
})


--- FILE END: vite.config.ts ---
